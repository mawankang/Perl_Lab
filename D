
---1:000_makelib_copy.tcl---
###########################################################################################
### 000_makelib_copy : Copy Milkyway CEL
###                                                              (V07.00.00) 2011.07.28
###########################################################################################

########################################################################################
### Local variable setting
########################################################################################

set _CEL_SCRIPT_ID   000
set _FROM_LIBRARY /design02/RX130_256KB/data/r5f51306/5_layout/50_icc/v010/F03_P03_C00_S00_R00_E00/r5f51306b_LIB
set _FROM_CEL  100_init_design_icc
set _TO_CEL  100_init_design_icc
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID
echo "Defined-Info : _FROM_LIBRARY " $_FROM_LIBRARY
echo "Defined-Info : _FROM_CEL " $_FROM_CEL
echo "Defined-Info : _TO_CEL " $_TO_CEL

source -echo -verbose ./icc_setup.tcl

printTime

########################################################################################
### Design Create and Copy CEL
########################################################################################


create_mw_lib \
   -technology $TECH_FILE \
   -bus_naming_style {[%d]} \
   -mw_reference_library $MW_REFERENCE_LIB_DIRS \
   -open \
   $MW_DESIGN_LIBRARY

#open_mw_lib $MW_DESIGN_LIBRARY 
copy_mw_cel \
-from_library $_FROM_LIBRARY \
-from $_FROM_CEL \
-to $_TO_CEL

printTime

sh date > FLAG_END_${_CEL_SCRIPT_ID}

exit

---2:100_init_design_icc.tcl---
###########################################################################################
### 100_init_design_icc : initial scripts that reads the design,
### applies constraints and generates a zero interconnect timing report
###                                                               (V08.00.00) 2012.03.09
###########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_SAVE_NAME    100_init_design_icc
set _CEL_SCRIPT_ID    100

echo "Defined-Info : _CEL_SAVE_NAME " $_CEL_SAVE_NAME
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1
echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG

if {$RENESAS_DEBUG} {
  set enable_page_mode true
  set sh_enable_page_mode true
}

#######################################################################################
### Print variables for mode switching
#######################################################################################
echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE              == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE                == " $MV_MODE
echo "SCRIPT-Info (Global) : ICC_INIT_DESIGN_INPUT  == " $ICC_INIT_DESIGN_INPUT
echo "#################################################################################"

printTime

########################################################################################
### Design Creation: mw or verilog or ddc
########################################################################################

########################################################################################
### MW CEL as the format between DCT and ICC
########################################################################################

if { $ICC_INIT_DESIGN_INPUT == "mw" } { 
  open_mw_cel $ICC_INPUT_CEL -library $MW_DESIGN_LIBRARY
}


if {$ICC_INIT_DESIGN_INPUT != "mw" && ![file exists $MW_DESIGN_LIBRARY/lib] } {
  create_mw_lib \
      -tech $TECH_FILE \
      -bus_naming_style {[%d]} \
      -mw_reference_library $MW_REFERENCE_LIB_DIRS \
      $MW_DESIGN_LIBRARY 
}


########################################################################################
### DDC as the format between DCT and ICC
########################################################################################

if {$ICC_INIT_DESIGN_INPUT == "ddc" } {
  open_mw_lib $MW_DESIGN_LIBRARY
  import_designs $ICC_IN_DDC_FILE -format ddc -top $DESIGN_NAME -cel $DESIGN_NAME
}


########################################################################################
### Ascii as the format between DCT and ICC
########################################################################################

if {$ICC_INIT_DESIGN_INPUT == "verilog" } {

  echo "open_mw_lib $MW_DESIGN_LIBRARY"
  open_mw_lib $MW_DESIGN_LIBRARY

  echo "import_designs $ICC_IN_VERILOG_NETLIST_FILE -format verilog -top $DESIGN_NAME -cel $DESIGN_NAME"
  import_designs $ICC_IN_VERILOG_NETLIST_FILE -format verilog -top $DESIGN_NAME -cel $DESIGN_NAME

source -echo ./temp_chg.tcl
########################################################################################
### Alternatively, replace import_designs line with following to handle dirty netlist and top level design
###
### open_mw_lib $MW_DESIGN_LIBRARY
### read_verilog_to_cel $ICC_IN_VERILOG_NETLIST_FILE -dirty_netlist 
### current_design $DESIGN_NAME
### uniquify_fp_mw_cel
### link
########################################################################################

  source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
  source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl


########################################################################################
### non MCMM mode, i.e. just reading the one SDC
### NOTE: define Operating Conditions by set_operating_conditions command after reading SDC:
###
### set_operating_conditions -analysis_type bc_wc -max_library xxx -min_library yyy \
### -max MAX -min MIN
########################################################################################

  if {$MCMM_MODE == "false"} {
    if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
      reset_upf
      load_upf $ICC_IN_UPF_FILE
      source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
    }
    echo "read_sdc $ICC_IN_IDEAL_SDC_FILE"
#   read_sdc $ICC_IN_IDEAL_SDC_FILE
    source $ICC_IN_IDEAL_SDC_FILE
    source -echo ./icc_zrt_scripts/design_specific_icc.tcl

    set ports_clock_root [get_ports [all_fanout -flat -clock_tree -level 0]]

    echo "group_path -name REGOUT -to [all_outputs]"
    group_path -name REGOUT -to [all_outputs]
    echo "group_path -name REGIN -from [remove_from_collection [all_inputs] $ports_clock_root]"
    group_path -name REGIN -from [remove_from_collection [all_inputs] $ports_clock_root]
    echo "group_path -name FEEDTHROUGH -from [remove_from_collection [all_inputs] $ports_clock_root] -to [all_outputs]"
    group_path -name FEEDTHROUGH -from [remove_from_collection [all_inputs] $ports_clock_root] -to [all_outputs]
    remove_propagated_clock [all_clocks]
  } 

########################################################################################
### MV settings for ascii flow
########################################################################################

  if {$MV_MODE == "true"} {
    echo "source -echo ./icc_zrt_scripts/mv_setup_design.tcl"
    source -echo ./icc_zrt_scripts/mv_setup_design.tcl  
  }

}


########################################################################################
### As the design is loaded now, MCMM mode can be entered
########################################################################################
#
#if {$MCMM_MODE == "true" } {
#  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
#    reset_upf
#    load_upf $ICC_IN_UPF_FILE
#  }
#  echo "SCRIPT-Info : starting the MCMM flow" 
#  remove_sdc
#  remove_scenario -all
#  source -echo $ICC_MCMM_IDEAL_SCENARIOS_FILE
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario 
#    remove_propagated_clock [all_clocks]
#    source ./icc_zrt_scripts/design_specific_icc.tcl
#  };
#}

########################################################################################
### The command performs the following checks:
### TLU_plus, clock related info such as  clock  periods,
### default  versus  nominal  PVT  on libraries
########################################################################################

check_scenarios -output $REPORTS_DIR/check_scenairo.rpt

########################################################################################
### Unfixing the hard macros
########################################################################################

# if {[all_macro_cells] != "" } { remove_dont_touch_placement [all_macro_cells] }


##############################################################################################################
### Floorplan Creation: DEF  OR  FLOORPLAN FILE  OR  TDF+initialize_floorplan
### CAUTION : Floorplan file flow with MV_MODE set to true is not currently supported by the scripts shown.
##############################################################################################################

#######################################################################################
### Below steps apply if floorplan input is not a DEF file
### Connect P/G, to create Power and Ground Ports for Non-MV designs 
### Assuming P/G Ports are included in DEF file, need PG ports created for non-DEF flows 
#######################################################################################

if {$ICC_IN_DEF_FILE eq ""} {
  if {[file exists [which $ICC_IN_UPF_FILE]]} {
    derive_pg_connection -create_nets -verbose
    derive_pg_connection -reconnect
    derive_pg_connection -tie
  } else {
    if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
      source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
    } else {
      echo "derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT -create_port top"
      derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                           -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT -create_port top
    }
  }
}

#########################################################################
# PG-CONNECT-PRE ########################################################
source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT_INITIAL
source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT_INC
source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT_HL
#########################################################################

########################################################################################
### You can have DEF, floorplan file, or TDF as floorplan input
########################################################################################

if {$ICC_FLOORPLAN_INPUT eq "def" && [file exists [which $ICC_IN_DEF_FILE]]} {
  #set mw_site_name_mapping {{CORE010 unit010} {CORE017 unit017}}
  set def_enable_no_legalize_name true
  echo "read_def -verbose -no_incremental $ICC_IN_DEF_FILE"
  read_def -verbose -no_incremental $ICC_IN_DEF_FILE
  ## Update Floorplan.   Added by N.Naritomi (2008.06.20)
  echo "update_floorplan"
  update_floorplan

} elseif {$ICC_FLOORPLAN_INPUT eq "fp_file" && [file exists [which $ICC_IN_FLOORPLAN_FILE]]} {
  #echo "read_floorplan $ICC_IN_FLOORPLAN_FILE"
  #read_floorplan $ICC_IN_FLOORPLAN_FILE
#wxy  source ./FILES/FP/Dump_0222A/DIA_ROW_Track.dump
#wxy  source ./FILES/FP/Dump_0222A/ALL-VG_RouteGuide.dump
#wxy  source ./FILES/FP/Dump_0222A/Create_IO.dump
#wxy  source ./FILES/FP/Dump_0222A/Create_CORNER.dump
#wxy  source ./FILES/FP/Dump_0222A/HM.dump
#wxy  source ./FILES/FP/Dump_0222A/IO.dump
#wxy  source ./FILES/FP/Dump_0222A/Place_Blockage.dump
#wxy  source ./FILES/PG/pre/v100/iccompilerdir/r5f51105.pgcon4icc_initial
} elseif {$ICC_FLOORPLAN_INPUT eq "create"} {
  if {[file exists [which $ICC_IN_TDF_FILE]]} {
    echo "read_pin_pad_physical_constraints $ICC_IN_TDF_FILE"
    read_pin_pad_physical_constraints $ICC_IN_TDF_FILE
  }

  echo "initialize_floorplan"

#####################################################################################################
### Please define the unitname before executing initialize_floorplan when the unitname is not "unit".
####################################################################################################

set_fp_options -unit_tile_name unit006

####################################################################################################
### Floorplan Initilization
####################################################################################################

  initialize_floorplan \
		-control_type aspect_ratio \
		-core_aspect_ratio 1 \
		-core_utilization 0.7 \
		-row_core_ratio 1 \
		-left_io2core 30 \
		-bottom_io2core 30 \
		-right_io2core 30 \
		-top_io2core 30 \
		-start_first_row
} elseif {$ICC_FLOORPLAN_INPUT eq "skip"} {
} 

create_floorplan -control_type boundary -left_io2core -124.8 -top_io2core -124.8 -right_io2core -124.8 -bottom_io2core -124.8 -keep_macro_place -keep_io_place
 
#?source ./FILES/FP/BOUNDS_IDET.tcl

 
#wxy remove_placement_blockage [get_placement_blockage -type soft]
#?source ./FILES/ECO/insert_spare_cell_140527.tcl
#?source ./FILES/ECO/insert_buf_cgsync.tcl
#?source ./FILES/ECO/r5f51105_v100_130123_eco_cmd_ac_predly.tcl



########################################################################################
### If you want to add additional floorplan details such as macro location, corner cells, 
### io filler cells, or pad rings, add them here, for example,
########################################################################################

# read_def -verbose -design $DESIGN_NAME $YOUR_INCREMENTAL_DEF_FILE
# read_floorplan $YOUR_INCREMENTAL_FLOORPLAN_FILE
# source $YOUR_SCRIPT


########################################################################################
### Set TLU Plus Files
########################################################################################

if {$MCMM_MODE == "false" } {
  if {$TLUPLUS_MIN_FILE == ""} {set TLUPLUS_MIN_FILE $TLUPLUS_MAX_FILE}
  set_tlu_plus_files \
     -max_tluplus $TLUPLUS_MAX_FILE \
     -min_tluplus $TLUPLUS_MIN_FILE \
     -tech2itf_map $MAP_FILE
}


##########################################################################
### Timing Derating for ideal clock.
### if you need timing derating in ideal clock, use the following commands.
###
### if {$MCMM_MODE == "false" } {
###   set_timing_derate -early 0.95 -cell_delay
###   set_timing_derate -late  1.05 -cell_delay
###   set_timing_derate -early 0.95 -net_delay
###   set_timing_derate -late  1.05 -net_delay
### } else {
### foreach scenario [all_active_scenarios] {
###   current_scenario $scenario
###   set_timing_derate -early 0.95 -cell_delay
###   set_timing_derate -late  1.05 -cell_delay
###   set_timing_derate -early 0.95 -net_delay
###   set_timing_derate -late  1.05 -net_delay
###   };
###}
##########################################################################


########################################################################################
### MV mode : Creating the physical MV objects
########################################################################################

if {$MV_MODE == "true"} {
                                            
  report_power_domain
  report_voltage_area -all

  if {$ICC_DP_AUTO_CREATE_VA == "false"} { 

 	## Create VA with user specified locations; you'll need to provide exact coordinates
    if {$PD1 != "" } {create_voltage_area  -coordinate $VA1_COORDINATES -guard_band_x 2 -guard_band_y 2 -power_domain $PD1}
    if {$PD2 != "" } {create_voltage_area  -coordinate $VA2_COORDINATES -guard_band_x 2 -guard_band_y 2 -power_domain $PD2}
    if {$PD3 != "" } {create_voltage_area  -coordinate $VA3_COORDINATES -guard_band_x 2 -guard_band_y 2 -power_domain $PD3}
    } else {

########################################################################################
### Create VA by tool automatically; you can provide desired utilization in the scripts below
### Location and shape of VA will be decided by the tool; you'll still need to make necessary adjustments  
########################################################################################

      source -echo icc_dp_scripts/create_va_dp.tcl
  }
}

########################################################################################
### ADD END CAP
########################################################################################

if {$ADD_END_CAP == "true" && $END_CAP_LEFT != ""} {
  add_end_cap -mode bottom_left -respect_blockage -lib_cell $END_CAP_LEFT
  add_end_cap -mode both -respect_blockage -lib_cell $END_CAP_RIGHT -skip_fixed
}


########################################################################################
### Connect Power & Ground for non-MV and MV-mode
########################################################################################
if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT2
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT3
  } else {
    echo "derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT"
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie}
  }
}


if {$MV_MODE == "true"} {

#############################################
## MTCMOS CELL INSTANTIATION + CONNECTION  ##
#############################################

########################################################################################
### If floorplan does not have switch cells instantiated in it, 
### please use add_header_footer_cell_array command as shown below BEFORE proceeding
### with daisy chain/hfn mode sleep net connectivity using the command connect_power_switch 
###
# create_voltage_area  -coordinate {238.230 71.150 278.200 104.725 } \
#   -name voltage_area_3 {u_start/u_carry/inst_u_126} -cycle_color
# add_header_footer_cell_array -lib_cell "HEAD8M" -design "u_addsub"  \
#   -x_increment 50 -y_increment 50 -respect "all" -prefix "HF1_" -voltage_area \
#  "voltage_area_3" -bounding_box  {243 274 78 77}
#
## for daisy chain mode :
#
# connect_power_switch -source enable -mode daisy -port_name enable_va_0 -ack_out ack \
# -voltage_area voltage_area_2 -direction vertical
#
## for hfn mode :
#
# connect_power_switch -source enable -mode hfn -port_name enable_va_0 -voltage_area voltage_area_2
########################################################################################


}


########################################################################################
### Some checks specific for MV mode
########################################################################################

if {$MV_MODE == "true"} {
  check_mv_design
  if {$AO_MODE == "true" } {
    get_always_on_logic -nets > $REPORTS_DIR/$DESIGN_NAME.ao_nets.rpt
    get_always_on_logic -all > $REPORTS_DIR/$DESIGN_NAME.ao_all.rpt 
    get_always_on_logic > $REPORTS_DIR/$DESIGN_NAME.ao.rpt 
    ## optionally define an single_power or dual_power AO strategy for the different VA's
    # set_always_on_strategy -object_list {$PD2} -cell_type "single_power|dual_power"
  }
}

if {$MCMM_MODE == "true"} {
  echo "SCRIPT-Info : MCMM_MODE set_active_scenarios"
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
}

save_mw_cel -as $_CEL_SAVE_NAME
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

########################################################################################
### Additional reporting: zero interconnect timing report and design summaries 
########################################################################################

report_design -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.sum

set_zero_interconnect_delay_mode true
set_ideal_network -no_propagate [all_high_fanout -nets -threshold 40]

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.zic.qor

if {$MCMM_MODE == "true"} {
  report_timing  -scenario [all_active_scenarios] -path full -net -input_pins \
        -attributes -voltage -max_paths 100 -tran -cap -nosplit -sign 3 -slack_lesser_than 0 \
        -delay max > $REPORTS_DIR/${_CEL_SAVE_NAME}.zic.timing

  report_timing  -scenario [all_active_scenarios] -path full -net -input_pins \
        -attributes -voltage -max_paths 100 -tran -cap -nosplit -sign 3 -slack_lesser_than 0 \
        -delay min > $REPORTS_DIR/${_CEL_SAVE_NAME}.zic.timing_min

  report_timing -scenario [all_active_scenarios] -loops -max_paths 100  > $REPORTS_DIR/${_CEL_SAVE_NAME}.loopnet
  report_constraint -nosplit -scenario [all_active_scenarios] -all_vio -sign 3   > $REPORTS_DIR/${_CEL_SAVE_NAME}.zic.all_vio

} else {
  report_timing -path full -net -input_pins -attributes -max_paths 100 \
        -tran -cap -nosplit -sign 3 -slack_lesser_than 0 > $REPORTS_DIR/${_CEL_SAVE_NAME}.zic.timing

  report_timing -path full -net -input_pins -attributes -max_paths 100 \
        -tran -cap -nosplit -sign 3 -slack_lesser_than 0 -delay min > $REPORTS_DIR/${_CEL_SAVE_NAME}.zic.timing_min

  report_timing -loop -max_paths 100 -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.loop
  report_constraint -nosplit -all_vio -sign 3   > $REPORTS_DIR/${_CEL_SAVE_NAME}.zic.all_vio
}


set_zero_interconnect_delay_mode false

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization


########################################################################################
### Check Library : Logical vs Physical library
########################################################################################

set_check_library_options -all
check_library > $REPORTS_DIR/$_CEL_SAVE_NAME.check_library.sum

printTime

sh date > 100_init_design_icc

exit
---3:200_place_opt_icc.tcl---
##########################################################################################
## 200_place_opt_icc: Placement and Placement Optimizations
###                                                               (V08.00.00) 2012.03.09
##########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    100_init_design_icc
set _CEL_SAVE_NAME    200_place_opt_icc
set _CEL_SCRIPT_ID    200

echo "Defined-Info : _CEL_LOAD_NAME " $_CEL_LOAD_NAME 
echo "Defined-Info : _CEL_SAVE_NAME " $_CEL_SAVE_NAME
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID


###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST

source -echo icc_setup.tcl

#######################################################################################
### Print variables for mode switching
#######################################################################################

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE             == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE               == " $MV_MODE
echo "SCRIPT-Info (Global) : ICC_IN_SCAN_DEF_FILE  == " $ICC_IN_SCAN_DEF_FILE
echo "#################################################################################"

printTime

##################################################################################
### If the initial DataBase is generated by Astro or ICC older version, convert DB
###
### convert_mw_lib -cel $ICC_FLOORPLAN_CEL $MW_DESIGN_LIBRARY
##################################################################################

printTime

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#modify begin LWH
source -echo temp_chg.tcl
#modify end LWH

open_mw_cel ${_CEL_SAVE_NAME}_TMP

#source -echo  /design02/RX130_256KB/data/r5f51306/5_layout/50_icc/FP/v010/FP04/FP_tcl/FP_nets_20170915.tcl
############# FIX HM-option ######################################################
change_selection [get_flat_cells -filter {  mask_layout_type =~ macro OR mask_layout_type =~ *pad OR mask_layout_type =~ pad* } -all -quiet]

set_attribute [get_selection] is_fixed true
##################################################################################

##################################################################################
### Optimization Common Session Options - set in all sessions
##################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl

##################################################################################
### enable Zroute Mode
##################################################################################

set_route_mode_options -zroute true

##################################################################################
### Source CTS Options CTS can be run during place_opt 
##################################################################################

#source -echo ./icc_zrt_scripts/common_cts_settings_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}


### modify 2012_0521 ###
#modify begin LWH
#source  ${ECO_200_place}
#
#source ./FILES/FP/insert_delay_2nd_blockage.dump
#
#source ./FILES/CTS/insert_buffer_thr_div.tcl
#modify end LWH

##################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells,
### clock cells
##################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  source -echo  $ICC_IN_DONT_USE_FILE
}

##################################################################################
### Set Ideal Network so place_opt handles data/clock mixing with high fanout
### Remove before clock_opt cts
##################################################################################

##################################################################################
#wxy ### add X1DOUT&X2DOUT output buffer by TM6BUFX40
#wxy insert_buffer -new_net_names X2DOUT_buf_net -new_cell_names X2DOUT_buf [get_pins cpusys/syspf/clkmc/osc/X2DOUT]  TM6BUFX40 
#wxy insert_buffer -new_net_names X1DOUT_buf_net  -new_cell_names X1DOUT_buf [get_pins cpusys/syspf/clkmc/osc/X1DOUT]  TM6BUFX40
#wxy ### add SUBOSC32K OSCOUTS 
#wxy insert_buffer -new_net_names OSCOUTS_buf_net  -new_cell_names OSCOUTS_buf [get_pins cpusys/syspf/clkmc/osc32k/OSCOUTS]  TM6BUFCLX20
#wxy remove_buffer cpusys/syspf/cpg/cgpre/soscclk_peridrv/cg_buf

source -echo  ${SDC_DT_1}
#modify begin LWH
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl
#modify end LWH


source -echo ${MAX_CAP_F}

#set_keepout_margin  -type hard -outer {0.48 0 0 0}  {cpusys/syspf/syreg/syregctl/U*}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : Reload SDC and Set Ideal Network on Clocks"
  remove_sdc
  read_sdc $ICC_IN_IDEAL_SDC_FILE
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  set_ideal_network [all_fanout -flat -clock_tree]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : Reload SDC and Set Ideal Network on MCMM Clocks"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_IDEAL_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
	check_timing -override_defaults {loops} > ${scenario}.loop
    source -echo ./icc_zrt_scripts/design_specific_icc.tcl
    set_ideal_network [all_fanout -flat -clock_tree ]
  };
}

set compile_instance_name_prefix icc_place 

#########################################################################
# PG-CONNECT-PRE ########################################################
##source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_initial
##source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
##source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcontieHL4icc
#########################################################################

##################################################################################
### specify Auto High Fanout Synthesis Options
### preserve boundary phase: ture / port punching: true
### NOTE: optimize_buffer_tree options is obsolete. If you set it to false,
### use the hidden variable: set hfs_optimize_buffer_trees false
##################################################################################

set_ahfs_options -preserve_boundary_phase true -enable_port_punching true
#set_ahfs_options -preserve_boundary_phase true -enable_port_punching true -global_route true



##################################################################################
### What commands do you need when you want to optimize SCAN ?
##################################################################################

if {[file exists [which $ICC_IN_SCAN_DEF_FILE]]} {
  set def_enable_no_legalize_name true
  read_def $ICC_IN_SCAN_DEF_FILE
  check_scan_chain > $REPORTS_DIR/scan_chain_pre_ordering.rpt
  report_scan_chain >>  $REPORTS_DIR/scan_chain_pre_ordering.rpt
}

printTime

#modify begin LWH
##if {[file exists [which $ICC_IN_SCAN_DEF_FILE]]} {
##  place_opt -area_recovery -effort medium -congestion -power -optimize_dft -num_cpus $ICC_NUM_CPUS
##} else {
###  place_opt -area_recovery -effort medium -congestion -power -num_cpus $ICC_NUM_CPUS
##
###  ADD TSURUSAKI SCRIPT
##    place_opt -area_recovery -effort high -congestion  -optimize_dft -num_cpus $ICC_NUM_CPUS
##    psynopt  -area_recovery -congestion
##
##}
##set_power_options -dynamic true -low_power_placement true
current_scenario USER1_MAX_HT_SETUP
read_saif -verbose -input $ICC_IN_SAIF_FILE_USER1 -instance top/pkg/dut
propagate_switching_activity
report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power_saif_read_mae
report_saif  > $REPORTS_DIR/$_CEL_SAVE_NAME.report_saif_mae


#source  ${ECO_200_place}
##modify begin kevin
source -echo ./FILES/PR/bounds.tcl
#wxy after route add
#wxy source -echo ../RG_PB_ADD.tcl
source -echo ./FILES/CTS_SCRIPT/selclk_50_div.tcl
#wxy after place add
source -echo ./FILES/PR/place_modify.tcl
source -echo ./FILES/CTS_SCRIPT/eco_300_cts.tcl
source -echo $PREROUTE_DONT_TOUCH
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl

##modify end kevin
source ./FILES/CTS_SCRIPT/insert_buffer_syncout.tcl_141217 
#add begin LWH
source -echo ./FILES/PR/cpg_eco.tcl
#add end LWH

##################################################################################
### Set attribute Spare cells
##################################################################################
remove_attribute   [get_lib_cells MF3TM6_P*_V*_T*/TM6SDFFQRZC1X10] dont_use
source ./FILES/PR/insert_spare_cell_180419.tcl
set_attribute [get_cells -hierarchical -filter {full_name=~*BONUS* AND is_hierarchical==false}] \
 is_spare_cell true
set_dont_use   [get_lib_cells MF3TM6_P*_V*_T*/TM6SDFFQRZC1X10]

set_congestion_options -max_util 0.9
report_scenarios > $REPORTS_DIR/${_CEL_SAVE_NAME}.scenarios
report_timing -scenario [all_active_scenarios] -loops -max_paths 1000  > $REPORTS_DIR/${_CEL_SAVE_NAME}.loopnet

save_mw_cel -as bf_place

#begin add by LWH
set placer_enable_enhanced_soft_blockages true
set_zero_interconnect_delay_mode true
create_placement -continue_on_missing_scandef -congestion
set_zero_interconnect_delay_mode false
remove_bounds *_tmp
save_mw_cel -as 1st_place
source ./FILES/PR/add_path_margin_for_flash.tcl
extract_rc  -estimate
create_placement -continue_on_missing_scandef -congestion -timing_driven  -congestion_effort high
save_mw_cel -as befor_place_opt
create_buffer_tree
place_opt  -congestion   -area_recovery -effort high  -power   -continue_on_missing_scandef -skip_initial_placement
#end add by LWH


##comment out begin by LWH
####modify begin kevin
####place_opt  -congestion   -area_recovery -effort high  -power 
##place_opt  -congestion   -area_recovery -effort high  -power -continue_on_missing_scandef
##remove_bounds *_tmp
##comment out end by LWH
psynopt  -area_recovery -congestion -continue_on_missing_scandef
##modify end kevin
report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power_saif_read_ato
report_saif  > $REPORTS_DIR/$_CEL_SAVE_NAME.report_saif_ato
write_saif -output $RESULTS_DIR/$_CEL_SAVE_NAME.saif
#modify end LWH

##################################################################################
### When you want to do feasibility study.
### place_opt_feasibility command runs faster than the place_opt command with resulting
### similar timing.    
##################################################################################

#if {[file exists [which $ICC_IN_SCAN_DEF_FILE]]} {
#    place_opt_feasibility -area_recovery -congestion -power -optimize_dft
#  } else {
#    place_opt_feasibility -area_recovery -congestion -power -continue_on_missing_scandef
#}

printTime

##################################################################################
### What commands do you need when you want to reduce dynamic power ?
###
###   set_power_options -dynamic true -low_power_placement true
###   read_saif -input $ICC_IN_SAIF_FILE
###   place_opt -effort low -area_recovery -power -num_cpus $ICC_NUM_CPUS
###          Note : option -low_power_placement enables the register clumping algorithm in 
###                 place_opt, whereas the option -dynamic enables the 
###                 Gate Level Power Optimization (GLPO)
##################################################################################

##################################################################################
### When you want to do scan opto, leakage opto, dynamic opto, and you have congestion issues, 
### use all options together :
###
###   read_def $ICC_IN_SCAN_DEF_FILE
###   set_power_options -leakage true -dynamic true -low_power_placement true
###   place_opt -effort low -congestion -area_recovery -optimize_dft -power -num_cpus $ICC_NUM_CPUS
##################################################################################

if {$MCMM_MODE == "true"} { 
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
}

##################################################################################
### MV CHECKS
##################################################################################

if {$MV_MODE == "true"} {
  check_mv_design -verbose > $REPORTS_DIR/02_place_opt.mv
}


##################################################################################
### Example of an atomic command.
###
###  create_placement -effort medium -timing_driven -congestion -congestion_effort high \
### -ignore_scan
###  set_optimize_dft_options -repartitioning_method adaptive
###  optimize_dft
###  legalize_placement
###  create_buffer_tree
###  psynopt -area_recovery -congestion
##################################################################################

########### Bonus_noFix ##########################################################

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true

##################################################################################
### Check Legality.
##################################################################################

check_legality -v


##################################################################################
### Create Snapshot and Save
##################################################################################

save_mw_cel -as $_CEL_SAVE_NAME
sh date > FLAG_END_${_CEL_SCRIPT_ID}

##modify begin kevin 
define_name_rule verilog -allowed {/ a-z A-Z 0-9 _ [ ]}
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports ./results/${DESIGN_NAME}_${_CEL_SAVE_NAME}.v
##modify end kevin 

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/$_CEL_SAVE_NAME.qor_snapshot.rpt

report_qor > $REPORTS_DIR/$_CEL_SAVE_NAME.qor
report_constraints > $REPORTS_DIR/$_CEL_SAVE_NAME.con
report_design -nosplit -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.design
report_net_fanout -high_fanout > $REPORTS_DIR/$_CEL_SAVE_NAME.high_fanoutnet

##################################################################################
## Get report Vth_tario 
##################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}

if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay      > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay -ver > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max2
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_transition > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -voltage -derate -physical -attri > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -voltage -derate -physical -attri > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -all_vio -nosplit -max_delay -ver  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max2
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max  \
                               -attributes -derate -physical -attri > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min  \
                               -attributes -derate -physical -attri > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim

}

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet]  > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR \
  ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR \
  ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

  report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization


remove_route_by_type -signal_detail_route
route_zrt_global
save_mw_cel -as ${_CEL_SAVE_NAME}_GRC

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 200_place_opt_icc

exit
---4:300_clock_opt_icc.tcl---
##########################################################################################
## 300_clock_opt_icc: CLock Tree Synthesis + clock routing for Zroute
###                                                               (V08.00.00) 2012.03.09
##########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    200_place_opt_icc
set _CEL_SAVE_NAME    300_clock_opt_icc
set _CEL_SCRIPT_ID    300

echo "Defined-Info : _CEL_LOAD_NAME " $_CEL_LOAD_NAME
echo "Defined-Info : _CEL_SAVE_NAME " $_CEL_SAVE_NAME
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
### DEFINE CTS EXCEPTIONS FILE 						
########################################################################################

set RENESAS_CLOCK_EXCEPTIONS       ""; # ./sample/set_clock_exceptions_tmp.tcl
set RENESAS_CLOCK_BALANCE          ""; # ./sample/set_balance_group_tmp.tcl
set RENESAS_CLOCK_FLOAT_PIN        ""; # ./sample/set_clock_exceptions_float_tmp.tcl
set RENESAS_DONT_USE4CTS           ""; # ./sample/set_dont_use_cell_4CTS_tmp.tcl
set RENESAS_REMOVE_DONTTOUCH4CTS   ""; # ./sample/remove_dont_use_clkcell_tmp.tcl
set RENESAS_SEPARATE_TREE          ""; # ./sample/separate_tmp.tcl

echo "Defined-Info : RENESAS_CLOCK_EXCEPTIONS  " $RENESAS_CLOCK_EXCEPTIONS
echo "Defined-Info : RENESAS_CLOCK_BALANCE     " $RENESAS_CLOCK_BALANCE
echo "Defined-Info : RENESAS_CLOCK_FLOAT_PIN   " $RENESAS_CLOCK_FLOAT_PIN
echo "Defined-Info : RENESAS_DONT_USE4CTS      " $RENESAS_DONT_USE4CTS
echo "Defined-Info : RENESAS_REMOVE_DONTTOUCH4CTS  " $RENESAS_REMOVE_DONTTOUCH4CTS
echo "Defined-Info : RENESAS_SEPARATE_TREE     " $RENESAS_SEPARATE_TREE

source icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1
echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG

if {$RENESAS_DEBUG} {
  set enable_page_mode true
  set sh_enable_page_mode true
}

#######################################################################################
### Print variables for mode switching
#######################################################################################

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"

printTime

########################################################################################
### Copy and Open Database
########################################################################################
 
open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#modify begin LWH
source -echo temp_chg.tcl
#modify end LWH

open_mw_cel ${_CEL_SAVE_NAME}_TMP


##  CTS MAX_TRANS Hi-fanout #############
#########################################


##################################################################################
### Optimization Common Session Options - set in all sessions
##################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl

# SET SDC For CTS(2ndCTS) ############################
remove_sdc
remove_scenario -all
#modify begin LWH
source  /design02/RX23E_AFE/data/r5f523e6a/4_implement/42_sdc/CTS/20180418/CTS_2nd/root2.sdc
source  /design02/RX23E_AFE/data/r5f523e6a/4_implement/42_sdc/CTS/20180418/CTS_2nd/set_clock_tree_exceptions_2nd.tcl
#modify end LWH

######################################################

# CTS OPECON ADD #####################################
set_operating_conditions \
 -max_library MF3TM6_Pss_V2p0_T125 -max WORST_TREE \
 -min_library MF3TM6_Pss_V2p0_T125 -min WORST_TREE

    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl

##add for ICC2013.12 lib read warning correction


######################################################



###################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, 
### clock cells
###################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  #source -echo  $ICC_IN_DONT_USE_FILE
  source -echo  $ICC_IN_DONT_USE_FILE_CTS
}

##################################################################################
### Source user specified constraint files
##################################################################################

set cts_instance_name_prefix CTS
#set cts_net_name_prefix CTS
set compile_instance_name_prefix icc_clock
#set cts_add_clock_domain_name true

#if {$MCMM_MODE == "true" } {
#  echo "SCRIPT-Info : MCMM_MODE set_active_scenarios set_cts_scenario"
#  remove_sdc
#  remove_scenario -all
#  if {$ICC_MCMM_MMCTS_SCENARIOS_FILE != ""} {
#    echo "SCRIPT-Info : use MM-CTS"
#    source -echo $ICC_MCMM_MMCTS_SCENARIOS_FILE
#  } else {
#    echo "SCRIPT-Info : use CTS SCENARIO"
#    source -echo $ICC_MCMM_IDEAL_SCENARIOS_FILE
#    set_active_scenarios [all_scenarios]
#    set_cts_scenario $ICC_MCMM_CTS_SCENARIO
#    current_scenario $ICC_MCMM_CTS_SCENARIO
#  }
#} else {
#  echo "SCRIPT-Info : Single_MODE remove current SDC and reread SDC for CTS"
#  remove_sdc
#  read_sdc $ICC_IN_CTS_SDC_FILE
#  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
#    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
#  }
#}
#
#printTime

if {[file exists [which $RENESAS_CLOCK_EXCEPTIONS]] } {
  source -echo $RENESAS_CLOCK_EXCEPTIONS
}
if {[file exists [which $RENESAS_CLOCK_BALANCE]] } {
  source -echo $RENESAS_CLOCK_BALANCE
}
if {[file exists [which $RENESAS_CLOCK_FLOAT_PIN]] } {
  source -echo $RENESAS_CLOCK_FLOAT_PIN
}
if {[file exists [which $RENESAS_DONT_USE4CTS]] } {
  source -echo $RENESAS_DONT_USE4CTS
}
if {[file exists [which $RENESAS_REMOVE_DONTTOUCH4CTS]] } {
  source -echo $RENESAS_REMOVE_DONTTOUCH4CTS
}

printTime

#modify begin LWH
#remove_bounds -all
#remove_bounds [remove_from_collection [get_bounds] [get_bounds {scnt rcnt BOUNDS_IDET BOUNDS_IIC}]]
remove_bounds [get_bounds {cgcksel cgsync cgdiv cgfine cgmain cgpli cgpretree cgsrcsel cgtock cgpre cgtree nc_osc nc_osc32k BOUNDS_LPWCNT BOUNDS_RTC}]
#remove_bounds [get_bounds {mp200_rcr psc_rcr}]
#remove_clock_tree_exceptions -all
#modify end LWH
remove_ideal_network -all

###### DONT_TOUCH SIZE_ONLY FOR CTS ######################################
#modify begin LWH
source ${SDC_DT_CTS}
set_clock_tree_exceptions -dont_size_cells [get_flat_cells *CLK_ECO*]
####set_clock_tree_exceptions -dont_size_cells [get_flat_cells {cpusys/syspf/cpg/cgtree/zx_clksi_fli/cg_gclk/cg_gclk cpusys/syspf/cpg/dftc_mode_u_u_clockcntrl/dftc_mode_buf_12}]
####set_clock_tree_exceptions -dont_buffer_net [get_nets -seg -of [get_flat_cells {cpusys/syspf/cpg/cgmaindft/cgmain/cgcksel/cgfliclkdiv3/cgfliclkdiv3or/selclk_buf/buf_0 cpusys/syspf/cpg/cgmaindft/cgmain/cgcksel/cgfliclkdiv3/cgfliclkdiv3or/selclk_inv/inv_0 cpusys/syspf/cpg/cgmaindft/cgmain/cgcksel/cgfliclkdiv3/cgfliclkdiv3or/selclk_pre/buf_0 cpusys/syspf/cpg/cgmaindft/cgmain/cgcksel/cgfliclkdiv3/cgfliclkdiv3or/divclk_or/cg_or2 cpusys/syspf/cpg/cgmaindft/cgmain/cgcksel/fliclk_div3_buf/cg_buf cpusys/syspf/cpg/cgmaindft/cgmain/cgcksel/fliclk_mdrv/cg_en3/cg_nand2}]]
#source ./FILES/SDC/setdir_lay.scr
#source ./FILES/SDC/r5f51105_v100_130131_dont_touch.tcl_for_CTS
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl_for_CTS
#source ./FILES/SDC/r5f51105_CTS_SIZEONLY_ADD.tcl
#modify end LWH
##########################################################################

###### FLOAT PIN SETTING FOR CTS #########################################
#modify begin LWH
#source ./FILES/SDC/r5f51105_CTS_FLOAT_PIN.tcl
#wxy source  ./FILES/CTS_SCRIPT/before_eco_ac_rspi_clk_131016.tcl
##add by kevin
set_clock_tree_exceptions -size_only_cells [get_flat_cells *CLKCNT_ECO*  ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *DIV_THR_ECO* ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *AddBuf_cpg_sys_pdrv_1_I* ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *AddBuf_cpg_sys_pdrv_2_I* ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *LOCO_ECO* ]

#modiefy end LWH
##########################################################################


###################################################################################
### Source CTS Options 
###################################################################################

######## 1-space-routeing-option #################################
source -echo ./icc_zrt_scripts/define_routing_rule.tcl
source -echo ./icc_zrt_scripts/common_cts_settings_icc.tcl
#modify begin LWH
set cts_do_characterization true
set cts_use_debug_mode true
#modify end LWH
##################################################################

#set mv_continue_on_opcond_mismatch true

##################################################################################
### REMOVE CLOCK TREE BUFFER 
##################################################################################
remove_clock_tree -clock_trees [all_clocks] -honor_dont_touch

#modify begin LWH
### add at 200_place
###source -echo ${ECO_300_clock}
###source -echo ./FILES/CTS_SCRIPT/eco_300_cts.tcl
#modify end LWH
printTime

############# STRAT  TSURUSAKI-san SCRIPT SETTING ########################################
report_design_physical -all > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization_preCTS
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}_bfCTS.utilization

#NSGK# To update extraction after remove_clock_tree
extract_rc -estimat
############## END TSURUSAKI-san SCRIPT SETTING  #########################################


##################################################################################
### SKEW GROUP
##################################################################################
		
#if {[file exists [which $RENESAS_SEPARARE_TREE]] } {		
#commit_skew_group		
#report_skew_group		
#report_clock_tree -summary		
#}		

##################################################################################
### CHECK CLOCK TREE
##################################################################################

check_clock_tree > $REPORTS_DIR/${_CEL_SAVE_NAME}.check_clock

printTime

##################################################################################
### CTS on Zroute Mode
##################################################################################

set_route_mode_options -zroute true ;# enable Zroute Mode

#ADD FOR DRC-VIO #################################################################
set_route_zrt_common_options -connect_within_pins_by_layer_name  {{M1 via_wire_standard_cell_pins}}
##################################################################################

##################################################################################
### ADDING ADDITIONAL FEATURES TO THE CLOCK_OPT COMMAND
##################################################################################

##################################################################################
### Additional Setting for CTS
###  (*) Inter clock balancing
###      Default : If you dont specify any balancing group information by
###                "set_inter_clock_delay_options", all clocks latency are
###                 adjusted.
###      Specify : If you specify balancing clock group, only specifed clocks
###                latency are adjusted.
#################################################################################

# ADD TSURUSAKI SCRIPT SETTING ##########################################

#RM_ORG#printTime
#RM_ORG#
#RM_ORG#clock_opt -only_cts -no_clock_route
#RM_ORG#
#RM_ORG#printTime
#modify begin LWH
set_max_transition 2.6 -clock_path [all_clocks]
set_max_transition 4.8 -data_path  [all_clocks]
#modify end LWH

#set_max_capacitance 1.00 -clock_path [all_clocks]
#set_max_capacitance 1.90 -data_path  [all_clocks]

set_max_capacitance 1.90 [current_design]

set cts_use_debug_mode true
set cts_force_user_constraints true
set cts_prects_upsize_gates true
set cts_target_transition 8 
set cts_target_cap 3 

set_clock_tree_options \
  -buffer_sizing true \
  -buffer_relocation true \
  -gate_sizing true \
  -gate_relocation true \
  -insert_boundary_cell false \
  -ocv_clustering true \
  -max_transition 2.6 \
  -max_fanout 500 \
  -target_skew 2 \
  -layer_list {M3 M4} \
  -max_capacitance 1.00


set_clock_tree_references -reference \
"TM6BUFCLX10 TM6BUFCLX20 TM6BUFCLX30 TM6BUFCLX40 TM6BUFCLX60 TM6BUFCLX80 TM6BUFCLX100 TM6BUFCLX120"

#"TM6BUFCLX10 TM6BUFCLX20 TM6BUFCLX40 TM6BUFCLX60 TM6BUFCLX80"
#"TM6INVCLX10 TM6INVCLX20 TM6INVCLX40 TM6INVCLX60 TM6INVCLX80"

#for unkown bug fix begin by lwh
####size_cell  pericore/mp200/iwdt/iwdt_lckc/iwdt_lcksel/i002_gck/gck TM6GTDX20
####size_cell  pericore/mp200/iwdt/iwdt_lckc/iwdt_lcksel/i003_gck/gck TM6GTDX20
####size_cell  pericore/mp200/iwdt/iwdt_lckc/iwdt_lcksel/i002_gck/gck TM6GTDX40
####size_cell  pericore/mp200/iwdt/iwdt_lckc/iwdt_lcksel/i003_gck/gck TM6GTDX40
#end by lwh

#report_clock_tree -summary
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_bfCTS
report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_bfCTS

printTime

#set_clock_tree_options -use_default_routing_for_sinks 1
set_clock_tree_options -routing_rule CLOCK_NET -use_default_routing_for_sinks 1
#modify begin LWH
#####add routing const for vertual cts
####set clock [get_nets -hier * -filter "net_type == Clock"]
####foreach_in_collection i [get_nets $clock] {set_net_routing_layer_constraints [get_nets $i] \
####-max_layer_name M4 -min_layer_name M3}
#####for make fclk_mdrv's latency shorter
####size_cell  cpusys/bpm/rx_flash/flash_mem/fcb/wcbctl/fsctl1_reg  TM6SDFFQSBZC1X20
set_max_leakage_power 0
##set_power_options -dynamic true -low_power_placement true -dynamic_effort high
set_optimize_pre_cts_power_options  -low_power_placement true  

reset_switching_activity
read_saif -input $RESULTS_DIR/${_CEL_LOAD_NAME}.saif -instance $DESIGN_NAME
propagate_switching_activity

report_power > $REPORTS_DIR/01_optimize_pre_cts_power_mae_power.rep
report_saif > $REPORTS_DIR/01_optimize_pre_cts_power_mae_saif.rep
optimize_pre_cts_power -verbose

report_power > $REPORTS_DIR/02_optimize_pre_cts_power_ato_power.rep
report_saif > $REPORTS_DIR/02_optimize_pre_cts_power_ato_saif.rep



redirect $REPORTS_DIR/compile_clock.log compile_clock_tree

report_power > $REPORTS_DIR/03_compile_clock_tree_ato_power.rep
report_saif > $REPORTS_DIR/03_compile_clock_tree_ato_saif.rep
#modify end LWH


#report_clock_tree -summary 
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_preCTS
report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_preCTS

printTime

########################################################################


##################################################################################
###    Save                                                
##################################################################################

save_mw_cel -as clock_pre_rtd_icc 

printTime
 
# STRAT TSURUSAKI-san SCRIPT SETTING ##########################################

#modify begin LWH
#optimize_clock_tree

optimize_clock_tree -buffer_relocation -buffer_sizing -gate_relocation -gate_sizing

report_power > $REPORTS_DIR/04_optimize_clock_tree_ato_power.rep
report_saif > $REPORTS_DIR/04_optimize_clock_tree_ato_saif.rep
#modify end LWH



#report_clock_tree -summary 
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_optCTS
report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_optCTS

printTime

save_mw_cel -as clock_opt_icc

printTime

##END TSURUSAKI-san SCRIPT SETTING  ############################################


##################################################################################
###     Connect Power & Ground for non-MV and MV-mode
##################################################################################

#if {$MV_MODE == "true" } {
#echo "SCRIPT-Info : MV_MODE insert_isolation_cell"
## in case new nets are created that go from one VA to another, level shifters need to be inserted on these nets 
# insert_level_shifters -all_clock_nets -verbose

## optionally insert isolation cells 
# insert_isolation_cell -reference $lib_cell -enable [find net $enable_net] -object_list [<get_net $nets_missing_isolation_cells>]

#}

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie}  
  }
}

##################################################################################
###       CLOCK ROUTING FIRST            
##################################################################################

source icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Turning off SI for clock routing
##################################################################################

# START TSURUSAKI-san SCRIPT SETTING ###################################
legalize_placement

#RM_ORG# set_si_options -delta_delay false -min_delta_delay false -route_xtalk_prevention false
#RM_ORG# 
#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#RM_ORG# 
#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# 
#RM_ORG# if {$MV_MODE == "true" } {
#RM_ORG#   echo "SCRIPT-Info : MV_MODE check_mv_design"
#RM_ORG#   check_mv_design -verbose > $REPORTS_DIR/$_CEL_SAVE_NAME.mv
#RM_ORG# }

check_legality -v

# END TSURUSAKI-san SCRIPT SETTING ####################################


##################################################################################
### Optimize Clock Tree after clock route.
##################################################################################

source -echo $ANTENNA_RULES_FILE
report_antenna_rules

###################################################################################
# START TSURUSAKI-san SCRIPT SETTING ##############################################
#### M2 wo TSUKAWANAI YOUNI #############################################################

set clock [get_nets -hier * -filter "net_type == Clock"]
foreach_in_collection i [get_nets $clock] {set_net_routing_layer_constraints [get_nets $i] \
-max_layer_name M4 -min_layer_name M3}
####modify begin LWH
###set_net_routing_rule [get_flat_nets -of [get_flat_pins *CLK_ECO_HOCO*]] -rule {CLOCK_NET}
###set_net_routing_rule [get_flat_nets -of [get_flat_pins *CLK_ECO_R32M*]] -rule {CLOCK_NET}
###set pin_list { \
###cpusys/syspf/clkmc/pll1/FO \
###cpusys/syspf/clkmc/pll1/FR \
###cpusys/syspf/clkmc/mdrv21_pllfo/cg_en1/cg_nand2/A \
###cpusys/syspf/clkmc/mdrv21_pllfo/cg_en1/cg_nand2/YB \
###cpusys/syspf/cpg/cgpre/cgostdsl/ostdmux0_mosc/cg_en0/cg_nand2/A \
###cpusys/syspf/cpg/cgpre/cgostdsl/ostdmux0_mosc/cg_en0/cg_nand2/YB \
###cpusys/syspf/cpg/cgpre/cgostdsl/ostdmux0_mosc/cg_sel/cg_nand2/* \
###cpusys/syspf/cpg/cgpre/cgmoscw/oscw_gck_gclkout/cg_gclk/CLK \
###cpusys/syspf/cpg/cgpre/cgmoscw/oscw_gck_gclkout/cg_gclk/GCLK \
###cpusys/syspf/cpg/cgpre/cgplw/oscw_gck_gclkout/cg_gclk/CLK \
###cpusys/syspf/cpg/cgpre/cgplw/oscw_gck_gclkout/cg_gclk/GCLK \
###cpusys/syspf/cpg/cgpre/plclk_sdrv/cg_buf/* \
###cpusys/syspf/cpg/cgpre/hococlk_sdrv/cg_buf/* \
###cpusys/syspf/cpg/cgpre/moscclk_sdrv/cg_buf/* \
###cpusys/syspf/cpg/cgpre/lococlk_sdrv/cg_buf/* \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_en0/cg_nand2/A \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_en1/cg_nand2/A \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_en2/cg_nand2/A \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_en4/cg_nand2/A \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_en0/cg_nand2/YB \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_en1/cg_nand2/YB \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_en2/cg_nand2/YB \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_en4/cg_nand2/YB \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_sel1/cg_nand4/* \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_sel0/cg_nand4/* \
###cpusys/syspf/cpg/cgpre/cgsrcsel/cgsrc_mdrv/cg_sel/cg_or2/* \
###cpusys/syspf/cpg/cgpre/srcsel_ppdrv/cg_buf/* }
###set_net_routing_rule -rule CLOCK_NET [get_flat_nets -of [get_pins $pin_list]]
####modify end LWH
report_clock_tree -summ > $REPORTS_DIR/${_CEL_SAVE_NAME}.rpt_summ_b_oct
route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail

#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail
#RM_ORG# 
#RM_ORG# printTime
# END TSURUSAKI-san SCRIPT SETTING ################################################

#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_2nd
#
#remove_scenario -all
#remove_sdc
#source ./FILES/SDC/clock_for_cts.sdc_v020_all2
#mark_clock_tree -clock_synthesized
#
#route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_all

##################################################################################
### Create Snapshot and Save
##################################################################################

save_mw_cel -as $_CEL_SAVE_NAME 
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_design_physical -all > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet

##################################################################################
## Get report Vth_tario 
##################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}

set MCMM_MODE false

if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_transition > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_timing -nosplit -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -voltage -derate -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_timing -nosplit -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim

  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap
  report_timing -nosplit -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim

  report_timing -nosplit -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full

  report_timing -nosplit -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary 
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

#current_scenario USER1_MAX_HT_SETUP

report_power -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.power
report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR \
ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR \
ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock


close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 300_clock_opt_icc

exit
---5:301_clock_opt_icc_ECO.tcl---
##########################################################################################
## 300_clock_opt_icc: CLock Tree Synthesis + clock routing for Zroute
###                                                               (V08.00.00) 2012.03.09
##########################################################################################
# FILES/ECO/120605A/replace_cpg_fix_v102_add.dump

########################################################################################
### Local variable setting
########################################################################################
#set _CEL_LOAD_NAME    301_clock_opt_icc
set _CEL_LOAD_NAME    410_post_cts_opt_setup_icc_uniq_eco
set _CEL_SAVE_NAME    410_post_cts_opt_setup_icc_eco_Route 
set _CEL_SCRIPT_ID    410

echo "Defined-Info : _CEL_LOAD_NAME " $_CEL_LOAD_NAME
echo "Defined-Info : _CEL_SAVE_NAME " $_CEL_SAVE_NAME
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
### DEFINE CTS EXCEPTIONS FILE 						
########################################################################################

set RENESAS_CLOCK_EXCEPTIONS       ""; # ./sample/set_clock_exceptions_tmp.tcl
set RENESAS_CLOCK_BALANCE          ""; # ./sample/set_balance_group_tmp.tcl
set RENESAS_CLOCK_FLOAT_PIN        ""; # ./sample/set_clock_exceptions_float_tmp.tcl
set RENESAS_DONT_USE4CTS           ""; # ./sample/set_dont_use_cell_4CTS_tmp.tcl
set RENESAS_REMOVE_DONTTOUCH4CTS   ""; # ./sample/remove_dont_use_clkcell_tmp.tcl
set RENESAS_SEPARATE_TREE          ""; # ./sample/separate_tmp.tcl

echo "Defined-Info : RENESAS_CLOCK_EXCEPTIONS  " $RENESAS_CLOCK_EXCEPTIONS
echo "Defined-Info : RENESAS_CLOCK_BALANCE     " $RENESAS_CLOCK_BALANCE
echo "Defined-Info : RENESAS_CLOCK_FLOAT_PIN   " $RENESAS_CLOCK_FLOAT_PIN
echo "Defined-Info : RENESAS_DONT_USE4CTS      " $RENESAS_DONT_USE4CTS
echo "Defined-Info : RENESAS_REMOVE_DONTTOUCH4CTS  " $RENESAS_REMOVE_DONTTOUCH4CTS
echo "Defined-Info : RENESAS_SEPARATE_TREE     " $RENESAS_SEPARATE_TREE

source icc_setup.tcl
########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1
echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG

if {$RENESAS_DEBUG} {
  set enable_page_mode true
  set sh_enable_page_mode true
}

#######################################################################################
### Print variables for mode switching
#######################################################################################

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"

printTime

########################################################################################
### Copy and Open Database
########################################################################################
 
open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP


##################################################################################
### Optimization Common Session Options - set in all sessions
##################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl

# ADD TSURUSAKI-san SCRIPT SETTING####################
remove_scenario -all
remove_sdc
source ./FILES/SDC/clock_for_cts.sdc_for_1st_v032_test_route
mark_clock_tree -clock_synthesized -routing_rule CLOCK_NET -use_default_routing_for_sinks 1

# CTS OPECON ADD #####################################
set_operating_conditions \
 -max_library MF3TM6_Pss_V2p0_T125 -max WORST_TREE \
 -min_library MF3TM6_Pss_V2p0_T125 -min WORST_TREE
######################################################



###################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, 
### clock cells
###################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  #source -echo  $ICC_IN_DONT_USE_FILE
  source -echo  $ICC_IN_DONT_USE_FILE_CTS
}

##################################################################################
### Source user specified constraint files
##################################################################################

set cts_instance_name_prefix CTS
#set cts_net_name_prefix CTS
set compile_instance_name_prefix icc_clock
#set cts_add_clock_domain_name true

#if {$MCMM_MODE == "true" } {
#  echo "SCRIPT-Info : MCMM_MODE set_active_scenarios set_cts_scenario"
#  remove_sdc
#  remove_scenario -all
#  if {$ICC_MCMM_MMCTS_SCENARIOS_FILE != ""} {
#    echo "SCRIPT-Info : use MM-CTS"
#    source -echo $ICC_MCMM_MMCTS_SCENARIOS_FILE
#  } else {
#    echo "SCRIPT-Info : use CTS SCENARIO"
#    source -echo $ICC_MCMM_IDEAL_SCENARIOS_FILE
#    set_active_scenarios [all_scenarios]
#    set_cts_scenario $ICC_MCMM_CTS_SCENARIO
#    current_scenario $ICC_MCMM_CTS_SCENARIO
#  }
#} else {
#  echo "SCRIPT-Info : Single_MODE remove current SDC and reread SDC for CTS"
#  remove_sdc
#  read_sdc $ICC_IN_CTS_SDC_FILE
#  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
#    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
#  }
#}
#
#printTime

if {[file exists [which $RENESAS_CLOCK_EXCEPTIONS]] } {
  source -echo $RENESAS_CLOCK_EXCEPTIONS
}
if {[file exists [which $RENESAS_CLOCK_BALANCE]] } {
  source -echo $RENESAS_CLOCK_BALANCE
}
if {[file exists [which $RENESAS_CLOCK_FLOAT_PIN]] } {
  source -echo $RENESAS_CLOCK_FLOAT_PIN
}
if {[file exists [which $RENESAS_DONT_USE4CTS]] } {
  source -echo $RENESAS_DONT_USE4CTS
}
if {[file exists [which $RENESAS_REMOVE_DONTTOUCH4CTS]] } {
  source -echo $RENESAS_REMOVE_DONTTOUCH4CTS
}

printTime

#remove_bounds -all
remove_clock_tree_exceptions -all

###### DONT_TOUCH SIZE_ONLY FOR CTS ######################################
source ./FILES/SDC/setdir_lay.scr
source ./FILES/SDC/r5f51105_v100_130131_dont_touch.tcl_for_CTS
source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl_for_CTS
source ./FILES/SDC/r5f51105_CTS_SIZEONLY_ADD2.tcl
##########################################################################


###################################################################################
### Source CTS Options 
###################################################################################


######## 1-space-routeing-option #################################
#source -echo ./icc_zrt_scripts/define_routing_rule.tcl
source -echo ./icc_zrt_scripts/common_cts_settings_icc.tcl
##################################################################


#set mv_continue_on_opcond_mismatch true

##################################################################################
### REMOVE CLOCK TREE BUFFER 
##################################################################################

#remove_clock_tree -clock_trees [all_clocks] -honor_dont_touch

printTime

############# STRAT  TSURUSAKI-san SCRIPT SETTING ########################################
report_design_physical -all > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization_preCTS

#NSGK# To update extraction after remove_clock_tree
extract_rc -estimat
############## END TSURUSAKI-san SCRIPT SETTING  #########################################


##################################################################################
### SKEW GROUP
##################################################################################
		
#if {[file exists [which $RENESAS_SEPARARE_TREE]] } {		
#commit_skew_group		
#report_skew_group		
#report_clock_tree -summary		
#}		

##################################################################################
### CHECK CLOCK TREE
##################################################################################

check_clock_tree > $REPORTS_DIR/${_CEL_SAVE_NAME}.check_clock

printTime

##################################################################################
### CTS on Zroute Mode
##################################################################################

set_route_mode_options -zroute true ;# enable Zroute Mode

#ADD FOR DRC-VIO #################################################################
set_route_zrt_common_options -connect_within_pins {{m1 via_wire_standard_cell_pins}}
##################################################################################

##################################################################################
### ADDING ADDITIONAL FEATURES TO THE CLOCK_OPT COMMAND
##################################################################################

##################################################################################
### Additional Setting for CTS
###  (*) Inter clock balancing
###      Default : If you dont specify any balancing group information by
###                "set_inter_clock_delay_options", all clocks latency are
###                 adjusted.
###      Specify : If you specify balancing clock group, only specifed clocks
###                latency are adjusted.
#################################################################################

# ADD TSURUSAKI SCRIPT SETTING ##########################################

#RM_ORG#printTime
#RM_ORG#
#RM_ORG#clock_opt -only_cts -no_clock_route
#RM_ORG#
#RM_ORG#printTime

set_max_transition 2.4 -clock_path [all_clocks]
set_max_transition 4.8 -data_path  [all_clocks]

#set_max_capacitance 1.00 -clock_path [all_clocks]
#set_max_capacitance 1.90 -data_path  [all_clocks]

set_max_capacitance 1.9 [current_design]

set cts_use_debug_mode true
set cts_force_user_constraints true
set cts_prects_upsize_gates true
set cts_target_transition 8 
set cts_target_cap 3 

set_clock_tree_options \
  -buffer_sizing true \
  -buffer_relocation true \
  -gate_sizing true \
  -gate_relocation true \
  -insert_boundary_cell false \
  -ocv_clustering true \
  -max_transition 2.4 \
  -max_fanout 500 \
  -target_skew 2 \
  -layer_list {M3 M4} \
  -max_capacitance 1.00


set_clock_tree_references -reference \
"TM6BUFCLX10 TM6BUFCLX20 TM6BUFCLX40 TM6BUFCLX60 TM6BUFCLX80"

#"TM6BUFCLX10 TM6BUFCLX20 TM6BUFCLX40 TM6BUFCLX60 TM6BUFCLX80 \
#TM6INVCLX10 TM6INVCLX20 TM6INVCLX40 TM6INVCLX60 TM6INVCLX80"


#report_clock_tree -summary
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_bfCTS
report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_bfCTS

printTime

set_clock_tree_options -routing_rule CLOCK_NET -use_default_routing_for_sinks 1

#compile_clock_tree

report_clock_tree -summary 
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_preCTS
#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_preCTS

printTime

########################################################################


##################################################################################
###    Save                                                
##################################################################################

#save_mw_cel -as clock_pre_rtd_icc 

printTime
 
# STRAT TSURUSAKI-san SCRIPT SETTING ##########################################

#optimize_clock_tree

report_clock_tree -summary 
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_optCTS
#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_optCTS

printTime

#save_mw_cel -as clock_opt_icc

printTime

##END TSURUSAKI-san SCRIPT SETTING  ############################################


##################################################################################
###     Connect Power & Ground for non-MV and MV-mode
##################################################################################

#if {$MV_MODE == "true" } {
#echo "SCRIPT-Info : MV_MODE insert_isolation_cell"
## in case new nets are created that go from one VA to another, level shifters need to be inserted on these nets 
# insert_level_shifters -all_clock_nets -verbose

## optionally insert isolation cells 
# insert_isolation_cell -reference $lib_cell -enable [find net $enable_net] -object_list [<get_net $nets_missing_isolation_cells>]

#}

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie}  
  }
}

##################################################################################
###       CLOCK ROUTING FIRST            
##################################################################################

source icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Turning off SI for clock routing
##################################################################################

# START TSURUSAKI-san SCRIPT SETTING ###################################
legalize_placement

#RM_ORG# set_si_options -delta_delay false -min_delta_delay false -route_xtalk_prevention false
#RM_ORG# 
#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#RM_ORG# 
#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# 
#RM_ORG# if {$MV_MODE == "true" } {
#RM_ORG#   echo "SCRIPT-Info : MV_MODE check_mv_design"
#RM_ORG#   check_mv_design -verbose > $REPORTS_DIR/$_CEL_SAVE_NAME.mv
#RM_ORG# }

# END TSURUSAKI-san SCRIPT SETTING ####################################


##################################################################################
### Optimize Clock Tree after clock route.
##################################################################################

source -echo $ANTENNA_RULES_FILE
report_antenna_rules

# START TSURUSAKI-san SCRIPT SETTING ###################################

set clock [get_nets -hier * -filter "net_type == Clock"]
foreach_in_collection i [get_nets $clock] {set_net_routing_layer_constraints [get_nets $i] \
-max_layer_name M4 -min_layer_name M3}


report_clock_tree -summ > $REPORTS_DIR/${_CEL_SAVE_NAME}.rpt_summ_b_oct
route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail

#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail
#RM_ORG# 
#RM_ORG# printTime

# END TSURUSAKI-san SCRIPT SETTING ####################################

#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_2nd
#
#remove_scenario -all
#remove_sdc
#source ./FILES/SDC/clock_for_cts.sdc_v020_all2
#mark_clock_tree -clock_synthesized
#
#route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_all

##################################################################################
### Create Snapshot and Save
##################################################################################

save_mw_cel -as $_CEL_SAVE_NAME 
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_design_physical -all > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet

##################################################################################
## Get report Vth_tario 
##################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}

set MCMM_MODE false

if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_transition > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -voltage -derate -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim

  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full

  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary 
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

#current_scenario USER1_MAX_HT_SETUP

report_power -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.power
report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR \
ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR \
ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock


#### add 120514 div thr reports ####
set DT_REP_DIR   "reports"
set DT_OPEN_CEL  "301_clock_opt_icc"
set DT_SCR_DIR   "./FILES/CTS/CTS_Scripts"
sh mkdir ${DT_REP_DIR}/only_stop_rise
###
source ${DT_SCR_DIR}/rx111_128k_cts_stop_rise.tcl
source ${DT_SCR_DIR}/rep_cts_step_rise.tcl
report_clock_tree -summary -nosplit > ${DT_REP_DIR}/${DT_OPEN_CEL}.clock_tree_summary_div_thr_rise
report_clock_tree -nosplit > ${DT_REP_DIR}/${DT_OPEN_CEL}.clock_tree_default_div_thr_rise
printTime
###
sh mv ${DT_REP_DIR}/rep_cts* ${DT_REP_DIR}/only_stop_rise/.
sh mv ${DT_REP_DIR}/${DT_OPEN_CEL}*_div_thr_rise ${DT_REP_DIR}/only_stop_rise/.
####################################


close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 410_post_cts_opt_setup_icc_eco_Route

exit
---6:301_clock_opt_icc.tcl---
##########################################################################################
## 300_clock_opt_icc: CLock Tree Synthesis + clock routing for Zroute
###                                                               (V08.00.00) 2012.03.09
##########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    300_clock_opt_icc
set _CEL_SAVE_NAME    301_clock_opt_icc
set _CEL_SCRIPT_ID    301

echo "Defined-Info : _CEL_LOAD_NAME " $_CEL_LOAD_NAME
echo "Defined-Info : _CEL_SAVE_NAME " $_CEL_SAVE_NAME
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
### DEFINE CTS EXCEPTIONS FILE 						
########################################################################################

set RENESAS_CLOCK_EXCEPTIONS       ""; # ./sample/set_clock_exceptions_tmp.tcl
set RENESAS_CLOCK_BALANCE          ""; # ./sample/set_balance_group_tmp.tcl
set RENESAS_CLOCK_FLOAT_PIN        ""; # ./sample/set_clock_exceptions_float_tmp.tcl
set RENESAS_DONT_USE4CTS           ""; # ./sample/set_dont_use_cell_4CTS_tmp.tcl
set RENESAS_REMOVE_DONTTOUCH4CTS   ""; # ./sample/remove_dont_use_clkcell_tmp.tcl
set RENESAS_SEPARATE_TREE          ""; # ./sample/separate_tmp.tcl

echo "Defined-Info : RENESAS_CLOCK_EXCEPTIONS  " $RENESAS_CLOCK_EXCEPTIONS
echo "Defined-Info : RENESAS_CLOCK_BALANCE     " $RENESAS_CLOCK_BALANCE
echo "Defined-Info : RENESAS_CLOCK_FLOAT_PIN   " $RENESAS_CLOCK_FLOAT_PIN
echo "Defined-Info : RENESAS_DONT_USE4CTS      " $RENESAS_DONT_USE4CTS
echo "Defined-Info : RENESAS_REMOVE_DONTTOUCH4CTS  " $RENESAS_REMOVE_DONTTOUCH4CTS
echo "Defined-Info : RENESAS_SEPARATE_TREE     " $RENESAS_SEPARATE_TREE

source icc_setup.tcl
########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1
echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG

if {$RENESAS_DEBUG} {
  set enable_page_mode true
  set sh_enable_page_mode true
}

#######################################################################################
### Print variables for mode switching
#######################################################################################

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"

printTime

########################################################################################
### Copy and Open Database
########################################################################################
 
open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#modify begin LWH
source -echo temp_chg.tcl
#modify end LWH

open_mw_cel ${_CEL_SAVE_NAME}_TMP


##################################################################################
### Optimization Common Session Options - set in all sessions
##################################################################################

###  div/thr  ### 
#source ./FILES/CTS/insert_buffer_thr_div.tcl

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl

# SET SDC For CTS(1stCTS) ########################################################
#modify begin LWH
remove_scenario -all
remove_sdc
remove_clock_tree_exceptions -all
source -echo /design02/RX23E_AFE/data/r5f523e6a/4_implement/42_sdc/CTS/20180418/CTS_1st/root1.sdc
source -echo /design02/RX23E_AFE/data/r5f523e6a/4_implement/42_sdc/CTS/20180418/CTS_1st/set_clock_tree_exceptions_1st.tcl
#modify end LWH
mark_clock_tree -clock_synthesized -routing_rule CLOCK_NET -use_default_routing_for_sinks 1
##################################################################################

# CTS OPECON ADD #####################################
set_operating_conditions \
 -max_library MF3TM6_Pss_V2p0_T125 -max WORST_TREE \
 -min_library MF3TM6_Pss_V2p0_T125 -min WORST_TREE

    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl


 
######################################################



###################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, 
### clock cells
###################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  #source -echo  $ICC_IN_DONT_USE_FILE
  source -echo  $ICC_IN_DONT_USE_FILE_CTS
}

##################################################################################
### Source user specified constraint files
##################################################################################
#modify begin LWH
set cts_instance_name_prefix CTS_301
#modify end LWH
#set cts_net_name_prefix CTS
set compile_instance_name_prefix icc_clock
#set cts_add_clock_domain_name true

#if {$MCMM_MODE == "true" } {
#  echo "SCRIPT-Info : MCMM_MODE set_active_scenarios set_cts_scenario"
#  remove_sdc
#  remove_scenario -all
#  if {$ICC_MCMM_MMCTS_SCENARIOS_FILE != ""} {
#    echo "SCRIPT-Info : use MM-CTS"
#    source -echo $ICC_MCMM_MMCTS_SCENARIOS_FILE
#  } else {
#    echo "SCRIPT-Info : use CTS SCENARIO"
#    source -echo $ICC_MCMM_IDEAL_SCENARIOS_FILE
#    set_active_scenarios [all_scenarios]
#    set_cts_scenario $ICC_MCMM_CTS_SCENARIO
#    current_scenario $ICC_MCMM_CTS_SCENARIO
#  }
#} else {
#  echo "SCRIPT-Info : Single_MODE remove current SDC and reread SDC for CTS"
#  remove_sdc
#  read_sdc $ICC_IN_CTS_SDC_FILE
#  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
#    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
#  }
#}
#
#printTime

if {[file exists [which $RENESAS_CLOCK_EXCEPTIONS]] } {
  source -echo $RENESAS_CLOCK_EXCEPTIONS
}
if {[file exists [which $RENESAS_CLOCK_BALANCE]] } {
  source -echo $RENESAS_CLOCK_BALANCE
}
if {[file exists [which $RENESAS_CLOCK_FLOAT_PIN]] } {
  source -echo $RENESAS_CLOCK_FLOAT_PIN
}
if {[file exists [which $RENESAS_DONT_USE4CTS]] } {
  source -echo $RENESAS_DONT_USE4CTS
}
if {[file exists [which $RENESAS_REMOVE_DONTTOUCH4CTS]] } {
  source -echo $RENESAS_REMOVE_DONTTOUCH4CTS
}

printTime

#modify begin LWH
set_clock_tree_exceptions -dont_size_cells [get_flat_cells *CLK_ECO*]
##remove_bounds -all
#remove_clock_tree_exceptions -all
#remove_route_guide RG_RAM_FOR_CTS*
#

###### DONT_TOUCH SIZE_ONLY FOR CTS ######################################
source ${SDC_DT_CTS}
#source ./FILES/SDC/setdir_lay.scr
#source ./FILES/SDC/r5f51105_v100_130131_dont_touch.tcl_for_CTS
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl_for_CTS
#source ./FILES/SDC/r5f51105_CTS_SIZEONLY_ADD2.tcl
set_clock_tree_exceptions -size_only_cells [get_flat_cells *CLKCNT_ECO*  ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *DIV_THR_ECO* ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *AddBuf_cpg_sys_pdrv_1_I* ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *AddBuf_cpg_sys_pdrv_2_I* ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *LOCO_ECO* ]
## 301 DRC Violation Fix
size_cell pericore/mp200/scid_0/u_sci/scim_core/GE_count_reg_clkp_0/latch TM6GTDX40
###########################################################################
#modify end LWH

###################################################################################
### Source CTS Options 
###################################################################################

######## 1-space-routeing-option #################################
#source -echo ./icc_zrt_scripts/define_routing_rule.tcl
source -echo ./icc_zrt_scripts/common_cts_settings_icc.tcl
##################################################################


#set mv_continue_on_opcond_mismatch true

##################################################################################
### REMOVE CLOCK TREE BUFFER 
##################################################################################

#remove_clock_tree -clock_trees [all_clocks] -honor_dont_touch

printTime

############# STRAT  TSURUSAKI-san SCRIPT SETTING ########################################
report_design_physical -all > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization_preCTS

###modify begin LWH
##size_cell cpusys/bpm/rx_flash/flash_mem/fcb/wcbctl/fsctl1_reg TM6SDFFQSBZC1X40
##size_cell [get_flat_cells -of [get_flat_nets -of [get_flat_pins cpusys/bpm/rx_flash/flash_mem/fcb/wcbctl/fsctl1_reg/Q]] -filter "ref_name=~*CLX*] TM6BUFCLX120
###modify end LWH
#NSGK# To update extraction after remove_clock_tree
extract_rc -estimat
############## END TSURUSAKI-san SCRIPT SETTING  #########################################


##################################################################################
### SKEW GROUP
##################################################################################
		
#if {[file exists [which $RENESAS_SEPARARE_TREE]] } {		
#commit_skew_group		
#report_skew_group		
#report_clock_tree -summary		
#}		

##################################################################################
### CHECK CLOCK TREE
##################################################################################

check_clock_tree > $REPORTS_DIR/${_CEL_SAVE_NAME}.check_clock

printTime

##################################################################################
### CTS on Zroute Mode
##################################################################################

set_route_mode_options -zroute true ;# enable Zroute Mode

#ADD FOR DRC-VIO #################################################################
set_route_zrt_common_options -connect_within_pins_by_layer_name  {{M1 via_wire_standard_cell_pins}}
##################################################################################

##################################################################################
### ADDING ADDITIONAL FEATURES TO THE CLOCK_OPT COMMAND
##################################################################################

##################################################################################
### Additional Setting for CTS
###  (*) Inter clock balancing
###      Default : If you dont specify any balancing group information by
###                "set_inter_clock_delay_options", all clocks latency are
###                 adjusted.
###      Specify : If you specify balancing clock group, only specifed clocks
###                latency are adjusted.
#################################################################################

# ADD TSURUSAKI SCRIPT SETTING ##########################################

#RM_ORG#printTime
#RM_ORG#
#RM_ORG#clock_opt -only_cts -no_clock_route
#RM_ORG#
#RM_ORG#printTime

set_max_transition 2.6 -clock_path [all_clocks]
set_max_transition 4.8 -data_path  [all_clocks]

#set_max_capacitance 1.00 -clock_path [all_clocks]
#set_max_capacitance 1.90 -data_path  [all_clocks]

set_max_capacitance 1.9 [current_design]

set cts_use_debug_mode true
set cts_force_user_constraints true
set cts_prects_upsize_gates true
set cts_target_transition 8 
set cts_target_cap 3 

set_clock_tree_options \
  -buffer_sizing true \
  -buffer_relocation true \
  -gate_sizing true \
  -gate_relocation true \
  -insert_boundary_cell false \
  -ocv_clustering true \
  -max_transition 2.6 \
  -max_fanout 500 \
  -target_skew 2 \
  -layer_list {M3 M4} \
  -max_capacitance 1.00

set_clock_tree_references -reference \
"TM6BUFCLX10 TM6BUFCLX20 TM6BUFCLX40 TM6BUFCLX60 TM6BUFCLX80"

#"TM6BUFCLX10 TM6BUFCLX20 TM6BUFCLX40 TM6BUFCLX60 TM6BUFCLX80"
#"TM6INVCLX10 TM6INVCLX20 TM6INVCLX40 TM6INVCLX60 TM6INVCLX80"


#report_clock_tree -summary
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_bfCTS
report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_bfCTS

printTime

set_clock_tree_options -routing_rule CLOCK_NET -use_default_routing_for_sinks 1

#compile_clock_tree
#redirect $REPORTS_DIR/compile_clock_301.log compile_clock_tree
#modify begin LWH
#report_clock_tree -summary 
#modify end LWH
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_preCTS
#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_preCTS

printTime

########################################################################


##################################################################################
###    Save                                                
##################################################################################

#save_mw_cel -as clock_pre_rtd_icc 

printTime
 
# STRAT TSURUSAKI-san SCRIPT SETTING ##########################################

#optimize_clock_tree

#modify begin LWH
optimize_clock_tree -buffer_relocation -buffer_sizing -gate_relocation -gate_sizing
#report_clock_tree -summary 
#modify end LWH
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_optCTS
#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_optCTS

printTime

#save_mw_cel -as clock_opt_icc

printTime

##END TSURUSAKI-san SCRIPT SETTING  ############################################


##################################################################################
###     Connect Power & Ground for non-MV and MV-mode
##################################################################################

#if {$MV_MODE == "true" } {
#echo "SCRIPT-Info : MV_MODE insert_isolation_cell"
## in case new nets are created that go from one VA to another, level shifters need to be inserted on these nets 
# insert_level_shifters -all_clock_nets -verbose

## optionally insert isolation cells 
# insert_isolation_cell -reference $lib_cell -enable [find net $enable_net] -object_list [<get_net $nets_missing_isolation_cells>]

#}

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie}  
  }
}

##################################################################################
###       CLOCK ROUTING FIRST            
##################################################################################

source icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Turning off SI for clock routing
##################################################################################

# START TSURUSAKI-san SCRIPT SETTING ###################################
legalize_placement

#RM_ORG# set_si_options -delta_delay false -min_delta_delay false -route_xtalk_prevention false
#RM_ORG# 
#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#RM_ORG# 
#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# 
#RM_ORG# if {$MV_MODE == "true" } {
#RM_ORG#   echo "SCRIPT-Info : MV_MODE check_mv_design"
#RM_ORG#   check_mv_design -verbose > $REPORTS_DIR/$_CEL_SAVE_NAME.mv
#RM_ORG# }

# END TSURUSAKI-san SCRIPT SETTING ####################################


##################################################################################
### Optimize Clock Tree after clock route.
##################################################################################

source -echo $ANTENNA_RULES_FILE
report_antenna_rules

###################################################################################
# START TSURUSAKI-san SCRIPT SETTING ##############################################
#### M2 wo TSUKAWANAI YOUNI #######################################################

set clock [get_nets -hier * -filter "net_type == Clock"]
foreach_in_collection i [get_nets $clock] {set_net_routing_layer_constraints [get_nets $i] \
-max_layer_name M4 -min_layer_name M3}

report_clock_tree -summ > $REPORTS_DIR/${_CEL_SAVE_NAME}.rpt_summ_b_oct
route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail
#modify begin LWH
#optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail
#modify end LWH

#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail
#RM_ORG# 
#RM_ORG# printTime
# END TSURUSAKI-san SCRIPT SETTING ################################################

#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_2nd
#
#remove_scenario -all
#remove_sdc
#source ./FILES/SDC/clock_for_cts.sdc_v020_all2
#mark_clock_tree -clock_synthesized
#
#route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_all

##################################################################################
### Create Snapshot and Save
##################################################################################

save_mw_cel -as $_CEL_SAVE_NAME 
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_design_physical -all > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet

##################################################################################
## Get report Vth_tario 
##################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}

set MCMM_MODE false

if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_transition > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -voltage -derate -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim

} else {

##  echo "SCRIPT-Info : Single mode report_timing"
##
##  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
##  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
##  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
##  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
##                -attributes -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
##
##  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
##                -attributes -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
##
##  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
##                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full
##
##  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
##                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full
##
}


##################################################################################
## Report Clock Tree
##################################################################################

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary 
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

#current_scenario USER1_MAX_HT_SETUP

report_power -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.power
report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR \
ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR \
ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization





#### Write_Verilog
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/${DESIGN_NAME}_${_CEL_SAVE_NAME}.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC




source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock





#### add 120514 div thr reports ####
#source ./FILES/tcl_cts/clock_tree_setting_1st_for_report.tcl
set DT_REP_DIR   "reports"
set DT_OPEN_CEL  "301_clock_opt_icc"
set DT_SCR_DIR   "./FILES/CTS_SCRIPT"
#modify begin LWH
sh rm -rf ${DT_REP_DIR}/only_stop_rise
#modify end LWH
sh mkdir ${DT_REP_DIR}/only_stop_rise
###
source ${DT_SCR_DIR}/rx111_128k_cts_stop_rise.tcl
source ${DT_SCR_DIR}/rep_cts_step_rise.tcl
report_clock_tree -summary -nosplit > ${DT_REP_DIR}/${DT_OPEN_CEL}.clock_tree_summary_div_thr_rise
report_clock_tree -nosplit > ${DT_REP_DIR}/${DT_OPEN_CEL}.clock_tree_default_div_thr_rise
printTime
###
sh mv ${DT_REP_DIR}/rep_cts* ${DT_REP_DIR}/only_stop_rise/.
sh mv ${DT_REP_DIR}/${DT_OPEN_CEL}*_div_thr_rise ${DT_REP_DIR}/only_stop_rise/.
####################################


close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 301_clock_opt_icc

exit
---7:302_clock_opt_icc.tcl---
##########################################################################################
## 300_clock_opt_icc: CLock Tree Synthesis + clock routing for Zroute
###                                                               (V08.00.00) 2012.03.09
##########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    301_clock_opt_icc
set _CEL_SAVE_NAME    302_clock_opt_icc
set _CEL_SCRIPT_ID    302

echo "Defined-Info : _CEL_LOAD_NAME " $_CEL_LOAD_NAME
echo "Defined-Info : _CEL_SAVE_NAME " $_CEL_SAVE_NAME
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
### DEFINE CTS EXCEPTIONS FILE 						
########################################################################################

set RENESAS_CLOCK_EXCEPTIONS       ""; # ./sample/set_clock_exceptions_tmp.tcl
set RENESAS_CLOCK_BALANCE          ""; # ./sample/set_balance_group_tmp.tcl
set RENESAS_CLOCK_FLOAT_PIN        ""; # ./sample/set_clock_exceptions_float_tmp.tcl
set RENESAS_DONT_USE4CTS           ""; # ./sample/set_dont_use_cell_4CTS_tmp.tcl
set RENESAS_REMOVE_DONTTOUCH4CTS   ""; # ./sample/remove_dont_use_clkcell_tmp.tcl
set RENESAS_SEPARATE_TREE          ""; # ./sample/separate_tmp.tcl

echo "Defined-Info : RENESAS_CLOCK_EXCEPTIONS  " $RENESAS_CLOCK_EXCEPTIONS
echo "Defined-Info : RENESAS_CLOCK_BALANCE     " $RENESAS_CLOCK_BALANCE
echo "Defined-Info : RENESAS_CLOCK_FLOAT_PIN   " $RENESAS_CLOCK_FLOAT_PIN
echo "Defined-Info : RENESAS_DONT_USE4CTS      " $RENESAS_DONT_USE4CTS
echo "Defined-Info : RENESAS_REMOVE_DONTTOUCH4CTS  " $RENESAS_REMOVE_DONTTOUCH4CTS
echo "Defined-Info : RENESAS_SEPARATE_TREE     " $RENESAS_SEPARATE_TREE

source icc_setup.tcl
########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1
echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG

if {$RENESAS_DEBUG} {
  set enable_page_mode true
  set sh_enable_page_mode true
}

#######################################################################################
### Print variables for mode switching
#######################################################################################

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"

printTime

########################################################################################
### Copy and Open Database
########################################################################################
 
open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#modify begin LWH
source -echo temp_chg.tcl
#modify end LWH

open_mw_cel ${_CEL_SAVE_NAME}_TMP

##################################################################################
### Optimization Common Session Options - set in all sessions
##################################################################################

###  div/thr  ### 
#source ./FILES/CTS/insert_buffer_thr_div.tcl

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl

# SET SDC For CTS(1stCTS) ########################################################
#modify begin LWH
remove_scenario -all
remove_sdc
remove_clock_tree_exceptions -all
#source -echo ./FILES/CTS_SCRIPT/CTS_ROOT01.tcl
#modify end LWH
mark_clock_tree -clock_synthesized -routing_rule CLOCK_NET -use_default_routing_for_sinks 1
##################################################################################

# CTS OPECON ADD #####################################
set_operating_conditions \
 -max_library MF3TM6_Pss_V2p0_T125 -max WORST_TREE \
 -min_library MF3TM6_Pss_V2p0_T125 -min WORST_TREE

    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl


 
######################################################



###################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, 
### clock cells
###################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  #source -echo  $ICC_IN_DONT_USE_FILE
  source -echo  $ICC_IN_DONT_USE_FILE_CTS
}

##################################################################################
### Source user specified constraint files
##################################################################################
#modify begin LWH
#set cts_instance_name_prefix CTS_301
#modify end LWH
#set cts_net_name_prefix CTS
#set compile_instance_name_prefix icc_clock
#set cts_add_clock_domain_name true

#if {$MCMM_MODE == "true" } {
#  echo "SCRIPT-Info : MCMM_MODE set_active_scenarios set_cts_scenario"
#  remove_sdc
#  remove_scenario -all
#  if {$ICC_MCMM_MMCTS_SCENARIOS_FILE != ""} {
#    echo "SCRIPT-Info : use MM-CTS"
#    source -echo $ICC_MCMM_MMCTS_SCENARIOS_FILE
#  } else {
#    echo "SCRIPT-Info : use CTS SCENARIO"
#    source -echo $ICC_MCMM_IDEAL_SCENARIOS_FILE
#    set_active_scenarios [all_scenarios]
#    set_cts_scenario $ICC_MCMM_CTS_SCENARIO
#    current_scenario $ICC_MCMM_CTS_SCENARIO
#  }
#} else {
#  echo "SCRIPT-Info : Single_MODE remove current SDC and reread SDC for CTS"
#  remove_sdc
#  read_sdc $ICC_IN_CTS_SDC_FILE
#  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
#    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
#  }
#}
#
#printTime

if {[file exists [which $RENESAS_CLOCK_EXCEPTIONS]] } {
  source -echo $RENESAS_CLOCK_EXCEPTIONS
}
if {[file exists [which $RENESAS_CLOCK_BALANCE]] } {
  source -echo $RENESAS_CLOCK_BALANCE
}
if {[file exists [which $RENESAS_CLOCK_FLOAT_PIN]] } {
  source -echo $RENESAS_CLOCK_FLOAT_PIN
}
if {[file exists [which $RENESAS_DONT_USE4CTS]] } {
  source -echo $RENESAS_DONT_USE4CTS
}
if {[file exists [which $RENESAS_REMOVE_DONTTOUCH4CTS]] } {
  source -echo $RENESAS_REMOVE_DONTTOUCH4CTS
}

printTime

#modify begin LWH
set_clock_tree_exceptions -dont_size_cells [get_flat_cells *CLK_ECO*]
##remove_bounds -all
#remove_clock_tree_exceptions -all
#remove_route_guide RG_RAM_FOR_CTS*
#

###### DONT_TOUCH SIZE_ONLY FOR CTS ######################################
source ${SDC_DT_CTS}
#source ./FILES/SDC/setdir_lay.scr
#source ./FILES/SDC/r5f51105_v100_130131_dont_touch.tcl_for_CTS
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl_for_CTS
#source ./FILES/SDC/r5f51105_CTS_SIZEONLY_ADD2.tcl
set_clock_tree_exceptions -size_only_cells [get_flat_cells *CLKCNT_ECO*  ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *DIV_THR_ECO* ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *AddBuf_cpg_sys_pdrv_1_I* ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *AddBuf_cpg_sys_pdrv_2_I* ]
set_clock_tree_exceptions -size_only_cells [get_flat_cells *LOCO_ECO* ]
## 301 DRC Violation Fix
#size_cell pericore/mp200/scid_0/u_sci/scim_core/GE_count_reg_clkp_0/latch TM6GTDX40

#Max_Tran_ECO_cmd
#wxy source -echo /design02/RX130_256KB/data/r5f51306/4_implement/42_sdc/ForPnR/v010/20170915_p06/normal_PreECO001_cmd.tcl
#wxy source -echo /design02/RX130_256KB/data/r5f51306/4_implement/42_sdc/ForPnR/v010/20170908/kobetsu_PreECO001_cmd.tcl
#wxy source -echo /design02/RX130_256KB/data/r5f51306/4_implement/42_sdc/ForPnR/v010/20170908/ac_PreECO001_cmd.tcl

###########################################################################
#modify end LWH

###################################################################################
### Source CTS Options 
###################################################################################

######## 1-space-routeing-option #################################
#source -echo ./icc_zrt_scripts/define_routing_rule.tcl
source -echo ./icc_zrt_scripts/common_cts_settings_icc.tcl
##################################################################


#set mv_continue_on_opcond_mismatch true

##################################################################################
### REMOVE CLOCK TREE BUFFER 
##################################################################################

#remove_clock_tree -clock_trees [all_clocks] -honor_dont_touch

printTime

############# STRAT  TSURUSAKI-san SCRIPT SETTING ########################################
report_design_physical -all > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization_preCTS

###modify begin LWH
##size_cell cpusys/bpm/rx_flash/flash_mem/fcb/wcbctl/fsctl1_reg TM6SDFFQSBZC1X40
##size_cell [get_flat_cells -of [get_flat_nets -of [get_flat_pins cpusys/bpm/rx_flash/flash_mem/fcb/wcbctl/fsctl1_reg/Q]] -filter "ref_name=~*CLX*] TM6BUFCLX120
###modify end LWH
#NSGK# To update extraction after remove_clock_tree
extract_rc -estimat
############## END TSURUSAKI-san SCRIPT SETTING  #########################################


##################################################################################
### SKEW GROUP
##################################################################################
		
#if {[file exists [which $RENESAS_SEPARARE_TREE]] } {		
#commit_skew_group		
#report_skew_group		
#report_clock_tree -summary		
#}		

##################################################################################
### CHECK CLOCK TREE
##################################################################################

check_clock_tree > $REPORTS_DIR/${_CEL_SAVE_NAME}.check_clock

printTime

##################################################################################
### CTS on Zroute Mode
##################################################################################

set_route_mode_options -zroute true ;# enable Zroute Mode

#ADD FOR DRC-VIO #################################################################
set_route_zrt_common_options -connect_within_pins_by_layer_name  {{M1 via_wire_standard_cell_pins}}
##################################################################################

##################################################################################
### ADDING ADDITIONAL FEATURES TO THE CLOCK_OPT COMMAND
##################################################################################

##################################################################################
### Additional Setting for CTS
###  (*) Inter clock balancing
###      Default : If you dont specify any balancing group information by
###                "set_inter_clock_delay_options", all clocks latency are
###                 adjusted.
###      Specify : If you specify balancing clock group, only specifed clocks
###                latency are adjusted.
#################################################################################

# ADD TSURUSAKI SCRIPT SETTING ##########################################

#RM_ORG#printTime
#RM_ORG#
#RM_ORG#clock_opt -only_cts -no_clock_route
#RM_ORG#
#RM_ORG#printTime

set_max_transition 2.6 -clock_path [all_clocks]
set_max_transition 4.8 -data_path  [all_clocks]

#set_max_capacitance 1.00 -clock_path [all_clocks]
#set_max_capacitance 1.90 -data_path  [all_clocks]

set_max_capacitance 1.9 [current_design]

set cts_use_debug_mode true
set cts_force_user_constraints true
set cts_prects_upsize_gates true
set cts_target_transition 8 
set cts_target_cap 3 

set_clock_tree_options \
  -buffer_sizing true \
  -buffer_relocation true \
  -gate_sizing true \
  -gate_relocation true \
  -insert_boundary_cell false \
  -ocv_clustering true \
  -max_transition 2.6 \
  -max_fanout 500 \
  -target_skew 2 \
  -layer_list {M3 M4} \
  -max_capacitance 1.00

set_clock_tree_references -reference \
"TM6BUFCLX10 TM6BUFCLX20 TM6BUFCLX40 TM6BUFCLX60 TM6BUFCLX80"

#"TM6BUFCLX10 TM6BUFCLX20 TM6BUFCLX40 TM6BUFCLX60 TM6BUFCLX80"
#"TM6INVCLX10 TM6INVCLX20 TM6INVCLX40 TM6INVCLX60 TM6INVCLX80"


#report_clock_tree -summary
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_bfCTS
report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_bfCTS

printTime

set_clock_tree_options -routing_rule CLOCK_NET -use_default_routing_for_sinks 1

#compile_clock_tree
#redirect $REPORTS_DIR/compile_clock_301.log compile_clock_tree
#modify begin LWH
#report_clock_tree -summary 
#modify end LWH
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_preCTS
#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_preCTS

printTime

########################################################################


##################################################################################
###    Save                                                
##################################################################################

#save_mw_cel -as clock_pre_rtd_icc 

printTime
 
# STRAT TSURUSAKI-san SCRIPT SETTING ##########################################

#optimize_clock_tree

#modify begin LWH
#optimize_clock_tree -buffer_relocation -buffer_sizing -gate_relocation -gate_sizing
#report_clock_tree -summary 
#modify end LWH
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_optCTS
#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure_optCTS

printTime

#save_mw_cel -as clock_opt_icc

printTime

##END TSURUSAKI-san SCRIPT SETTING  ############################################


##################################################################################
###     Connect Power & Ground for non-MV and MV-mode
##################################################################################

#if {$MV_MODE == "true" } {
#echo "SCRIPT-Info : MV_MODE insert_isolation_cell"
## in case new nets are created that go from one VA to another, level shifters need to be inserted on these nets 
# insert_level_shifters -all_clock_nets -verbose

## optionally insert isolation cells 
# insert_isolation_cell -reference $lib_cell -enable [find net $enable_net] -object_list [<get_net $nets_missing_isolation_cells>]

#}

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie}  
  }
}

##################################################################################
###       CLOCK ROUTING FIRST            
##################################################################################

source icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Turning off SI for clock routing
##################################################################################

# START TSURUSAKI-san SCRIPT SETTING ###################################
legalize_placement

#RM_ORG# set_si_options -delta_delay false -min_delta_delay false -route_xtalk_prevention false
#RM_ORG# 
#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#RM_ORG# 
#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# 
#RM_ORG# if {$MV_MODE == "true" } {
#RM_ORG#   echo "SCRIPT-Info : MV_MODE check_mv_design"
#RM_ORG#   check_mv_design -verbose > $REPORTS_DIR/$_CEL_SAVE_NAME.mv
#RM_ORG# }

# END TSURUSAKI-san SCRIPT SETTING ####################################


##################################################################################
### Optimize Clock Tree after clock route.
##################################################################################

source -echo $ANTENNA_RULES_FILE
report_antenna_rules

###################################################################################
# START TSURUSAKI-san SCRIPT SETTING ##############################################
#### M2 wo TSUKAWANAI YOUNI #######################################################

set clock [get_nets -hier * -filter "net_type == Clock"]
foreach_in_collection i [get_nets $clock] {set_net_routing_layer_constraints [get_nets $i] \
-max_layer_name M4 -min_layer_name M3}

report_clock_tree -summ > $REPORTS_DIR/${_CEL_SAVE_NAME}.rpt_summ_b_oct
route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail
#modify begin LWH
#optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail
#modify end LWH

#RM_ORG# printTime
#RM_ORG# 
#RM_ORG# optimize_clock_tree -buffer_sizing -gate_sizing -routed_clock_stage detail
#RM_ORG# 
#RM_ORG# printTime
# END TSURUSAKI-san SCRIPT SETTING ################################################

#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_2nd
#
#remove_scenario -all
#remove_sdc
#source ./FILES/SDC/clock_for_cts.sdc_v020_all2
#mark_clock_tree -clock_synthesized
#
#route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 10
#report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary_all

##################################################################################
### Create Snapshot and Save
##################################################################################

save_mw_cel -as $_CEL_SAVE_NAME 
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_design_physical -all > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet

##################################################################################
## Get report Vth_tario 
##################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}

set MCMM_MODE false

if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_transition > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -voltage -derate -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim

} else {

##  echo "SCRIPT-Info : Single mode report_timing"
##
##  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
##  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
##  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
##  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
##                -attributes -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
##
##  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
##                -attributes -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
##
##  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
##                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full
##
##  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
##                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full
##
}


##################################################################################
## Report Clock Tree
##################################################################################

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary 
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

#current_scenario USER1_MAX_HT_SETUP

report_power -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.power
report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR \
ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR \
ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization





#### Write_Verilog
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/${DESIGN_NAME}_${_CEL_SAVE_NAME}.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC




source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock





#### add 120514 div thr reports ####
#source ./FILES/tcl_cts/clock_tree_setting_1st_for_report.tcl
#set DT_REP_DIR   "reports"
#set DT_OPEN_CEL  "302_clock_opt_icc"
#set DT_SCR_DIR   "./FILES/CTS_SCRIPT"
##modify begin LWH
#sh rm -rf ${DT_REP_DIR}/only_stop_rise
##modify end LWH
#sh mkdir ${DT_REP_DIR}/only_stop_rise
####
#source ${DT_SCR_DIR}/rx111_128k_cts_stop_rise.tcl
#source ${DT_SCR_DIR}/rep_cts_step_rise.tcl
#report_clock_tree -summary -nosplit > ${DT_REP_DIR}/${DT_OPEN_CEL}.clock_tree_summary_div_thr_rise
#report_clock_tree -nosplit > ${DT_REP_DIR}/${DT_OPEN_CEL}.clock_tree_default_div_thr_rise
#printTime
###
#sh mv ${DT_REP_DIR}/rep_cts* ${DT_REP_DIR}/only_stop_rise/.
#sh mv ${DT_REP_DIR}/${DT_OPEN_CEL}*_div_thr_rise ${DT_REP_DIR}/only_stop_rise/.
####################################


close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 302_clock_opt_icc

exit
---8:410_post_cts_opt_setup_icc.tcl---
##########################################################################################
## 410_post_cts_opt_setup_icc: Post CTS Optimization for Zroute
###                                                               (V08.00.00) 2012.03.09
##########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    302_clock_opt_icc
set _CEL_SAVE_NAME    410_post_cts_opt_setup_icc
set _CEL_SCRIPT_ID    410

echo "Defined-Info : _CEL_LOAD_NAME " $_CEL_LOAD_NAME
echo "Defined-Info : _CEL_SAVE_NAME " $_CEL_SAVE_NAME
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1
echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG


if {$RENESAS_DEBUG} {
  set enable_page_mode true
  set sh_enable_page_mode true
}

#######################################################################################
### Print variables for mode switching
#######################################################################################

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"

printTime
 
open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#modify begin LWH
source -echo temp_chg.tcl
#modify end LWH

open_mw_cel ${_CEL_SAVE_NAME}_TMP

##################################################################################
### Optimization Common Session Options - set in all sessions
##################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo $PREROUTE_DONT_TOUCH
##################################################################################
### Source Post CTS Options
##################################################################################

source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

##################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, 
### clock cells
##################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  source -echo  $ICC_IN_DONT_USE_FILE
}

##################################################################################
### Post CTS Setup Optimization Flow
##################################################################################

set compile_instance_name_prefix icc_postcts_setup

##################################################################################
### Remove current SDC and set again
##################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl


source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false"} {
  remove_sdc
  echo "SCRIPT-Info : Remove SDC for CTS and read mission mode SDC"
  read_sdc $ICC_IN_PROPA_SDC_FILE
  source $RENESAS_SET_OCV_TCL
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : starting the MCMM flow" 
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
	source ./FILES/PR/uncertainty_chg.tcl
    source $RENESAS_SET_OCV_TCL
    source ./icc_zrt_scripts/design_specific_icc.tcl
  }
}

#################################################################################
### Remove any remaining ideal networks 
##################################################################################

remove_ideal_network -all

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : Set Propagated Clock"
  set_propagated_clock [all_clocks]
} else {
  echo "SCRIPT-Info : Set Propagated Clock on MCMM"
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
  };
}

#### 301_opt modify
##insert_buffer -no_of_cells 1 -new_cell_names ECO_301_BUF_1 cpusys/bpm/rx_cpubpf/rx_cpumem/ocd_top/ocd_fine/clk_gate_kik1rtxaddr_reg/latch/CLK TM6BUFCLX60
##insert_buffer -no_of_cells 1 -new_cell_names ECO_301_BUF_2 cpusys/bpm/rx_cpubpf/rx_cpumem/ocd_top/ocd_fine/clk_gate_kik1rtxreg_reg_1/latch/CLK TM6BUFCLX60
##legalize_placement -incremental

##size_cell pericore/mp200/elc_0/CTSTM6BUFCLX100_G3B1I1 TM6BUFCLX100
#modify begin LWH
source icc_zrt_scripts/set_source_latency.tcl
source ./FILES/PR/add_path_margin_for_flash.tcl
#remove_bounds -name mp200_rcr
#modify end LWH
##################################################################################
### For set Hold fixing (if needed)
##################################################################################

#if {$MCMM_MODE == "false" } {
#  echo "SCRIPT-Info : Set Fix Hold"
#  set_fix_hold [all_clocks]
#  } else {
#   echo "SCRIPT-Info : Set Fix Hold on MCMM"
#   set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
#   foreach scenario [all_active_scenarios] {
#     current_scenario $scenario
#     set_fix_hold [all_clocks]
#   };
#}

##################################################################################
### CTS aware DFT Optimize
##################################################################################

#remove_scan_def	
#read_def $ICC_IN_SCAN_DEF_FILE	
#set_optimize_dft_options -repartitioning_method adaptive
#optimize_dft -clock_buffer	
#report_scan_chain >  $REPORTS_DIR/scan_chain_postCTS_ordering.rpt	

########################################################################################
### Only DRC fixing : DEBUG_MODE ONLY !!!
########################################################################################

if {$RENESAS_DEBUG} {
  psynopt -only_design_rule
  if {$MCMM_MODE == "true"} {
    echo "SCRIPT-Info : MCMM_MODE report_timing design_rule_only"

    report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_max
    report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_delay -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_max_ver
    report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_min
    report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_min_ver
    report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_trans
    report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_cap
    report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_fanout
    report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

    report_timing -nosplit -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max -derate -attributes -voltage > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.max.tim
    report_timing -nosplit -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min -derate -attributes -voltage > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.min.tim
    report_timing -nosplit -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded -slack_lesser_than 0.0 -derate -attributes -voltage -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.max.tim_full
    report_timing -nosplit -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded -slack_lesser_than 0.0 -derate -attributes -voltage -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.min.tim_full

  } else {
    echo "SCRIPT-Info : Single mode report_timing"
    report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_max
    report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_min
    report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_trans
    report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_cap
    report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.vio_fanout
    report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

    report_timing -nosplit -capacitance -transition_time -input_pins -nets -delay max -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.max.tim
    report_timing -nosplit -capacitance -transition_time -input_pins -nets -delay min -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.min.tim
    report_timing -nosplit -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.max.tim_full
    report_timing -nosplit -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}_DESIGN_RULE.min.tim_full
  }
}

# START TSURUSAKI-san SETTING #########################

printTime
#set mv_continue_on_opcond_mismatch true
extract_rc
psynopt -congestion -area_recovery
#report_qor > post_cts_setup.qor

#RM_ORG#printTime
#RM_ORG#
#RM_ORG#psynopt -power -congestion 
#RM_ORG#
#RM_ORG#printTime

#  END TSURUSAKI-san SETTING #########################


##################################################################################
### Connect Power & Ground for non-MV and MV-mode
##################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie}
  }
}

if {$MV_MODE == "true" } {
  echo "SCRIPT-Info : MV_MODE check_mv_design"
  check_mv_design -verbose > $REPORTS_DIR/$_CEL_SAVE_NAME.mv
}

##################################################################################
### Create Snapshot and Save
##################################################################################

save_mw_cel -as $_CEL_SAVE_NAME 
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/$_CEL_SAVE_NAME.qor_snapshot.rpt

report_qor > $REPORTS_DIR/$_CEL_SAVE_NAME.qor
report_constraints > $REPORTS_DIR/$_CEL_SAVE_NAME.con
report_design -nosplit -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.design
report_net_fanout -high_fanout > $REPORTS_DIR/$_CEL_SAVE_NAME.high_fanoutnet

##################################################################################
## Get report Vth_tario 
##################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}

if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -nosplit -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time \
                -input_pins -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim
  report_timing -nosplit -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time \
                -input_pins -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim
  report_timing -nosplit -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full
  report_timing -nosplit -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_fanout

  report_timing -nosplit -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max -attributes \
                -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim
  report_timing -nosplit -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min -attributes \
                -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim
  report_timing -nosplit -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full
  report_timing -nosplit -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full

}

report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

#### Write_Verilog
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/${DESIGN_NAME}_${_CEL_SAVE_NAME}.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 410_post_cts_opt_setup_icc

exit
---9:420_post_cts_opt_hold_icc.tcl---
##########################################################################################
## 420_post_cts_opt_hold_icc: Post CTS Optimization for Zroute
###                                                               (V08.00.00) 2012.03.09
##########################################################################################

########################################################################################
### Local variable setting
########################################################################################
#set _CEL_LOAD_NAME    420_post_cts_opt_hold_icc_hold_only 
set _CEL_LOAD_NAME    410_post_cts_opt_setup_icc
set _CEL_SAVE_NAME    420_post_cts_opt_hold_icc
set _CEL_SCRIPT_ID    420

echo "Defined-Info : _CEL_LOAD_NAME " $_CEL_LOAD_NAME
echo "Defined-Info : _CEL_SAVE_NAME " $_CEL_SAVE_NAME
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1
echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG

if {$RENESAS_DEBUG} {
  set enable_page_mode true
  set sh_enable_page_mode true
}

#######################################################################################
### Print variables for mode switching
#######################################################################################

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime
 
open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#modify begin LWH
source -echo temp_chg.tcl
#modify end LWH

open_mw_cel ${_CEL_SAVE_NAME}_TMP

##################################################################################
### Optimization Common Session Options - set in all sessions
##################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl

##################################################################################
### Source Post CTS Options
##################################################################################

source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}


source -echo $PREROUTE_DONT_TOUCH
##################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, 
### clock cells
##################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  source -echo  $ICC_IN_DONT_USE_FILE
}

##################################################################################
### Post CTS Setup Optimization Flow
##################################################################################

set compile_instance_name_prefix icc_postcts_hold

##################################################################################
### Remove current SDC and set again
##################################################################################

##################################################################################
source -echo  ${SDC_DT_1}
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl


source -echo ${MAX_CAP_F}
#################################################################################

if {$MCMM_MODE == "false"} {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
	source FILES/PR/uncertainty_chg.tcl
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
source icc_zrt_scripts/set_source_latency.tcl
source ./FILES/PR/add_path_margin_for_flash.tcl
#modify end LWH

#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160821/kobetsu_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160821/ac_PreECO001_cmd.tcl

##################################################################################
### psynopt for hold
##################################################################################
legalize_placement -effort medium -eco -incremental
check_legality -v

printTime
#set mv_continue_on_opcond_mismatch true

#RM_ORG#psynopt -only_hold_time
#modify begin LWH
#redirect -variable tmp {remove_keepout_margin [get_flat_cells cpusys/bpm/rx_cpubpf/rx_cpumem/ocd_top/ocd_jif/* -filter "ref_name=~*FF*"]}
#source ../fix_fineclk_hold.tcl
set prefer_buf [get_lib_cells */*BUFX* -filter "area < 4.1"]
set_prefer -min  $prefer_buf
#set_fix_hold_options -prioritize_tns -preferred_buffer 
#set compile_instance_name_prefix icc_postcts_hold_only
#psynopt -only_hold_time 
#save_mw_cel -as ${_CEL_SAVE_NAME}_hold_only
set compile_instance_name_prefix icc_postcts_hold
#redirect -variable tmp {remove_keepout_margin [get_flat_cells *]}
#set cell_col [get_cells -within  {{149.240 -548.910} {356.400 42.960}}]
#set num 0
#set padding_cell []
#foreach_in_coll elm [get_flat_cells $cell_col -filter "number_of_pins == 4 && ref_name !~ *DFF* && ref_name !~ *GTD* && ref_name !~ *LAT*"] {
#	  set area [get_attr $elm area]
#	  if {$area < 6.913} {
#	    set_keepout_margin -type soft -outer {0.48 0 0.48 0} $elm
#	    set padding_cell [add_to_coll $padding_cell $elm]
#	    incr num
#	  } 
#}
#foreach_in_coll elm [get_flat_cells $cell_col -filter "number_of_pins == 5 && ref_name !~ *DFF* && ref_name !~ *GTD* && ref_name !~ *LAT*"] {
#	  set area [get_attr $elm area]
#	  if {$area < 8.2945} {
#	    set_keepout_margin -type soft -outer {0.48 0 0.48 0} $elm
#	    set padding_cell [add_to_coll $padding_cell $elm]
#	    incr num
#	  } 
#}
remove_placement_blockage *partial*tmp*
psynopt -congestion -area_recovery
redirect -variable tmp {remove_keepout_margin [get_flat_cells *]}
#modify end LWH

printTime

echo "Hold_Buf_Number  : [ sizeof_collection [get_cells -hier *${compile_instance_name_prefix}* ] ] \
      (prefix:${compile_instance_name_prefix})"

##################################################################################
### Connect Power & Ground for non-MV and MV-mode
##################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie}
  }
}

if {$MV_MODE == "true" } {
  echo "SCRIPT-Info : MV_MODE check_mv_design"
  check_mv_design -verbose > $REPORTS_DIR/$_CEL_SAVE_NAME.mv

}

##################################################################################
### Create Snapshot and Save
##################################################################################

save_mw_cel -as $_CEL_SAVE_NAME 
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/$_CEL_SAVE_NAME.qor_snapshot.rpt

report_qor > $REPORTS_DIR/$_CEL_SAVE_NAME.qor
report_constraints > $REPORTS_DIR/$_CEL_SAVE_NAME.con
report_design -nosplit -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.design
report_net_fanout -high_fanout > $REPORTS_DIR/$_CEL_SAVE_NAME.high_fanoutnet

##################################################################################
## Get report Vth_tario
##################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time \
                -input_pins -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time \
                -input_pins -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate  > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate  > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max -attributes \
                -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min -attributes \
                -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full

}

report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 420_post_cts_opt_hold_icc
exit
---10:420_post_cts_opt_hold_icc.tcl_bk---
##########################################################################################
## 420_post_cts_opt_hold_icc: Post CTS Optimization for Zroute
###                                                               (V08.00.00) 2012.03.09
##########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    410_post_cts_opt_setup_icc
set _CEL_SAVE_NAME    420_post_cts_opt_hold_icc
set _CEL_SCRIPT_ID    420

echo "Defined-Info : _CEL_LOAD_NAME " $_CEL_LOAD_NAME
echo "Defined-Info : _CEL_SAVE_NAME " $_CEL_SAVE_NAME
echo "Defined-Info : _CEL_SCRIPT_ID " $_CEL_SCRIPT_ID

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1
echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG

if {$RENESAS_DEBUG} {
  set enable_page_mode true
  set sh_enable_page_mode true
}

#######################################################################################
### Print variables for mode switching
#######################################################################################

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime
 
open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#modify begin LWH
source -echo temp_chg.tcl
#modify end LWH

open_mw_cel ${_CEL_SAVE_NAME}_TMP

##################################################################################
### Optimization Common Session Options - set in all sessions
##################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl

##################################################################################
### Source Post CTS Options
##################################################################################

source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}


source ./FILES/FP/PreRoute_DONT_TOUCH_140709.tcl
##################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, 
### clock cells
##################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  source -echo  $ICC_IN_DONT_USE_FILE
}

##################################################################################
### Post CTS Setup Optimization Flow
##################################################################################

set compile_instance_name_prefix icc_postcts_hold

##################################################################################
### Remove current SDC and set again
##################################################################################

##################################################################################
source -echo  ${SDC_DT_1}
source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl


source -echo ${MAX_CAP_F}
#################################################################################

if {$MCMM_MODE == "false"} {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
source icc_zrt_scripts/set_source_latency.tcl
#modify end LWH

##################################################################################
### psynopt for hold
##################################################################################
legalize_placement -effort medium -eco -incremental
check_legality -v

printTime
#set mv_continue_on_opcond_mismatch true

#RM_ORG#psynopt -only_hold_time
#modify begin LWH
redirect -variable tmp {remove_keepout_margin [get_flat_cells cpusys/bpm/rx_cpubpf/rx_cpumem/ocd_top/ocd_jif/* -filter "ref_name=~*FF*"]}
source ../fix_fineclk_hold.tcl
set prefer_buf [get_lib_cells */*BUFX* -filter "area < 4.1"]
set_prefer -min  $prefer_buf
set_fix_hold_options -prioritize_tns -preferred_buffer 
set compile_instance_name_prefix icc_postcts_hold_only
psynopt -only_hold_time 
save_mw_cel -as ${_CEL_SAVE_NAME}_hold_only
set compile_instance_name_prefix icc_postcts_hold
#redirect -variable tmp {remove_keepout_margin [get_flat_cells *]}
#set cell_col [get_cells -within  {{149.240 -548.910} {356.400 42.960}}]
#set num 0
#set padding_cell []
#foreach_in_coll elm [get_flat_cells $cell_col -filter "number_of_pins == 4 && ref_name !~ *DFF* && ref_name !~ *GTD* && ref_name !~ *LAT*"] {
#	  set area [get_attr $elm area]
#	  if {$area < 6.913} {
#	    set_keepout_margin -type soft -outer {0.48 0 0.48 0} $elm
#	    set padding_cell [add_to_coll $padding_cell $elm]
#	    incr num
#	  } 
#}
#foreach_in_coll elm [get_flat_cells $cell_col -filter "number_of_pins == 5 && ref_name !~ *DFF* && ref_name !~ *GTD* && ref_name !~ *LAT*"] {
#	  set area [get_attr $elm area]
#	  if {$area < 8.2945} {
#	    set_keepout_margin -type soft -outer {0.48 0 0.48 0} $elm
#	    set padding_cell [add_to_coll $padding_cell $elm]
#	    incr num
#	  } 
#}
remove_placement_blockage *partial*tmp*
psynopt -congestion -area_recovery
redirect -variable tmp {remove_keepout_margin [get_flat_cells *]}
#modify end LWH

printTime

echo "Hold_Buf_Number  : [ sizeof_collection [get_cells -hier *${compile_instance_name_prefix}* ] ] \
      (prefix:${compile_instance_name_prefix})"

##################################################################################
### Connect Power & Ground for non-MV and MV-mode
##################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie}
  }
}

if {$MV_MODE == "true" } {
  echo "SCRIPT-Info : MV_MODE check_mv_design"
  check_mv_design -verbose > $REPORTS_DIR/$_CEL_SAVE_NAME.mv

}

##################################################################################
### Create Snapshot and Save
##################################################################################

save_mw_cel -as $_CEL_SAVE_NAME 
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/$_CEL_SAVE_NAME.qor_snapshot.rpt

report_qor > $REPORTS_DIR/$_CEL_SAVE_NAME.qor
report_constraints > $REPORTS_DIR/$_CEL_SAVE_NAME.con
report_design -nosplit -physical > $REPORTS_DIR/$_CEL_SAVE_NAME.design
report_net_fanout -high_fanout > $REPORTS_DIR/$_CEL_SAVE_NAME.high_fanoutnet

##################################################################################
## Get report Vth_tario
##################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time \
                -input_pins -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time \
                -input_pins -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate  > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate  > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max -attributes \
                -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min -attributes \
                -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/$_CEL_SAVE_NAME.min.tim_full

}

report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 420_post_cts_opt_hold_icc
exit
---11:510_init_route_zrt_icc_no_mcmm.tcl---
###########################################################################################
### 510_init_route_icc: Initial Routing for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################

########################################################################################
### Local variable setting
########################################################################################
#set _CEL_LOAD_NAME    420_post_cts_opt_hold_icc
set _CEL_LOAD_NAME    200_place_opt_icc
set _CEL_SAVE_NAME    510_init_route_icc
set _CEL_SCRIPT_ID    510

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"


###############################
# DEFINE CUSTOM SETTING 
###############################

# REDUNDANT VIA
set RENESAS_REDUNDANT_VIA_TCL   "" ; # ./tcl/OptimizeContact_RC04LP_7LM.cmd
# FREEZE NET
set RENESAS_DONT_ROUTE_NET      "" ; # ./sample/dont_route_net_tmp.tcl
# SPARE CELL
set RENESAS_SPARE_CEL_LIST      "" ; # ./sample/insert_sparecell_list_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL 	"" ; # ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_REDUNDANT_VIA_TCL $RENESAS_REDUNDANT_VIA_TCL"
echo "Defined-Info : RENESAS_DONT_ROUTE_NET    $RENESAS_DONT_ROUTE_NET"
echo "Defined-Info : RENESAS_SPARE_CEL_LIST    $RENESAS_SPARE_CEL_LIST"
echo "Defined-Info : RENESAS_SET_OCV_TCL       $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################

set RENESAS_DEBUG 0

#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "SCRIPT-Info (Global) : ICC_FIX_ANTENNA  == " $ICC_FIX_ANTENNA
echo "#################################################################################"

printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

##  add ungroup for sta gxs 130201 ##
##ungroup [get_cells -all -hierarchical -filter {ref_name== "ucmt2mintcrl1_0"}]
##ungroup [get_cells -all -hierarchical -filter {ref_name== "ucmt2mintcrl1_1"}]

##  add end  ##

########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
####modify begin kevin
####source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl
####modify end kevin


source -echo ${MAX_CAP_F}
##################################################################################

#if {$MCMM_MODE == "false" } {
#  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
#  remove_sdc
#  read_sdc $ICC_IN_PROPA_SDC_FILE
#  set_propagated_clock [all_clocks]
#  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
#  source $RENESAS_SET_OCV_TCL
###  set_fix_hold [all_clocks]
#  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
#    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
#  }
#} else {
#  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
#  remove_sdc
#  remove_scenario -all
#  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
#  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    set_propagated_clock [all_clocks]
#	source uncertainty_chg.tcl
#    source ./icc_zrt_scripts/design_specific_icc.tcl
#    source $RENESAS_SET_OCV_TCL
###    set_fix_hold [all_clocks]
#  };
#}
#modify begin LWH
source -echo icc_zrt_scripts/set_source_latency.tcl
#modify end LWH
########################################################################################  
### Pre-Route Checks
### Check for Ideal Nets
########################################################################################  

set num_ideal [sizeof [all_ideal_nets]]
if {$num_ideal >= 1} {echo "SCRIPT-ERR-Info: $num_ideal Nets are ideal prior to route_opt. Please investigate."}

########################################################################################
### Check for HFNs
########################################################################################

set hfn_thres "41 101 501 "
foreach thres $hfn_thres {
  set num_hfn [sizeof [all_high_fanout -nets -threshold $thres]]
  echo "SCRIPT-Info: Number of nets with fanout > $thres = $num_hfn"
  if {$thres == 501 && $num_hfn >=1} {
    echo "SCRIPT-ERR-Info: $num_hfn Nets with fanout > 500 exist prior to route_opt - Please check if marked ideal - possibly add buffer tree"
  }
}


########################################################################################
### some checks upfront 
### check_routeability
########################################################################################

report_preferred_routing_direction

printTime

########################################################################################
### route first the design 
########################################################################################

report_tlu_plus_files 

########################################################################################
### SET DONT ROUT NET
########################################################################################

if {$RENESAS_DONT_ROUTE_NET != ""} {
  echo "SCRIPT-Info : Set Dont Route net :$RENESAS_DONT_ROUTE_NET "
  source -echo $RENESAS_DONT_ROUTE_NET
}

source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Concurrent redundant via insertion setting 
########################################################################################

if {$RENESAS_REDUNDANT_VIA_TCL != "" && [file exists [which $RENESAS_REDUNDANT_VIA_TCL]]} {
  echo "SCRIPT-Info : Insert_redundant_vias with a custom rule :$RENESAS_REDUNDANT_VIA_TCL "
  source -e -v $RENESAS_REDUNDANT_VIA_TCL
  set_route_zrt_common_options -post_detail_route_redundant_via_insertion medium
} else {
  #define_zrt_redundant_vias
  set_route_zrt_common_options -post_detail_route_redundant_via_insertion medium
  echo "SCRIPT-Info : Insert_redundant_vias automaricaly"
}


printTime

########################################################################################
### Antenna Fixing
########################################################################################

printTime 

if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting ANTENNA Fixing"
  source -echo $ANTENNA_RULES_FILE
  report_antenna_rules
}

if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true \
                               -diode_libcell_names $ICC_ROUTING_DIODES
}

printTime

########################################################################################
###  INSERT SPARE CELL#                   
########################################################################################

if {$RENESAS_SPARE_CEL_LIST != ""} {
  echo "SCRIPT-Info : Insert Spare Cell :$RENESAS_SPARE_CEL_LIST"
  source -echo $RENESAS_SPARE_CEL_LIST	
  foreach {mas num} $spare_list {
    insert_spare_cells -lib_cell $mas -cell_name spare_cell_${mas} -num_instances $num -tie
  }
  spread_spare_cells [get_cells spare_cell_*]
# spread_spare_cells [get_cells spare_cell_*] -bbox  {-3100.000 -2500.000 1500.000 2400.000}
  legalize_placement -incremental
}

#save_mw_cel -as ${_CEL_SAVE_NAME}_SPARE

########################################################################################
### Optimizing wirelenght and vias . Add the switch : -optimize_wire_via_effort_level to 
### the set_route_zrt_detail_options command.
### Use default low for your runs except when you run double via insertion,
### use in that case medium effort to reduce the initail amount of vias.
###
###   set_route_zrt_detail_options -optimize_wire_via_effort_level medium
########################################################################################

set_route_zrt_common_options -standard_cell_blockage_as_thin true

set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#set_net_routing_rule -rule default   [get_attribute [get_nets -all -hierarchical -filter "var_route_rule!=default"] 

#set_route_zrt_common_options -connect_within_pins {{m1 via_wire_standard_cell_pins}} ; # add '12/03/02
set_route_zrt_common_options -connect_within_pins_by_layer_name  {{M1 off}}


#TMP BEGIN#
##remove_net_routing cpusys/ho_fihfl
#remove_net_routing cpusys/syspf/oli_hococlk
#TMP END#
#modify begin LWH
####################################################################################################
#route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 5
####################################################################################################
redirect -v	info -tee	{verify_zrt_route -nets [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"] -report_all_open_nets true -drc false -antenna false}
set net_col []
foreach  line [split $info "\n"] {
 if {[regexp {net\((.*)\) has floating ports} $line tmp net]} {
      echo $net
	  set net_col [add_to_coll $net_col [get_flat_nets $net]]
	}
}
route_zrt_eco  -nets $net_col -open_net_driven true -utilize_dangling_wires true -reroute modified_nets_first_then_others 
#modify end LWH

#remove_route_guide route_guide_M5_DF_USB
##You.J##set_net_routing_rule  {cpusys/ho_fihfl}  -rule {CLOCK_NET}
##You.J##set_net_routing_layer_constraints {cpusys/ho_fihfl} -max_layer_name M5 -min_layer_name M3
##You.J##route_zrt_group -nets {cpusys/ho_fihfl}
set_net_routing_rule  {cpusys/syspf/oli_hococlk}  -rule {CLOCK_NET}
set_net_routing_layer_constraints {oli_hococlk} -max_layer_name M5 -min_layer_name M3
route_zrt_group -nets {cpusys/syspf/oli_hococlk}

set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

###########################################
# YUUSEN-HAISEN ###########################
###########################################
source -echo ./FILES/FP/IDET_ROUTE.tcl

##source -echo ./COMP_ROUTE.tcl
save_mw_cel -as 510_COMP
###########################################

set cell_under_5 []
set cell_under_10 []
foreach_in_coll elm [get_flat_cell -filter "ref_name=~T*6* && ref_name!~DFF"] {
 if {[regexp {X([\d]+)$} [get_attr $elm ref_name] tmp size]} {
  if {[regexp {^0([\d])} $size tmp size_new]} {set size $size_new}
  if {$size < 5} {set cell_under_5 [add_to_coll $cell_under_5 $elm]} 
  #if {$size < 6} {set cell_under_5 [add_to_coll $cell_under_5 $elm]} elseif {$size < 10} {set cell_under_10 [add_to_coll $cell_under_10 $elm]}
 }
}

foreach_in_coll elm $cell_under_5 {
    set new_name [get_object_name $elm]
    puts "$new_name"
}
route_zrt_group -nets [get_flat_nets -of [get_flat_pins -of $cell_under_5 -filter "direction==out"]]


define_routing_rule FLASH_NET -default_reference_rule -taper_level 0 -taper_distance 1 \
        -widths   {M1 0.24 M2 0.24 M3 0.24 M4 0.24 M5 0.96} \
        -spacings {M1 0.72 M2 0.72 M3 0.72 M4 0.72 M5 2.88}
foreach_in_coll elm [get_flat_pins -of [get_flat_cells {cpusys/bpm/rx_flash/flash_mem/flash_code*}] -filter "direction == out"] {
 if {[get_attr [get_lib_pins -of $elm] max_capacitance] < 0.11} {
      set_net_routing_rule -rule FLASH_NET [get_flat_nets -of $elm]
 }
}

define_routing_rule CACHE_NET -default_reference_rule -taper_level 0 -taper_distance 1 -spacings {M4 0.72}

###########################################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
###########################################

#####modify begin kevin
#####modify begin LWH
#######set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#######set_route_zrt_common_options -concurrent_redundant_via_mode off
#####source -echo ../TCL/route_step1.tcl
#####modify end LWH
#####modify end kevin

###########################################
#route_opt -initial_route_only
route_zrt_global

save_mw_cel -as ${_CEL_SAVE_NAME}_global

route_zrt_track
route_zrt_detail
remove_route_guide RG_TMP*   


####create_route_guide  \
####	-coordinate {{381.600 349.380} {615.420 539.760}}  \
####	-horizontal_track_utilization 95  \
####	-vertical_track_utilization 95 \
####	-name RG_FLASH
##remove_bounds flash_bounds


##########################################

printTime

########################################################################################
### additional Search & Repair
########################################################################################

route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40

#modify begin LWH
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
set_route_zrt_detail_options -force_max_number_iterations true
route_zrt_detail -incremental true -max_number_iterations 40
route_zrt_detail -incremental true -max_number_iterations 60
save_mw_cel -as ${_CEL_SAVE_NAME}_90
##set_route_zrt_detail_options -force_max_number_iterations false
#####route_zrt_detail -incremental true -max_number_iterations 40
source -echo ../TCL/fix_short.tcl
route_zrt_detail -incremental true -max_number_iterations 50
save_mw_cel -as ${_CEL_SAVE_NAME}_fix_short_1
source -echo ../TCL/fix_short.tcl
route_zrt_detail -incremental true -max_number_iterations 50
save_mw_cel -as ${_CEL_SAVE_NAME}_fix_short_2
######save_mw_cel -as ${_CEL_SAVE_NAME}_90
#modify end LWH
route_zrt_detail -incremental true -max_number_iterations 100

##source ../TCL/fix_short.tcl
##route_zrt_detail -incremental true -max_number_iterations 40
##route_zrt_detail -incremental true -max_number_iterations 100
verify_zrt_route -report_all_open_nets true


########################################################################################
### Create Snapshot and Save
########################################################################################

save_mw_cel -as $_CEL_SAVE_NAME
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet

if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max -attributes \
                -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min -attributes \
                -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


current_scenario USER1_MAX_HT_SETUP

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 510_init_route_icc

exit
---12:510_init_route_zrt_icc.tcl---
###########################################################################################
### 510_init_route_icc: Initial Routing for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    420_post_cts_opt_hold_icc
set _CEL_SAVE_NAME    510_init_route_icc
set _CEL_SCRIPT_ID    510

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"


###############################
# DEFINE CUSTOM SETTING 
###############################

# REDUNDANT VIA
set RENESAS_REDUNDANT_VIA_TCL   "" ; # ./tcl/OptimizeContact_RC04LP_7LM.cmd
# FREEZE NET
set RENESAS_DONT_ROUTE_NET      "" ; # ./sample/dont_route_net_tmp.tcl
# SPARE CELL
set RENESAS_SPARE_CEL_LIST      "" ; # ./sample/insert_sparecell_list_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL 	"" ; # ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_REDUNDANT_VIA_TCL $RENESAS_REDUNDANT_VIA_TCL"
echo "Defined-Info : RENESAS_DONT_ROUTE_NET    $RENESAS_DONT_ROUTE_NET"
echo "Defined-Info : RENESAS_SPARE_CEL_LIST    $RENESAS_SPARE_CEL_LIST"
echo "Defined-Info : RENESAS_SET_OCV_TCL       $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################

set RENESAS_DEBUG 0

#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "SCRIPT-Info (Global) : ICC_FIX_ANTENNA  == " $ICC_FIX_ANTENNA
echo "#################################################################################"

printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

##  add ungroup for sta gxs 130201 ##
##ungroup [get_cells -all -hierarchical -filter {ref_name== "ucmt2mintcrl1_0"}]
##ungroup [get_cells -all -hierarchical -filter {ref_name== "ucmt2mintcrl1_1"}]

##  add end  ##

########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
####modify begin kevin
####source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl
####modify end kevin


source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
##  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
	source uncertainty_chg.tcl
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
##    set_fix_hold [all_clocks]
  };
}
#modify begin LWH
source -echo icc_zrt_scripts/set_source_latency.tcl
#modify end LWH
########################################################################################  
### Pre-Route Checks
### Check for Ideal Nets
########################################################################################  

set num_ideal [sizeof [all_ideal_nets]]
if {$num_ideal >= 1} {echo "SCRIPT-ERR-Info: $num_ideal Nets are ideal prior to route_opt. Please investigate."}

########################################################################################
### Check for HFNs
########################################################################################

set hfn_thres "41 101 501 "
foreach thres $hfn_thres {
  set num_hfn [sizeof [all_high_fanout -nets -threshold $thres]]
  echo "SCRIPT-Info: Number of nets with fanout > $thres = $num_hfn"
  if {$thres == 501 && $num_hfn >=1} {
    echo "SCRIPT-ERR-Info: $num_hfn Nets with fanout > 500 exist prior to route_opt - Please check if marked ideal - possibly add buffer tree"
  }
}


########################################################################################
### some checks upfront 
### check_routeability
########################################################################################

report_preferred_routing_direction

printTime

########################################################################################
### route first the design 
########################################################################################

report_tlu_plus_files 

########################################################################################
### SET DONT ROUT NET
########################################################################################

if {$RENESAS_DONT_ROUTE_NET != ""} {
  echo "SCRIPT-Info : Set Dont Route net :$RENESAS_DONT_ROUTE_NET "
  source -echo $RENESAS_DONT_ROUTE_NET
}

source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Concurrent redundant via insertion setting 
########################################################################################

if {$RENESAS_REDUNDANT_VIA_TCL != "" && [file exists [which $RENESAS_REDUNDANT_VIA_TCL]]} {
  echo "SCRIPT-Info : Insert_redundant_vias with a custom rule :$RENESAS_REDUNDANT_VIA_TCL "
  source -e -v $RENESAS_REDUNDANT_VIA_TCL
  set_route_zrt_common_options -post_detail_route_redundant_via_insertion medium
} else {
  #define_zrt_redundant_vias
  set_route_zrt_common_options -post_detail_route_redundant_via_insertion medium
  echo "SCRIPT-Info : Insert_redundant_vias automaricaly"
}


printTime

########################################################################################
### Antenna Fixing
########################################################################################

printTime 

if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting ANTENNA Fixing"
  source -echo $ANTENNA_RULES_FILE
  report_antenna_rules
}

if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true \
                               -diode_libcell_names $ICC_ROUTING_DIODES
}

printTime

########################################################################################
###  INSERT SPARE CELL#                   
########################################################################################

if {$RENESAS_SPARE_CEL_LIST != ""} {
  echo "SCRIPT-Info : Insert Spare Cell :$RENESAS_SPARE_CEL_LIST"
  source -echo $RENESAS_SPARE_CEL_LIST	
  foreach {mas num} $spare_list {
    insert_spare_cells -lib_cell $mas -cell_name spare_cell_${mas} -num_instances $num -tie
  }
  spread_spare_cells [get_cells spare_cell_*]
# spread_spare_cells [get_cells spare_cell_*] -bbox  {-3100.000 -2500.000 1500.000 2400.000}
  legalize_placement -incremental
}

#save_mw_cel -as ${_CEL_SAVE_NAME}_SPARE

########################################################################################
### Optimizing wirelenght and vias . Add the switch : -optimize_wire_via_effort_level to 
### the set_route_zrt_detail_options command.
### Use default low for your runs except when you run double via insertion,
### use in that case medium effort to reduce the initail amount of vias.
###
###   set_route_zrt_detail_options -optimize_wire_via_effort_level medium
########################################################################################

set_route_zrt_common_options -standard_cell_blockage_as_thin true

set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#set_net_routing_rule -rule default   [get_attribute [get_nets -all -hierarchical -filter "var_route_rule!=default"] 

#set_route_zrt_common_options -connect_within_pins {{m1 via_wire_standard_cell_pins}} ; # add '12/03/02
set_route_zrt_common_options -connect_within_pins_by_layer_name  {{M1 off}}


#TMP BEGIN#
##remove_net_routing cpusys/ho_fihfl
remove_net_routing cpusys/syspf/oli_hococlk
#TMP END#
#modify begin LWH
####################################################################################################
#route_zrt_group -all_clock_nets -reuse_existing_global_route true -max_detail_route_iterations 5
####################################################################################################
redirect -v	info -tee	{verify_zrt_route -nets [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"] -report_all_open_nets true -drc false -antenna false}
set net_col []
foreach  line [split $info "\n"] {
 if {[regexp {net\((.*)\) has floating ports} $line tmp net]} {
      echo $net
	  set net_col [add_to_coll $net_col [get_flat_nets $net]]
	}
}
route_zrt_eco  -nets $net_col -open_net_driven true -utilize_dangling_wires true -reroute modified_nets_first_then_others 
#modify end LWH

#remove_route_guide route_guide_M5_DF_USB
##You.J##set_net_routing_rule  {cpusys/ho_fihfl}  -rule {CLOCK_NET}
##You.J##set_net_routing_layer_constraints {cpusys/ho_fihfl} -max_layer_name M5 -min_layer_name M3
##You.J##route_zrt_group -nets {cpusys/ho_fihfl}
set_net_routing_rule  {cpusys/syspf/oli_hococlk}  -rule {CLOCK_NET}
set_net_routing_layer_constraints {oli_hococlk} -max_layer_name M5 -min_layer_name M3
route_zrt_group -nets {cpusys/syspf/oli_hococlk}

set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

###########################################
# YUUSEN-HAISEN ###########################
###########################################
source -echo ./FILES/FP/IDET_ROUTE.tcl

##source -echo ./COMP_ROUTE.tcl
save_mw_cel -as 510_COMP
###########################################

set cell_under_5 []
set cell_under_10 []
foreach_in_coll elm [get_flat_cell -filter "ref_name=~T*6* && ref_name!~DFF"] {
 if {[regexp {X([\d]+)$} [get_attr $elm ref_name] tmp size]} {
  if {[regexp {^0([\d])} $size tmp size_new]} {set size $size_new}
  if {$size < 5} {set cell_under_5 [add_to_coll $cell_under_5 $elm]} 
  #if {$size < 6} {set cell_under_5 [add_to_coll $cell_under_5 $elm]} elseif {$size < 10} {set cell_under_10 [add_to_coll $cell_under_10 $elm]}
 }
}

foreach_in_coll elm $cell_under_5 {
    set new_name [get_object_name $elm]
    puts "$new_name"
}
route_zrt_group -nets [get_flat_nets -of [get_flat_pins -of $cell_under_5 -filter "direction==out"]]


define_routing_rule FLASH_NET -default_reference_rule -taper_level 0 -taper_distance 1 \
        -widths   {M1 0.24 M2 0.24 M3 0.24 M4 0.24 M5 0.96} \
        -spacings {M1 0.72 M2 0.72 M3 0.72 M4 0.72 M5 2.88}
foreach_in_coll elm [get_flat_pins -of [get_flat_cells {cpusys/bpm/rx_flash/flash_mem/flash_code*}] -filter "direction == out"] {
 if {[get_attr [get_lib_pins -of $elm] max_capacitance] < 0.11} {
      set_net_routing_rule -rule FLASH_NET [get_flat_nets -of $elm]
 }
}

define_routing_rule CACHE_NET -default_reference_rule -taper_level 0 -taper_distance 1 -spacings {M4 0.72}

###########################################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
###########################################

#####modify begin kevin
#####modify begin LWH
#######set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#######set_route_zrt_common_options -concurrent_redundant_via_mode off
#####source -echo ../TCL/route_step1.tcl
#####modify end LWH
#####modify end kevin

###########################################
#route_opt -initial_route_only
route_zrt_global

save_mw_cel -as ${_CEL_SAVE_NAME}_global

route_zrt_track
route_zrt_detail
remove_route_guide RG_TMP*   


####create_route_guide  \
####	-coordinate {{381.600 349.380} {615.420 539.760}}  \
####	-horizontal_track_utilization 95  \
####	-vertical_track_utilization 95 \
####	-name RG_FLASH
##remove_bounds flash_bounds


##########################################

printTime

########################################################################################
### additional Search & Repair
########################################################################################

route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40

#modify begin LWH
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
set_route_zrt_detail_options -force_max_number_iterations true
route_zrt_detail -incremental true -max_number_iterations 40
route_zrt_detail -incremental true -max_number_iterations 60
save_mw_cel -as ${_CEL_SAVE_NAME}_90
##set_route_zrt_detail_options -force_max_number_iterations false
#####route_zrt_detail -incremental true -max_number_iterations 40
source -echo ../TCL/fix_short.tcl
route_zrt_detail -incremental true -max_number_iterations 50
save_mw_cel -as ${_CEL_SAVE_NAME}_fix_short_1
source -echo ../TCL/fix_short.tcl
route_zrt_detail -incremental true -max_number_iterations 50
save_mw_cel -as ${_CEL_SAVE_NAME}_fix_short_2
######save_mw_cel -as ${_CEL_SAVE_NAME}_90
#modify end LWH
route_zrt_detail -incremental true -max_number_iterations 100

##source ../TCL/fix_short.tcl
##route_zrt_detail -incremental true -max_number_iterations 40
##route_zrt_detail -incremental true -max_number_iterations 100
verify_zrt_route -report_all_open_nets true


########################################################################################
### Create Snapshot and Save
########################################################################################

save_mw_cel -as $_CEL_SAVE_NAME
sh date > FLAG_END_${_CEL_SCRIPT_ID}

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet

if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max -attributes \
                -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min -attributes \
                -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


current_scenario USER1_MAX_HT_SETUP

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 510_init_route_icc

exit
---13:520_route_opt_zrt_icc.tcl---
###########################################################################################
### 520_route_opt_icc: Post Route Optimization for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    510_init_route_icc
set _CEL_SAVE_NAME    520_route_opt_icc
set _CEL_SCRIPT_ID    520

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"


########################################################################################
# DEFINE REPORT TCL FILE NAME
########################################################################################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_rato_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

###############################
# DEFIGNE CUSTOM SETTING      #
###############################

# REDUNDANT VIA
set RENESAS_REDUNDANT_VIA_TCL   "" ; # ./tcl/OptimizeContact_RC04LP_7LM.cmd

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE                == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE                  == " $MV_MODE
echo "SCRIPT-Info (Global) : ICC_REDUCE_CRITICAL_AREA == " $ICC_REDUCE_CRITICAL_AREA
echo "#################################################################################"

printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

#set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

source -echo $PREROUTE_DONT_TOUCH
##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
	source ./FILES/PR/uncertainty_chg.tcl
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
# foreach scenario [get_scenario *SETUP*] {
#   current_scenario $scenario
#   set_clock_uncertainty -setup 0.05 [all_clocks]
# };

source icc_zrt_scripts/set_source_latency.tcl
#modify end LWH
###########################################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
###########################################

set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

#### MODIFY 2013.02.19 by gaolc  #######################################################
##You.J##set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
##You.J##set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 
##You.J##set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
##You.J##set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
##You.J##
##You.J##set_net_routing_rule {clkm2s_psc} -rule {CLOCK_NET} 
##You.J##set_net_routing_rule -reroute freeze [get_flat_nets clkm2s_psc ]
########################################################################################
### start the post route optimization
########################################################################################
### modify You.J 160825 ##
remove_placement_blockage -name PB_flash_1

set compile_instance_name_prefix icc_route

########################################################################################
### route opt core command (timing / drc optimization)
########################################################################################

printTime
source ./TCL/size_cell_for_post_route.tcl
route_opt -skip_initial_route -effort high -area_recovery

printTime


########################################################################################
### additional Search & Repair
########################################################################################

#route_zrt_detail -incremental true -max_number_iterations 10
route_zrt_detail -incremental true -max_number_iterations 25


########################################################################################
### Wire Spreading
########################################################################################

if {$ICC_REDUCE_CRITICAL_AREA == "true" } {
  echo "SCRIPT-Info : starting Wire Spredding"
  printTime
  set_route_zrt_detail_options -timing_driven true

  #spread_zrt_wires -timing_preserve_setup_slack_threshold $TIMING_PRESERVE_SLACK \
  #                -timing_preserve_hold_slack_threshold $TIMING_PRESERVE_SLACK 

  printTime
}

set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high


#modify begin LWH
route_zrt_detail -incremental true -max_number_iterations 40
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
route_zrt_detail -incremental true -max_number_iterations 40
route_zrt_detail -incremental true -max_number_iterations 80
#modify end LWH
#verify_zrt_route -report_all_open_nets true
redirect -v	info -tee	{verify_zrt_route -nets [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"] -report_all_open_nets true -drc false -antenna false}
set net_col []
foreach  line [split $info "\n"] {
 if {[regexp {net\((.*)\) has floating ports} $line tmp net]} {
      echo $net
	  set net_col [add_to_coll $net_col [get_flat_nets $net]]
	}
}
route_zrt_eco  -nets $net_col -open_net_driven true -utilize_dangling_wires true -reroute modified_nets_first_then_others

########################################################################################
### Redundant Via
########################################################################################
printTime

if {$RENESAS_REDUNDANT_VIA_TCL != "" && [file exists [which $RENESAS_REDUNDANT_VIA_TCL]]} {
  source -e -v $RENESAS_REDUNDANT_VIA_TCL
}

########################################################################################
### Fix Isolated Via
### fix_isolated_via command cannot check rules per layer in Zroute.
########################################################################################

#fix_isolated_via -isolated_via_spacing n -isolated_via_quadrant_spacing n


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      echo "SCRIPT-Info : Insert Tie Cell "
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}

printTime


########################################################################################
### Save
########################################################################################

save_mw_cel -as $_CEL_SAVE_NAME
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT_INC

change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
#sh date > 520_route_opt_icc


########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}

########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet

if {$MCMM_MODE == "true"} { 

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}

##################################################################################
## Report Clock Tree
##################################################################################
current_scenario USER1_MAX_HT_SETUP

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock



##You.J###### Write_Verilog
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/${DESIGN_NAME}_${_CEL_SAVE_NAME}.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC






close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 520_route_opt_icc

exit
---14:521_route_opt_zrt_icc.tcl---
###########################################################################################
### 520_route_opt_icc: Post Route Optimization for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_SAVE_NAME    521_route_opt_icc
set _CEL_SCRIPT_ID    521

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}


#modify begin LWH
# foreach scenario [get_scenario *SETUP*] {
#   current_scenario $scenario
#   set_clock_uncertainty -setup 0.05 [all_clocks]
# };

source icc_zrt_scripts/set_source_latency.tcl
#modify end LWH


########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_postroute

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################
##Add 2015.03.04 for Dont touch Net Routing.
##You.J#remove_net_routing [ get_nets -all -seg RTBFG]


#modify begin LWH
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#modify end LWH

#### MODIFY 2013.02.19 by gaolc  #######################################################
set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 

set_net_routing_rule {clkm2s_psc} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets clkm2s_psc ]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

##route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -incremental -only_area_recovery

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#modify begin LWH
set_route_zrt_detail_options -force_max_number_iterations true

set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high

########set_route_zrt_detail_options -antenna true
########verify_zrt_route -antenna true
route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_detail_options -antenna true
source ./TCL/fix_short.tcl
##You.J##route_opt -skip_initial_route -effort high -area_recovery -xtalk_reduction
route_opt -skip_initial_route -effort high -area_recovery -xtalk_reduction -power
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
route_zrt_detail -incremental true -max_number_iterations 40
source ./TCL/fix_short.tcl
##########set_route_zrt_detail_options -antenna false
##route_zrt_detail -incremental true -max_number_iterations 40
route_zrt_detail -incremental true -max_number_iterations 100
save_mw_cel -as ${_CEL_SAVE_NAME}_bf_ant_temp
printTime

########set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
########set_route_zrt_common_options -concurrent_redundant_via_mode off
########set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
########set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
########set_route_zrt_detail_options -optimize_wire_via_effort_level off
########
########set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
########
########if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
########  echo "SCRIPT-Info : starting ANTENNA Fixing"
########  source -echo $ANTENNA_RULES_FILE
########  report_antenna_rules
########}
########if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
########  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
########  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES -antenna_fixing_preference  use_diodes
########}
########
########## Modify for ICC Crash!
##########route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
########source ../TCL/fix_ant.tcl
########
########source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
#########modify end LWH
########

########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}

#save_mw_cel -as ${_CEL_SAVE_NAME}_bf_ant
#
#insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
#-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
#-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

########################################################################################
### Save
########################################################################################

save_mw_cel -as $_CEL_SAVE_NAME

#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

##source ./FILES/SDC/report_adcsm_130424.tcl

##You.J#### begin add Tsurume ###
##You.J#change_names -rules verilog -hierarchy
##You.J#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
##You.J#
##You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
##You.J#set verilogout_no_tri true
##You.J#
##You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
##You.J#
##You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
##You.J#
##You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

##You.J###### Write_Verilog
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/${DESIGN_NAME}_${_CEL_SAVE_NAME}.v

insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC


### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef


close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 521_route_opt_icc

exit
---15:522_route_opt_zrt_icc.tcl---
###########################################################################################
### 520_route_opt_icc: Post Route Optimization for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    521_route_opt_icc_bf_ant
set _CEL_SAVE_NAME    522_route_opt_icc
set _CEL_SCRIPT_ID    522

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}


#modify begin LWH
  foreach scenario [get_scenario *SETUP*] {
    current_scenario $scenario
    set_clock_uncertainty -setup 0.25 [all_clocks]
  };

source icc_zrt_scripts/set_source_latency.tcl
#modify end LWH


########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_postroute

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#modify begin LWH
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#modify end LWH

#### MODIFY 2013.02.19 by gaolc  #######################################################
set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 
set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 

set_net_routing_rule {clkm2s_psc} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets clkm2s_psc ]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

##route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -incremental -only_area_recovery

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#modify begin LWH
#set_route_zrt_detail_options -antenna true
#verify_zrt_route -antenna true
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_detail_options -antenna true
#source ../fix_short.tcl
#route_opt -skip_initial_route -effort high -area_recovery -xtalk_reduction
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_detail_options -antenna false
#route_zrt_detail -incremental true -max_number_iterations 40
#save_mw_cel -as ${_CEL_SAVE_NAME}_bf_ant

#source ../TCL/fix_short_final.tcl
#route_zrt_detail -incremental true -max_number_iterations 40

set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off

set_route_zrt_detail_options -antenna true -antenna_on_iteration 10
verify_zrt_route -antenna true

##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
route_zrt_detail -incremental true -max_number_iterations 40
route_zrt_detail -incremental true -max_number_iterations 80

source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
#modify end LWH


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}

insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

########################################################################################
### Save
########################################################################################

save_mw_cel -as $_CEL_SAVE_NAME

change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

source ./FILES/SDC/report_adcsm_130424.tcl

### begin add Tsurume ###
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef


close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 522_route_opt_icc

exit
---16:523_route_opt_zrt_icc.tcl---
###########################################################################################
### 520_route_opt_icc: Post Route Optimization for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_SAVE_NAME    523_route_opt_icc
set _CEL_SCRIPT_ID    523

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}


#modify begin LWH
  foreach scenario [get_scenario *SETUP*] {
    current_scenario $scenario
    set_clock_uncertainty -setup 0.25 [all_clocks]
  };

source icc_zrt_scripts/set_source_latency.tcl
#modify end LWH


########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_postroute

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#modify begin LWH
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#modify end LWH

#### MODIFY 2013.02.19 by gaolc  #######################################################
set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 
set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 

set_net_routing_rule {clkm2s_psc} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets clkm2s_psc ]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

##route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -incremental -only_area_recovery

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#modify begin LWH
#set_route_zrt_detail_options -antenna true
#verify_zrt_route -antenna true
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_detail_options -antenna true
#source ../fix_short.tcl
#route_opt -skip_initial_route -effort high -area_recovery -xtalk_reduction
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_detail_options -antenna false
#route_zrt_detail -incremental true -max_number_iterations 40
#save_mw_cel -as ${_CEL_SAVE_NAME}_bf_ant


#source ../TCL/fix_short_final.tcl
#route_zrt_detail -incremental true -max_number_iterations 40

set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off

set_route_zrt_detail_options -antenna true -antenna_on_iteration 19
verify_zrt_route -antenna true

set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion

if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting ANTENNA Fixing"
  source -echo $ANTENNA_RULES_FILE
  report_antenna_rules
}
if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
}
#route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
route_zrt_detail -incremental true -max_number_iterations 40
verify_zrt_route -antenna true
route_zrt_detail -incremental true -max_number_iterations 80

source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
#modify end LWH


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}

insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

########################################################################################
### Save
########################################################################################

save_mw_cel -as $_CEL_SAVE_NAME

change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

source ./FILES/SDC/report_adcsm_130424.tcl

### begin add Tsurume ###
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef


close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 523_route_opt_icc

exit
---17:524_route_opt_zrt_icc.tcl---
###########################################################################################
### 520_route_opt_icc: Post Route Optimization for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    521_route_opt_icc_bf_ant
set _CEL_SAVE_NAME    524_route_opt_icc
set _CEL_SCRIPT_ID    524

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}


#modify begin LWH
  foreach scenario [get_scenario *SETUP*] {
    current_scenario $scenario
    set_clock_uncertainty -setup 0.25 [all_clocks]
  };

source icc_zrt_scripts/set_source_latency.tcl
#modify end LWH


########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_postroute

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#modify begin LWH
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#modify end LWH

#### MODIFY 2013.02.19 by gaolc  #######################################################
set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
set_net_routing_rule {clkm2s_psc} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets clkm2s_psc ]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

##route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -incremental -only_area_recovery

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#modify begin LWH
#set_route_zrt_detail_options -antenna true
#verify_zrt_route -antenna true
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_detail_options -antenna true
#source ../fix_short.tcl
#route_opt -skip_initial_route -effort high -area_recovery -xtalk_reduction
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_detail_options -antenna false
#route_zrt_detail -incremental true -max_number_iterations 40
#save_mw_cel -as ${_CEL_SAVE_NAME}_bf_ant


#source ../TCL/fix_short_final.tcl
#route_zrt_detail -incremental true -max_number_iterations 40

set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off

set_route_zrt_detail_options -antenna true -antenna_on_iteration 19
verify_zrt_route -antenna true

##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
source ../TCL/fix_ant.tcl
route_zrt_detail -incremental true -max_number_iterations 40

source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
#modify end LWH


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}

insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

########################################################################################
### Save
########################################################################################

save_mw_cel -as $_CEL_SAVE_NAME

change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

source ./FILES/SDC/report_adcsm_130424.tcl

### begin add Tsurume ###
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef


close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 524_route_opt_icc

exit
---18:525_route_opt_zrt_icc.tcl---
###########################################################################################
### 520_route_opt_icc: Post Route Optimization for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_SAVE_NAME    525_route_opt_icc
set _CEL_SCRIPT_ID    525

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}


#modify begin LWH
source icc_zrt_scripts/set_source_latency.tcl
##current_scenario USER1_MAX_HT_SETUP
##reset_switching_activity
##read_saif -input $RESULTS_DIR/${_CEL_LOAD_NAME}.saif -instance $DESIGN_NAME
##propagate_switching_activity
#modify end LWH


########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_postroute

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#modify begin LWH
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#modify end LWH

#### MODIFY 2013.02.19 by gaolc  #######################################################
set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 
set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 

set_net_routing_rule {clkm2s_psc} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets clkm2s_psc ]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

##route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -incremental -only_area_recovery

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#modify begin LWH
#set_route_zrt_detail_options -force_max_number_iterations true
set_route_zrt_detail_options -antenna true
verify_zrt_route -antenna true
route_zrt_detail -incremental true -max_number_iterations 80
set_route_zrt_detail_options -antenna true
#source ../fix_short.tcl
#route_opt -skip_initial_route -effort high -area_recovery -xtalk_reduction
set routeopt_restrict_tns_to_size_only true
set_active_scenarios [lminus [all_scenarios] AC_MAX_HT_SETUP]
route_opt -incremental
route_zrt_detail -incremental true -max_number_iterations 60
set_route_zrt_detail_options -antenna false
route_zrt_detail -incremental true -max_number_iterations 60
save_mw_cel -as ${_CEL_SAVE_NAME}_bf_ant

set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off

set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion

if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting ANTENNA Fixing"
  source -echo $ANTENNA_RULES_FILE
  report_antenna_rules
}
if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
}
route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#save_mw_cel -as ${_CEL_SAVE_NAME}_bf_focal
#source icc_zrt_scripts/diode_pvt_setting.tcl
#focal_opt -setup_endpoints all

source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
#modify end LWH


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}

save_mw_cel -as $_CEL_SAVE_NAME

insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

########################################################################################
### Save
########################################################################################


change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

source ./FILES/SDC/report_adcsm_130424.tcl

### begin add Tsurume ###
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef
close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"
printTime

sh date > 525_route_opt_icc

exit
---19:540_focal_opt_icc.tcl---
###########################################################################################
### 540_forcal_opt_icc: Post Route optimization for Zroute
###
### Version: V11.00.00 JUL 31, 2013 (H-2013.03-SP2)
### Copyright (C) 2007-2013 Synopsys All rights reserved.
###########################################################################################

set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_SAVE_NAME    540_focal_opt_icc
set _CEL_SCRIPT_ID    540

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"


########################################################################################
# DEFINE REPORT TCL FILE NAME
########################################################################################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_rato_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

###############################
# DEFIGNE CUSTOM SETTING      #
###############################

# REDUNDANT VIA
set RENESAS_REDUNDANT_VIA_TCL   "" ; # ./tcl/OptimizeContact_RC04LP_7LM.cmd

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE                == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE                  == " $MV_MODE
echo "SCRIPT-Info (Global) : ICC_REDUCE_CRITICAL_AREA == " $ICC_REDUCE_CRITICAL_AREA
echo "#################################################################################"

printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

#set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
  foreach scenario [get_scenario *SETUP*] {
    current_scenario $scenario
    set_clock_uncertainty -setup 0.25 [all_clocks]
  };

source icc_zrt_scripts/set_source_latency.tcl
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_focal

        ########################################
        #          FOCAL OPTIMIZATION          #
        ########################################
        
## focal optimization performs agressive, topology-based optimization on post-route design
## that is focused on fixing either the setup, hold, or logical DRC violations.
## You can make an endpoint file by using report_constraint -all_violators.
## If you do not specify file_name, default target is all violation.

## When you don't want to degrade the other timing at the cost of fixing a specific timing,
## This "-preserve_other_qor" option preserves other nontarget metrics.
## This feature supports -drc_nets -hold_endpoints -setup_endpoints.

if {$RENESAS_SETUP_ENDPOINTS_4FOCAL == ""} {
  focal_opt -effort medium -setup_endpoints all
} else {
  echo "SCRIPT-Info : RENESAS_SETUP_ENDPOINTS_4FOCAL == $RENESAS_SETUP_ENDPOINTS_4FOCAL"
  focal_opt -effort medium -setup_endpoints $RENESAS_SETUP_ENDPOINTS_4FOCAL
}

if {$RENESAS_HOLD_ENDPOINTS_4FOCAL == ""} {
  focal_opt -effort medium -hold_endpoints all
} else {
  echo "SCRIPT-Info : RENESAS_HOLD_ENDPOINTS_4FOCAL == $RENESAS_HOLD_ENDPOINTS_4FOCAL"
  focal_opt -effort medium -hold_endpoints $RENESAS_HOLD_ENDPOINTS_4FOCAL
}

if {$RENESAS_DRC_NETS_4FOCAL == ""} {
  focal_opt -effort medium -drc_nets all
} else {
  echo "SCRIPT-Info : RENESAS_DRC_NETS_4FOCAL == $RENESAS_DRC_NETS_4FOCAL"
  focal_opt -effort medium -drc_nets $RENESAS_DRC_NETS_4FOCAL
}

        #################################################
        #          FOCAL OPTIMIZATION for POWER         #
        #################################################

 ## focal optmization for power performs effective reducntion for leakage-power.
 ## This optimization needs libraries with footprints.
 ## If the libraries do not have footprints, you can set footprints by modifying 
 ## and reading the following tcl file. Then run the focal_opt -power.

 ## source ./tcl/Replace_cell_footprint.tcl
 ## focal_opt -power

########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      echo "SCRIPT-Info : Insert Tie Cell "
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

if {$MCMM_MODE == "true"} {
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
}

########################################
## Create Snapshot and Save
########################################

save_mw_cel -as $_CEL_SAVE_NAME
sh date > FLAG_END_${_CEL_SCRIPT_ID}

#####################################################
## Get report Vth_tario 
#####################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}

########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_design_physical -utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}_util.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet

if {$MCMM_MODE == "true" && $MV_MODE == "true"} {

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout

  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim    
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} elseif {$MCMM_MODE == "true" && $MV_MODE != "true"} {
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout

  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim    
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -path full_clock_expanded -slack_lesser_than 0.0 -attributes \
                -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -path full_clock_expanded -slack_lesser_than 0.0 -attributes \
                -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout

  report_timing -capacitance -transition_time -input_pins -nets -delay max -attributes \
                -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay min -attributes \
                -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 540_focal_opt_icc

exit
---20:540.temp---
###########################################################################################
### 540_forcal_opt_icc: Post Route optimization for Zroute
###
### Version: V11.00.00 JUL 31, 2013 (H-2013.03-SP2)
### Copyright (C) 2007-2013 Synopsys All rights reserved.
###########################################################################################

set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_SAVE_NAME    540_focal_opt_icc
set _CEL_SCRIPT_ID    540

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"


########################################################################################
# DEFINE REPORT TCL FILE NAME
########################################################################################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_rato_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

###############################
# DEFIGNE CUSTOM SETTING      #
###############################

# REDUNDANT VIA
set RENESAS_REDUNDANT_VIA_TCL   "" ; # ./tcl/OptimizeContact_RC04LP_7LM.cmd

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE                == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE                  == " $MV_MODE
echo "SCRIPT-Info (Global) : ICC_REDUCE_CRITICAL_AREA == " $ICC_REDUCE_CRITICAL_AREA
echo "#################################################################################"

printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
#source -echo ./FILES/OPECON/set_OPERATIING_COND_FOR_RX100_LIB_HT.tcl_v090
source temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

#set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}
#source ./FILES/SDC/r5f51105_v100_130123_dont_touch_ac_predly.tcl

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}


        ########################################
        #          FOCAL OPTIMIZATION          #
        ########################################
        
## focal optimization performs agressive, topology-based optimization on post-route design
## that is focused on fixing either the setup, hold, or logical DRC violations.
## You can make an endpoint file by using report_constraint -all_violators.
## If you do not specify file_name, default target is all violation.

## When you don't want to degrade the other timing at the cost of fixing a specific timing,
## This "-preserve_other_qor" option preserves other nontarget metrics.
## This feature supports -drc_nets -hold_endpoints -setup_endpoints.

if {$RENESAS_SETUP_ENDPOINTS_4FOCAL == ""} {
  focal_opt -effort medium -setup_endpoints all
} else {
  echo "SCRIPT-Info : RENESAS_SETUP_ENDPOINTS_4FOCAL == $RENESAS_SETUP_ENDPOINTS_4FOCAL"
  focal_opt -effort medium -setup_endpoints $RENESAS_SETUP_ENDPOINTS_4FOCAL
}

if {$RENESAS_HOLD_ENDPOINTS_4FOCAL == ""} {
  focal_opt -effort medium -hold_endpoints all
} else {
  echo "SCRIPT-Info : RENESAS_HOLD_ENDPOINTS_4FOCAL == $RENESAS_HOLD_ENDPOINTS_4FOCAL"
  focal_opt -effort medium -hold_endpoints $RENESAS_HOLD_ENDPOINTS_4FOCAL
}

if {$RENESAS_DRC_NETS_4FOCAL == ""} {
  focal_opt -effort medium -drc_nets all
} else {
  echo "SCRIPT-Info : RENESAS_DRC_NETS_4FOCAL == $RENESAS_DRC_NETS_4FOCAL"
  focal_opt -effort medium -drc_nets $RENESAS_DRC_NETS_4FOCAL
}

        #################################################
        #          FOCAL OPTIMIZATION for POWER         #
        #################################################

 ## focal optmization for power performs effective reducntion for leakage-power.
 ## This optimization needs libraries with footprints.
 ## If the libraries do not have footprints, you can set footprints by modifying 
 ## and reading the following tcl file. Then run the focal_opt -power.

 ## source ./tcl/Replace_cell_footprint.tcl
 ## focal_opt -power

########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      echo "SCRIPT-Info : Insert Tie Cell "
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

if {$MCMM_MODE == "true"} {
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
}

########################################
## Create Snapshot and Save
########################################

save_mw_cel -as $_CEL_SAVE_NAME
sh date > FLAG_END_${_CEL_SCRIPT_ID}

#####################################################
## Get report Vth_tario 
#####################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}

########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_design_physical -utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}_util.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet

if {$MCMM_MODE == "true" && $MV_MODE == "true"} {

  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout

  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim    
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage \
                -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} elseif {$MCMM_MODE == "true" && $MV_MODE != "true"} {
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout

  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim    
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay max -path full_clock_expanded -slack_lesser_than 0.0 -attributes \
                -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets \
                -delay min -path full_clock_expanded -slack_lesser_than 0.0 -attributes \
                -derate -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout

  report_timing -capacitance -transition_time -input_pins -nets -delay max -attributes \
                -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay min -attributes \
                -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

sh date > 540_focal_opt_icc

exit
---21:600_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco00
set ECO_VERSION       eco01
set _CEL_LOAD_NAME    521_route_opt_icc
#set _CEL_SAVE_NAME    600_ECO_${ECO_PRE_VERSION}_base
#set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    600

set NET_VER v010r4s00I0p04e01f_170912a

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v010_20170825.tcl
## add by You.J 160829
source -echo ../Short_for_dont_touch.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################


#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
source -echo /design02/RX130_256KB/data/r5f51306/4_implement/42_sdc/ForPnR/v010/20170912/ac_ECO01_cmd.tcl
source -echo /design02/RX130_256KB/data/r5f51306/4_implement/42_sdc/ForPnR/v010/20170912/kobetsu_ECO01_cmd.tcl
source -echo /design02/RX130_256KB/data/r5f51306/4_implement/42_sdc/ForPnR/v010/20170912/normal_ECO01_cmd.tcl

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH















#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT_INC


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/${DESIGN_NAME}_${NET_VER}.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---22:601_route_zrt_eco_icc_drc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco02
set ECO_VERSION       eco02
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base_drc
set _CEL_SCRIPT_ID    601

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#remove_routing_rules  FLASH_NET
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
source ./size_cell_for_tran.tcl



set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
source -echo ../TCL/fix_short.tcl
route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_short_fix
route_zrt_detail -incremental true -max_number_iterations 40
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off









set_route_zrt_detail_options -antenna true
verify_zrt_route -antenna true

set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off

set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion

if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting ANTENNA Fixing"
  source -echo $ANTENNA_RULES_FILE
  report_antenna_rules
}
if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
}
route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
verify_zrt_route -antenna true
source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental

###modify end LWH















#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME

if {0} {
remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock
}

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---23:601_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco01
set ECO_VERSION       eco02
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    601

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################


#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160830/normal_ECO02_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160830/kobetsu_ECO002_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160830/ac_ECO02_cmd.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH















#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT_INC


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/${DESIGN_NAME}_${_CEL_SAVE_NAME}.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---24:602_route_zrt_eco_icc_drc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco02
set ECO_VERSION       eco02
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base_drc
set _CEL_SCRIPT_ID    602

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################


#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH















#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v020/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308a_${_CEL_SAVE_NAME}.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---25:602_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco02
set ECO_VERSION       eco03
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    602

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################


#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160831/normal_ECO03_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160831/kobetsu_ECO003_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160831/ac_ECO03_cmd.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH















#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308a_${_CEL_SAVE_NAME}.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---26:603_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco03
set ECO_VERSION       eco04
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    603

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################


#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160905/normal_ECO04_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160905/kobetsu_ECO04_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160905/ac_ECO04_cmd.tcl
##source -echo ../INV_for_Minpulse.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH















#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v030r4s01I9p01e04f_160905a.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---27:604_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco04
set ECO_VERSION       eco05
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    604

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################


#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160906/normal_ECO05_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160906/kobetsu_ECO05_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v030/20160906/ac_ECO05_cmd.tcl
source -echo ./insert_buffer_for_tran.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH















#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v030r4s01I9p01e05f_160906a.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---28:605_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco05
set ECO_VERSION       eco06
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    605

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################
eco_netlist -by_tcl_file eco_netlist_20160907.tcl

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160907/normal_ECO06_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160907/kobetsu_ECO06_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160907/ac_ECO06_cmd.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH















#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v101r4s01I9p01e06f_160907a.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---29:606_route_zrt_eco_icc_drc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco06
set ECO_VERSION       eco06_drc
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    606_drc

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO02 TEST


#####STA
###
##### AC No.2
###insert_buffer -inverter_pair -new_cell_names ECO06_AC_No2_INVERTER  iotop/pad/pad_right/PC6_wrp/icc_place2/A  TM6INVX20
###remove_buffer {iotop/pad/pad_right/PC6_wrp/icc_place2  iotop/pad/pad_right/PC6_wrp/icc_place1}
###insert_buffer -inverter_pair -new_cell_names ECO06_AC_No2_INVERTER_ORG  iotop/pad/pad_right/PC6_wrp/ECO06_AC_No2_INVERTER_1/YB   TM6INVX30
###
###
##### AC No.3
###insert_buffer iotop/pad/pad_top/PB0_wrp/icc_route2/A  TM6INVX20 -new_cell_names ECO06_AC_No3_INVERTER  -inverter_pair
###remove_buffer iotop/pad/pad_top/PB0_wrp/icc_route2
###insert_buffer iotop/pad/pad_top/PB0_wrp/ECO06_AC_No3_INVERTER_1/YB  TM6BUFX50   -new_cell_names ECO06_AC_No3_BUFFER 
###
###
##### AC No.4
###insert_buffer iotop/pad/pad_top/PA5_wrp/icc_place1/A  TM6INVX20 -new_cell_names ECO06_AC_No4_INVERTER  -inverter_pair
###remove_buffer iotop/pad/pad_top/PA5_wrp/icc_place1
###insert_buffer iotop/pad/pad_top/PA5_wrp/ECO06_AC_No4_INVERTER_1/YB  TM6BUFX50   -new_cell_names ECO06_AC_No4_BUFFER 
###
###
###
###source -echo ./remove_placement_blockage_rx130.tcl
###size_cell cpusys/syspf/clkmc/iLOCO_ECO_BUF TM6BUFCLX40
###source -echo ./eco_netlist_v102.tcl
source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40



route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_80

##route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_120
##
##route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_160









########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname


remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---30:606_route_zrt_eco_icc_HOCO_3.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco06
set ECO_VERSION       eco06_HOCO_rule3
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc_HOCO_rule3
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    606

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO02 TEST


##STA

#### AC No.2
##insert_buffer -inverter_pair -new_cell_names ECO06_AC_No2_INVERTER  iotop/pad/pad_right/PC6_wrp/icc_place2/A  TM6INVX20
##remove_buffer {iotop/pad/pad_right/PC6_wrp/icc_place2  iotop/pad/pad_right/PC6_wrp/icc_place1}
##insert_buffer -inverter_pair -new_cell_names ECO06_AC_No2_INVERTER_ORG  iotop/pad/pad_right/PC6_wrp/ECO06_AC_No2_INVERTER_1/YB   TM6INVX30
##
##
#### AC No.3
##insert_buffer iotop/pad/pad_top/PB0_wrp/icc_route2/A  TM6INVX20 -new_cell_names ECO06_AC_No3_INVERTER  -inverter_pair
##remove_buffer iotop/pad/pad_top/PB0_wrp/icc_route2
##insert_buffer iotop/pad/pad_top/PB0_wrp/ECO06_AC_No3_INVERTER_1/YB  TM6BUFX50   -new_cell_names ECO06_AC_No3_BUFFER 
##
##
#### AC No.4
##insert_buffer iotop/pad/pad_top/PA5_wrp/icc_place1/A  TM6INVX20 -new_cell_names ECO06_AC_No4_INVERTER  -inverter_pair
##remove_buffer iotop/pad/pad_top/PA5_wrp/icc_place1
##insert_buffer iotop/pad/pad_top/PA5_wrp/ECO06_AC_No4_INVERTER_1/YB  TM6BUFX50   -new_cell_names ECO06_AC_No4_BUFFER 
##
##
##
##source -echo ./remove_placement_blockage_rx130.tcl
##size_cell cpusys/syspf/clkmc/iLOCO_ECO_BUF TM6BUFCLX40
##source -echo ./eco_netlist_v102.tcl
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
##check_legality -verbose 
##
##save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}




route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40

route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_80


source ../TCL/fix_short.tcl
save_mw_cel -as ${_CEL_SAVE_NAME}_160


route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_200

route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_240





set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true







########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname


remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---31:606_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco06
set ECO_VERSION       eco07
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    606

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################
##ECO06 logic ECO 160907
#eco_netlist -by_tcl_file eco_netlist_20160907.tcl

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160913/normal_ECO07_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160913/kobetsu_ECO07_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160913/ac_ECO07_cmd.tcl
remove_cell cpusys/bpm/rx_cpubpf/rx_cpumem/ocd_top/diode_947
remove_cell cpusys/syspf/cpg/cgtree/cgseciclk/diode_353
remove_cell iotop/pad/pad_bottom/moscport_glue/diode_371

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
set_net_routing_rule -reroute freeze [get_flat_nets RESFB5V]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH

##You.J##set_route_zrt_detail_options -antenna true
##You.J##verify_zrt_route -antenna true
##You.J##
##You.J##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##You.J##set_route_zrt_common_options -concurrent_redundant_via_mode off
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##You.J##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##You.J##
##You.J##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##You.J##
##You.J##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##You.J##  source -echo $ANTENNA_RULES_FILE
##You.J##  report_antenna_rules
##You.J##}
##You.J##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##You.J##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##You.J##}
##You.J##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##You.J##verify_zrt_route -antenna true
source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental













#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v101r4s01I9p01e07f_160913a.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---32:607_route_zrt_eco_icc_drc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco08
set ECO_VERSION       eco08
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base_drc
set _CEL_SCRIPT_ID    607_drc

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################
##ECO06 logic ECO 160907
#eco_netlist -by_tcl_file eco_netlist_20160907.tcl

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
##You.J#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/normal_ECO08_cmd.tcl
##You.J#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/kobetsu_ECO08_cmd.tcl
##You.J#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/ac_ECO08_cmd.tcl
#size_cell cpusys/bpm/rx_cpubpf/ravenue/rv_buscnt/rv_busmarbt/u_rv_ba_bif/U205 TM6ON2BB1VX20

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
set_net_routing_rule -reroute freeze [get_flat_nets RESFB5V]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH

##You.J##set_route_zrt_detail_options -antenna true
##You.J##verify_zrt_route -antenna true
##You.J##
##You.J##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##You.J##set_route_zrt_common_options -concurrent_redundant_via_mode off
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##You.J##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##You.J##
##You.J##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##You.J##
##You.J##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##You.J##  source -echo $ANTENNA_RULES_FILE
##You.J##  report_antenna_rules
##You.J##}
##You.J##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##You.J##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##You.J##}
##You.J##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##You.J##verify_zrt_route -antenna true
source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental













#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v101r4s01I9p01e08f_160914b.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---33:607_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco07
set ECO_VERSION       eco08
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    606

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################
##ECO06 logic ECO 160907
#eco_netlist -by_tcl_file eco_netlist_20160907.tcl

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/normal_ECO08_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/kobetsu_ECO08_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/ac_ECO08_cmd.tcl

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
set_net_routing_rule -reroute freeze [get_flat_nets RESFB5V]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH

##You.J##set_route_zrt_detail_options -antenna true
##You.J##verify_zrt_route -antenna true
##You.J##
##You.J##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##You.J##set_route_zrt_common_options -concurrent_redundant_via_mode off
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##You.J##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##You.J##
##You.J##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##You.J##
##You.J##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##You.J##  source -echo $ANTENNA_RULES_FILE
##You.J##  report_antenna_rules
##You.J##}
##You.J##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##You.J##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##You.J##}
##You.J##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##You.J##verify_zrt_route -antenna true
source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental













#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v101r4s01I9p01e08f_160914a.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---34:608_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco08
set ECO_VERSION       eco09
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    608

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################
##ECO06 logic ECO 160907
#eco_netlist -by_tcl_file eco_netlist_20160907.tcl

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/normal_ECO09_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/kobetsu_ECO09_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/ac_ECO09_cmd.tcl

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
set_net_routing_rule -reroute freeze [get_flat_nets RESFB5V]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH

##You.J##set_route_zrt_detail_options -antenna true
##You.J##verify_zrt_route -antenna true
##You.J##
##You.J##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##You.J##set_route_zrt_common_options -concurrent_redundant_via_mode off
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##You.J##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##You.J##
##You.J##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##You.J##
##You.J##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##You.J##  source -echo $ANTENNA_RULES_FILE
##You.J##  report_antenna_rules
##You.J##}
##You.J##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##You.J##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##You.J##}
##You.J##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##You.J##verify_zrt_route -antenna true
source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental













#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v101r4s01I9p01e09f_160914a.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---35:609_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco09
set ECO_VERSION       eco10
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    609

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################
##ECO06 logic ECO 160907
#eco_netlist -by_tcl_file eco_netlist_20160907.tcl

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160915/normal_ECO10_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160915/kobetsu_ECO10_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160915/ac_ECO10_cmd.tcl

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
set_net_routing_rule -reroute freeze [get_flat_nets RESFB5V]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH

##You.J##set_route_zrt_detail_options -antenna true
##You.J##verify_zrt_route -antenna true
##You.J##
##You.J##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##You.J##set_route_zrt_common_options -concurrent_redundant_via_mode off
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##You.J##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##You.J##
##You.J##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##You.J##
##You.J##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##You.J##  source -echo $ANTENNA_RULES_FILE
##You.J##  report_antenna_rules
##You.J##}
##You.J##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##You.J##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##You.J##}
##You.J##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##You.J##verify_zrt_route -antenna true
source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental













#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v101r4s01I9p01e10f_160915a.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---36:609_route_zrt_eco_icc.tcl_Antenna---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco09
set ECO_VERSION       eco09
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base_Antenna
set _CEL_SCRIPT_ID    609

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------



source icc_zrt_scripts/operating_condition_For_DIODE.tcl

set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off

set_route_zrt_detail_options -antenna true 
verify_zrt_route -antenna true

set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion

if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting ANTENNA Fixing"
  source -echo $ANTENNA_RULES_FILE
  report_antenna_rules
}
if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
}
#route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
route_zrt_detail -incremental true -max_number_iterations 40
verify_zrt_route -antenna true
save_mw_cel -as ${_CEL_SAVE_NAME}_40


source icc_zrt_scripts/operating_condition_For_DIODE.tcl
route_zrt_detail -incremental true -max_number_iterations 40
verify_zrt_route -antenna true





########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


## For filler insertion
source FP150324_blockages.tcl
source partial_placement_blockage.dump
remove_placement_blockage [get_placement_blockage -filter "type==soft"]





########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname


remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---37:609_route_zrt_eco_icc.tcl_drc---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco10
set ECO_VERSION       eco10
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base_drc
set _CEL_SCRIPT_ID    609_drc

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################
##ECO06 logic ECO 160907
#eco_netlist -by_tcl_file eco_netlist_20160907.tcl

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
##You.J##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/normal_ECO09_cmd.tcl
##You.J##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/kobetsu_ECO09_cmd.tcl
##You.J##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160914/ac_ECO09_cmd.tcl
##You.J##
##You.J##set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
##You.J##legalize_placement -incremental -eco
##You.J##set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
##You.J##check_legality -verbose 
##You.J##
##You.J##save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
set_net_routing_rule -reroute freeze [get_flat_nets RESFB5V]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

##route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off
route_zrt_detail -incremental true -max_number_iterations 40
source -echo ../TCL/fix_short.tcl
route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_short_fix
route_zrt_detail -incremental true -max_number_iterations 40










##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH

##You.J##set_route_zrt_detail_options -antenna true
##You.J##verify_zrt_route -antenna true
##You.J##
##You.J##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##You.J##set_route_zrt_common_options -concurrent_redundant_via_mode off
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##You.J##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##You.J##
##You.J##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##You.J##
##You.J##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##You.J##  source -echo $ANTENNA_RULES_FILE
##You.J##  report_antenna_rules
##You.J##}
##You.J##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##You.J##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##You.J##}
##You.J##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##You.J##verify_zrt_route -antenna true
source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental













#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
##You.J##define_name_rules verilog -case_insensitive
##You.J##change_names -rules verilog -hierarchy
##You.J##set verilogout_no_tri true
##You.J##write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v101r4s01I9p01e09f_160914a.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---38:610_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco10
set ECO_VERSION       eco11
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_drc
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    610

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

#source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
source -echo $PREROUTE_DONT_TOUCH
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################
##ECO06 logic ECO 160907
#eco_netlist -by_tcl_file eco_netlist_20160907.tcl

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO01 TEST
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/kobetsu_PreECO001_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160725/ac_PreECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160727/kobetsu_ECO001_cmd.tcl
#source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v020/20160728/kobetsu_ECO002_cmd.tcl
source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160915/normal_ECO11_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160915/kobetsu_ECO11_cmd.tcl
##source -echo /design02/RX130_512KB/data/r5f51308/4_implement/42_sdc/ForPnR/v101/20160915/ac_ECO11_cmd.tcl

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental -eco
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
set_net_routing_rule -reroute freeze [get_flat_nets RESFB5V]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40


#set_route_zrt_common_options  -post_detail_route_redundant_via_insertion medium
#set_route_zrt_common_options -concurrent_redundant_via_mode reserve_space
#set_route_zrt_detail_options -optimize_wire_via_effort_level medium
route_zrt_detail -incremental true -max_number_iterations 40
source -echo ../TCL/fix_short.tcl
#route_zrt_detail -incremental true -max_number_iterations 40
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off











##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##set_route_zrt_common_options -concurrent_redundant_via_mode off
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##
##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##
##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##  source -echo $ANTENNA_RULES_FILE
##  report_antenna_rules
##}
##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##}
##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##
##source -echo /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental
###modify end LWH

##You.J##set_route_zrt_detail_options -antenna true
##You.J##verify_zrt_route -antenna true
##You.J##
##You.J##set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
##You.J##set_route_zrt_common_options -concurrent_redundant_via_mode off
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
##You.J##set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
##You.J##set_route_zrt_detail_options -optimize_wire_via_effort_level off
##You.J##
##You.J##set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
##You.J##
##You.J##if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting ANTENNA Fixing"
##You.J##  source -echo $ANTENNA_RULES_FILE
##You.J##  report_antenna_rules
##You.J##}
##You.J##if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
##You.J##  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
##You.J##  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
##You.J##}
##You.J##route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
##You.J##verify_zrt_route -antenna true
source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental













#######set ICC_ROUTING_DIODES "TM6PNDIODE" ;# specifies libcell names for diode insertion
#######
#######if {$ICC_FIX_ANTENNA == "true" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting ANTENNA Fixing"
#######  source -echo $ANTENNA_RULES_FILE
#######  report_antenna_rules
#######}
#######if {$ICC_ROUTING_DIODES != "" && [file exists [which $ANTENNA_RULES_FILE]]} {
#######  echo "SCRIPT-Info : starting diode insertion for antenna fixing"
#######  set_route_zrt_detail_options -antenna true -insert_diodes_during_routing true -diode_libcell_names $ICC_ROUTING_DIODES
#######}
#######route_zrt_eco -max_detail_route_iterations 40 -utilize_dangling_wires false
#######
#######set_route_zrt_detail_options -antenna false
#######route_zrt_detail -incremental true -max_number_iterations 40
#######set_route_zrt_detail_options -antenna true -insert_diodes_during_routing false
#######
#######
#######verify_zrt_route -report_all_open_nets true
#######
########route_zrt_detail -incremental true -max_number_iterations 25
########save_mw_cel -as ${_CEL_SAVE_NAME}_25
#######
#######
########route_zrt_detail -incremental true -max_number_iterations 50
########route_zrt_detail -incremental true -max_number_iterations 20


########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


##remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
##save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /design02/RX130_512KB/data/r5f51308/4_implement/45_pwrdesign/pre/v030/iccompilerdir/r5f51308a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/r5f51308_v101r4s01I9p01e11f_160915a.v

remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname
sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

#You.J#set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
#You.J#set verilogout_no_tri true
#You.J#
#You.J#write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v
#You.J#
#You.J#write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



##source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
##redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---39:611_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco10
set ECO_VERSION       eco11
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    611

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO02 TEST


##STA
size_cell cpusys/bpm/rx_flash/flash_mem/cibc/fmop/U102  TM6AND2BX10
insert_buffer -new_cell_names ECO11_FE_FIX  cpusys/bpm/rx_flash/flash_mem/cibc/fmop/U102/Y  TM6BUFX40


## COMP route
remove_net_routing cpusys/syspf/clkmc/n30
remove_net_routing ps_pocrel5v_a_n_vcc
remove_net_routing pd_port1in

create_route_guide -name rg_comp1  -coordinate {{-903.390 49.480} {-884.220 60.040}   } -no_signal_layers {M4} 
create_route_guide -name rg_comp2  -coordinate {{-883.500 49.000} {-867.620 60.040}   } -no_signal_layers {M4} 
create_route_guide -name rg_comp3  -coordinate {{-866.220 48.520} {-864.060 60.040}   } -no_signal_layers {M4} 
create_route_guide -name rg_comp4  -coordinate {{-863.340 46.120} {-827.940 59.800}   } -no_signal_layers {M4} 
create_route_guide -name rg_comp5  -coordinate {{-908.260 -23.000} {-887.940 -12.440} } -no_signal_layers {M4}
create_route_guide -name rg_comp6  -coordinate {{-879.950 -23.000} {-859.750 -12.440} } -no_signal_layers {M4}
create_route_guide -name rg_comp7  -coordinate {{-859.750 -17.350} {-853.280 -12.440} } -no_signal_layers {M4}
create_route_guide -name rg_comp8  -coordinate {{-849.550 -23.000} {-827.940 -12.440} } -no_signal_layers {M4}

 
##AC
size_cell cpusys/syspf/mdent/ux001imdentlogi10/ux001jmdentsft10/U15 TM6MUX2X10

#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental 
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40



route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_80
##
##route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_120
##
##route_zrt_detail -incremental true -max_number_iterations 40









########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME



## For filler insertion
source FP150324_blockages.tcl
source partial_placement_blockage.dump
remove_placement_blockage [get_placement_blockage -filter "type==soft"]




########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname


remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---40:611_route_zrt_eco_icc.tcl_DRC---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco11
set ECO_VERSION       eco11
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base_DRC
set _CEL_SCRIPT_ID    611

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO02 TEST


##FE

##DTRMCP12
size_cell  cpusys/bpm/rx_flash/flash_mem/cibc/fmop/ECO11_FE_FIX  TM6BUFX20
insert_buffer -new_cell_names ECO11_FE_FIX_DTRMCP12 cpusys/bpm/rx_flash/flash_mem/cibc/fmop/ECO11_FE_FIX/Y  TM6DLY1CLX20


##AC
size_cell iotop/pad/pad_bottom/MD_wrp/MUX0 TM6MUX2X20
 

#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental 
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40



route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_80
##
##route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_120
##
##route_zrt_detail -incremental true -max_number_iterations 40









########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME



## For filler insertion
source FP150324_blockages.tcl
source partial_placement_blockage.dump
remove_placement_blockage [get_placement_blockage -filter "type==soft"]




########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname


remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---41:612_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco11
set ECO_VERSION       eco12
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base_DRC
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    612

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO02 TEST


##STA


## DIODE
set net_name iotop/pad/pad_left/P43_wrp/din_soin
set inst "iotop/pad/pad_left/P43_wrp/icc_route1_A_DIO_ECO12"
create_cell $inst MF3TM6DIODE/TM6PNDIODE
connect_net $net_name [ get_pins $inst/A ]
set obj [get_cells $inst -all]
set_attribute -quiet $obj orientation N
set_attribute -quiet $obj origin  {125.340 135.400}
set_attribute -quiet $obj is_placed true
set_attribute -quiet $obj is_fixed false
set_attribute -quiet $obj is_soft_fixed false
set_attribute -quiet $obj eco_status eco_reset


## ifcu_0_obsclk
insert_buffer -new_cell_names ECO12_IFCU_TRANS  pericore/mp200/ifcu_0/ifcu/coretop/kerneltop/clktest/U4/YB  TM6BUFX100
move_objects pericore/mp200/ifcu_0/ifcu/coretop/kerneltop/clktest/ECO12_IFCU_TRANS  -to {-646.500 -313.880}


## pericore/mp200/ifcu_0/ifcu/coretop/kerneltop/clk_ssclk_div4
size_cell  pericore/mp200/ifcu_0/ifcu/coretop/kerneltop/rcnt/asyncntripple/cnt_1_reg/vc_inv_cell1  TM6INVX20
insert_buffer -new_cell_names ECO12_IFCU_TRANS_2  pericore/mp200/ifcu_0/ifcu/coretop/kerneltop/rcnt/asyncntripple/cnt_1_reg/vc_inv_cell1/YB  TM6BUFX100
move_objects pericore/mp200/ifcu_0/ifcu/coretop/kerneltop/rcnt/asyncntripple/cnt_1_reg/ECO12_IFCU_TRANS_2  -to {-568.740 -861.080}

##AC
#source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl

set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental 
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40



route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_80
##
##route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_120
##
##route_zrt_detail -incremental true -max_number_iterations 40









########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME



## For filler insertion
source FP150324_blockages.tcl
source partial_placement_blockage.dump
remove_placement_blockage [get_placement_blockage -filter "type==soft"]




########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname


remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---42:612_route_zrt_eco_icc.tcl_DRC---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco12
set ECO_VERSION       eco12
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}_base
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base_via
set _CEL_SCRIPT_ID    612

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

#remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO02 TEST


##STA



set_route_zrt_detail_options -antenna false
#set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
#set_route_zrt_common_options -concurrent_redundant_via_mode off
#set_route_zrt_detail_options -optimize_wire_via_effort_level off
#set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
#set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40

route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_80
##
##route_zrt_detail -incremental true -max_number_iterations 40
##save_mw_cel -as ${_CEL_SAVE_NAME}_120
##
##route_zrt_detail -incremental true -max_number_iterations 40









########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME


report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---43:613_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco12_base_chname_bgisub
set ECO_VERSION       eco13
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    613

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO02 TEST


##STA
source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental 
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40



route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_80

route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_120

route_zrt_detail -incremental true -max_number_iterations 40









########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME



## For filler insertion
source FP150324_blockages.tcl
source partial_placement_blockage.dump
remove_placement_blockage [get_placement_blockage -filter "type==soft"]




########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname


remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---44:614_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco13_base_chname_drcfix
set ECO_VERSION       eco14
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    614

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO02 TEST


##STA
source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental 
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40



route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_80

route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_120

route_zrt_detail -incremental true -max_number_iterations 40









########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME



## For filler insertion
source FP150324_blockages.tcl
source partial_placement_blockage.dump
remove_placement_blockage [get_placement_blockage -filter "type==soft"]




########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname


remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---45:615_route_zrt_eco_icc.tcl---
###########################################################################################
### 530_route_xtalk_icc : Post Route optimization w/ Xalk for Zroute
###                                                               (V08.00.00) 2012.03.09
###########################################################################################


########################################################################################
### Local variable setting
########################################################################################
set ECO_PRE_VERSION   eco14_base_chname_drcfix
set ECO_VERSION       eco15
#set _CEL_LOAD_NAME    520_route_opt_icc
set _CEL_LOAD_NAME    600_ECO_${ECO_PRE_VERSION}
set _CEL_SAVE_NAME    600_ECO_${ECO_VERSION}_base
set _CEL_SCRIPT_ID    615

echo "Defined-Info : _CEL_LOAD_NAME    $_CEL_LOAD_NAME"
echo "Defined-Info : _CEL_SAVE_NAME    $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID    $_CEL_SCRIPT_ID"

###############################
# DEFINE REPORT TCL FILE NAME
###############################

set RENESAS_REPORT_VTH_RATIO_TCL  ""; #./tcl/report_vth_ratio_RC04LP.tcl
echo "Defined-Info : RENESAS_REPORT_VTH_RATIO_TCL " $RENESAS_REPORT_VTH_RATIO_TCL

########################################################################################
###  DEFINE CONSTRAINTS 
########################################################################################

set RENESAS_DONT_TOUCH_CELL_LIST      ""; # ./sample/set_dont_touch_cell_tmp.tcl
set RENESAS_DONT_TOUCH_NET_LIST       ""; # ./sample/set_dont_touch_net_tmp.tcl
set RENESAS_SIZE_ONLY_CELL_LIST       ""; # ./sample/set_sizeonly_cell_tmp.tcl
# OCV setting
set RENESAS_SET_OCV_TCL               "" ;# ./sample/set_OCV_tmp.tcl

echo "Defined-Info : RENESAS_DONT_TOUCH_CELL_LIST  " $RENESAS_DONT_TOUCH_CELL_LIST
echo "Defined-Info : RENESAS_DONT_TOUCH_NET_LIST   " $RENESAS_DONT_TOUCH_NET_LIST
echo "Defined-Info : RENESAS_SIZE_ONLY_CELL_LIST   " $RENESAS_SIZE_ONLY_CELL_LIST
echo "Defined-Info : RENESAS_SET_OCV_TCL             $RENESAS_SET_OCV_TCL"

source -echo icc_setup.tcl

########################################################################################
### Enable debug mode 1: Enable 0: Disable ==> Please remove comment.
########################################################################################
set RENESAS_DEBUG 0
#set RENESAS_DEBUG 1

if {$RENESAS_DEBUG} {
  echo "Defined-Info : RENESAS_DEBUG " $RENESAS_DEBUG
  set enable_page_mode true
  set sh_enable_page_mode true
}

echo "#################################################################################"
echo "SCRIPT-Info (Global) : MCMM_MODE        == " $MCMM_MODE
echo "SCRIPT-Info (Global) : MV_MODE          == " $MV_MODE
echo "#################################################################################"


printTime

########################################################################################
### Copy and Open Database
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
copy_mw_cel -from $_CEL_LOAD_NAME -to ${_CEL_SAVE_NAME}_TMP
open_mw_cel ${_CEL_SAVE_NAME}_TMP

link -force
close_mw_cel ${_CEL_SAVE_NAME}_TMP
source -echo temp_chg.tcl

open_mw_cel ${_CEL_SAVE_NAME}_TMP

set routeopt_density_limit 0.99
########################################################################################
### Optimization Common Session Options - set in all sessions
########################################################################################

source -echo ./icc_zrt_scripts/common_optimization_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_placement_settings_icc.tcl
source -echo ./icc_zrt_scripts/common_post_cts_timing_settings.tcl

########################################
#    LOAD THE ROUTE AND SI SETTINGS    #
########################################

source -echo ./icc_zrt_scripts/common_route_si_settings_zrt_icc.tcl

##################################################################################
### Source user specified constraint files
##################################################################################

if {[file exists [which $RENESAS_DONT_TOUCH_CELL_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_CELL_LIST
}

if {[file exists [which $RENESAS_DONT_TOUCH_NET_LIST]]} {
  source -echo $RENESAS_DONT_TOUCH_NET_LIST
}

if {[file exists [which $RENESAS_SIZE_ONLY_CELL_LIST]]} {
  source -echo $RENESAS_SIZE_ONLY_CELL_LIST
}

source -echo ./FILES/FP/PREROUTE_DONT_TOUCH_v100_20150302.tcl
########################################################################################
### Set dont use cells
### Examples, big drivers (EM issues), very weak drivers, delay cells, clock cells
########################################################################################

if {[file exists [which $ICC_IN_DONT_USE_FILE]] } {
  echo "SCRIPT-Info : Read  ICC_IN_DONT_USE_FILE :$ICC_IN_DONT_USE_FILE"
  source -echo  $ICC_IN_DONT_USE_FILE
}

########################################################################################
# Remove current SDC and set again
########################################################################################
##################################################################################
source -echo  ${SDC_DT_1}

source -echo ${MAX_CAP_F}
##################################################################################

if {$MCMM_MODE == "false" } {
  echo "SCRIPT-Info : set_fix_hold [all_clocks]"
  remove_sdc
  read_sdc $ICC_IN_PROPA_SDC_FILE
  set_propagated_clock [all_clocks]
  source -echo ./icc_zrt_scripts/design_specific_icc.tcl
  source $RENESAS_SET_OCV_TCL
  set_fix_hold [all_clocks]
  if {$MV_MODE == "true" && [file exists [which $ICC_IN_UPF_FILE]]} {
    source icc_zrt_scripts/set_voltage_forUPF_sample.tcl
  }
} else {
  echo "SCRIPT-Info : MCMM_MODE set_fix_hold"
  remove_sdc
  remove_scenario -all
  source -echo $ICC_MCMM_PROPA_SCENARIOS_FILE
  set_active_scenarios [lminus [all_scenarios] $ICC_MCMM_CTS_SCENARIO]
  foreach scenario [all_active_scenarios] {
    current_scenario $scenario
    set_propagated_clock [all_clocks]
    source ./icc_zrt_scripts/design_specific_icc.tcl
    source $RENESAS_SET_OCV_TCL
    set_fix_hold [all_clocks]
  };
}

#modify begin LWH
foreach elm [all_active_scenarios]  {
 if {[regexp HOLD $elm]} {
    current_scenario $elm
   echo "set $elm set_fix_hold \[all_clocks\]"
   set_fix_hold [all_clocks]
  }
}
#modify end LWH

set_net_routing_rule {cpusys/syspf/oli_hococlk} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/syspf/oli_hococlk ] 

set_net_routing_rule {cpusys/ho_fihfl} -rule {CLOCK_NET} 
set_net_routing_rule -reroute freeze [get_flat_nets cpusys/ho_fihfl ] 
########################################################################################
### start the post route optimization
########################################################################################

set compile_instance_name_prefix icc_$ECO_VERSION

# ADD 2012.04.06 ######################
source -echo $ANTENNA_RULES_FILE
report_antenna_rules
#######################################

#source ./FILES/ECO/0-remove_cell.tcl

#set eco_netlist_preprocess_for_verilog true

remove_stdcell_filler -stdcell 

##-------------------------------------------------------------------------------------------
## ECO_Place
##-------------------------------------------------------------------------------------------
##ECO02 TEST


##STA
source -echo /svhome/rx100gr/data/r5f51305/4_implement/42_sdc/v101/ForLayout/eco_for_layout.tcl


set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed false
legalize_placement -incremental 
set_attribute  [get_cells -hier *BONUS_*_CORE* ] is_fixed true
check_legality -verbose 

save_mw_cel -as ${_CEL_SAVE_NAME}_legalize


##-------------------------------------------------------------------------------------------
## ECO_Route
##-------------------------------------------------------------------------------------------
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock"]
set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]
#set_net_routing_rule -reroute freeze [get_flat_nets * -filter "net_type == Clock && var_route_rule == CLOCK_NET"]

########################################################################################
### Additional Post Route Optimization
########################################################################################
#set_route_zrt_common_options -threshold_noise_ratio 0.35
#set_route_zrt_global_options -crosstalk_driven true
#set_route_zrt_track_options -crosstalk_driven true

#route_opt -skip_initial_route -xtalk_reduction -effort medium -power
#route_opt -skip_initial_route -xtalk_reduction -effort medium -area_recovery
#route_opt -skip_initial_route -effort medium -area_recovery
#route_opt -incremental -only_area_recovery
#
#route_opt -only_hold_time  -effort high -incremental

########################################################################################
### ADDITIONAL ROUTE_OPT FEATURES
###
### Additional Max_transition fixing :
### By default, route_opt will prioritize WNS and TNS over DRC ( e.g. max_tran fixing). 
### If you want to change this behavior, and give top priority to the DRC fixing, 
### you need to set the variable below.
### Keep in mind : this variable, only works with the -only_design_rule swich 
### in route_opt itself violations.
###
###   set routeopt_drc_over_timing true
###   route_opt -effort high -incremental -only_design_rule
###
### Improving QoR after the default route_opt run : 
###   route_opt -inc
###
### Limiting route_opt to specific optimization steps :
###   route_opt -size_only : do not insert buffers or move cells : 
###                          limits the disturbance to the design
###   route_opt -only_xtalk_reduction : run only the Xtalk reduction engine
###   route_opt -only_hold_time : run only the Hold fixing engine
###   route_opt -(only_)wire_size : runs the wire size engine,
###                                 that fixis timing violations by applying 
###   
### Running size_only but still allowing buffers to be inserted for hold fixing :
###   set routeopt_allow_min_buffer_with_size_only true
########################################################################################

########################################################################################
### additional Search & Repair
########################################################################################
report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization

#remove_route_by_type -nets {pt_irq_a[5] pericore/mp200/scic_2_prd[7]} -signal_detail_route
#source ./FILES/ECO/tran_route_131125.tcl
#remove_route_by_type -nets {cpusys/bpm/rx_flash/flash_mem/DRO08} -signal_detail_route
#source ./FILES/ECO/DRO08_cap.tcl

#remove_route_by_type -nets {pericore/mp200/ird_0_prd_sc[2]} -signal_detail_route
#route_zrt_group -nets {pericore/mp200/ird_0_prd_sc[2]} -utilize_dangling_wires false -max_detail_route_iterations 20   
#set_net_routing_rule -reroute freeze [get_flat_nets n150 ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_11_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/sram_wrapper/u_rx_sram_subwrap/sram0_1/ia_0_0/i0/q_sram_18_ ] 
#set_net_routing_rule -reroute freeze [get_flat_nets cpusys/bpm/rx_intc/ANT_ECO100 ] 

# freeze net for shorts #
##set_net_routing_rule -reroute freeze [get_flat_nets *]
## foreach unfreeze_net [file_to_list $route] {
##   puts ">>> unfreeze net (w/ segments) : $unfreeze_net"
##   set_net_routing_rule -reroute normal [get_nets -segments -all $unfreeze_net]
## }


##set net_coll []
##foreach tmp [list_drc_error_types] {
## foreach_in_coll elm [get_drc_errors -type $tmp] {
##  set bbox [get_attr $elm bbox ]
##  set net [get_attr $elm nets]
##  set net_coll [add_to_coll $net_coll $net]
##  if {[sizeof_coll $net] < 1} {echo [get_attr $elm info]}
## }
##}
##set_net_routing_rule -reroute freeze [get_flat_nets $net_coll]
  
#save_mw_cel -as 522_filler_icc

#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level high
#route_zrt_detail -incremental true -max_number_iterations 25 -coordinates {  {-459.020 -877.720} {-4.800 -375.960} }
#save_mw_cel -as 522_macro_on_icc

# ADD COMENT 2012.05.09
#set_net_routing_rule -reroute minorchange [get_flat_nets * -filter "net_type == Clock"]
#set_route_zrt_detail_options -repair_shorts_over_macros_effort_level off




set_route_zrt_detail_options -antenna false
set_route_zrt_common_options -post_detail_route_redundant_via_insertion off
set_route_zrt_common_options -concurrent_redundant_via_mode off
set_route_zrt_detail_options -optimize_wire_via_effort_level off
set_route_zrt_common_options -eco_route_concurrent_redundant_via_effort_level low
set_route_zrt_common_options -eco_route_concurrent_redundant_via_mode off
#set_route_zrt_common_options -connect_within_pins_by_layer_name {{M1 off}}

route_zrt_eco -reroute modified_nets_first_then_others -max_detail_route_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_40



route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_80

route_zrt_detail -incremental true -max_number_iterations 40
save_mw_cel -as ${_CEL_SAVE_NAME}_120

route_zrt_detail -incremental true -max_number_iterations 40









########################################################################################
### CONNECT P/G
########################################################################################

if {[file exists [which $ICC_IN_UPF_FILE]]} {
  derive_pg_connection -create_nets -verbose
  derive_pg_connection -reconnect
  derive_pg_connection -tie
} else {
  if {[file exists [which $CUSTOM_CONNECT_PG_NETS_SCRIPT]]} {
    echo "SCRIPT-Info : CUSTOM_CONNECT_PG_NETS_SCRIPT == $CUSTOM_CONNECT_PG_NETS_SCRIPT"
    source -echo $CUSTOM_CONNECT_PG_NETS_SCRIPT
  } else {
    derive_pg_connection -power_net $MW_POWER_NET -power_pin $MW_POWER_PORT \
                         -ground_net $MW_GROUND_NET -ground_pin $MW_GROUND_PORT
    if {!$ICC_TIE_CELL_FLOW} {
      derive_pg_connection -power_net $MW_POWER_NET -ground_net $MW_GROUND_NET -tie
    }
  }
}

printTime

if {$MV_MODE == "true"} {

  check_mv_design -verbose > $REPORTS_DIR/${_CEL_SAVE_NAME}.mv

}
save_mw_cel -as $_CEL_SAVE_NAME



## For filler insertion
source FP150324_blockages.tcl
source partial_placement_blockage.dump
remove_placement_blockage [get_placement_blockage -filter "type==soft"]




########################################################################################
### FILLER INSERTION
########################################################################################
insert_stdcell_filler  -cell_without_metal "TM6FILL64P TM6FILL32P TM6FILL16P TM6FILL8P TM6FILL4P TM6FILL2P TM6FILL1P"  \
-cell_with_metal "TM6NCAPZ64 TM6NCAPZ32 TM6NCAPZ16 TM6NCAPZ8 TM6NCAPZ4" -cell_without_metal_prefix "without_metal"  \
-cell_with_metal_prefix "with_metal" -connect_to_power {VDD}  -connect_to_ground {GND} -ignore_soft_placement_blockage

source /svhome/rx100gr/data/r5f51305/4_implement/45_pwrdesign/pre/v100/iccompilerdir/r5f51305a.pgcon4icc_incremental


########################################################################################
### Save
########################################################################################
define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
save_mw_cel -as ${_CEL_SAVE_NAME}_chname


remove_cell [get_flat_cells -all -filter "ref_name=~CUX4F3221" ]
save_mw_cel -as ${_CEL_SAVE_NAME}_for_RC

sh date > FLAG_END_${_CEL_SCRIPT_ID}
sh date > ${_CEL_SAVE_NAME}

########################################################################################
## Get report Vth_tario 
########################################################################################

if {[file exists [which $RENESAS_REPORT_VTH_RATIO_TCL]]} {
  source $RENESAS_REPORT_VTH_RATIO_TCL
  report_threshold_voltage_group > $REPORTS_DIR/${_CEL_SAVE_NAME}_Vth_ratio.rpt
}


########################################################################################
### Get XTALK Report
########################################################################################

if {$MCMM_MODE == "false" } {

  echo "SCRIPT-Info : Single mode report_noise"

  report_noise -nworst_pins 1000 -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise
  report_noise -all_violators    -verbose  -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all
  report_noise -all_violators              -slack_type  height  > $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum

} else {

#  echo "SCRIPT-Info : MCMM_MODE report_noise"
#
#  foreach scenario [all_active_scenarios] {
#    current_scenario $scenario
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise -append \
#                    { report_noise -nworst_pins 1000 -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all -append \
#                    { report_noise -all_violators    -verbose  -slack_type  height}
#    redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.noise_all_sum -append \
#                    {report_noise -all_violators               -slack_type  height}
#
#  }

}


########################################################################################
### Create Snapshot and timing reports
########################################################################################

create_qor_snapshot -name $_CEL_SAVE_NAME
report_qor_snapshot > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor_snapshot.rpt

report_qor > $REPORTS_DIR/${_CEL_SAVE_NAME}.qor
report_constraints > $REPORTS_DIR/${_CEL_SAVE_NAME}.con
report_design -nosplit -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.design
report_net_fanout -high_fanout > $REPORTS_DIR/${_CEL_SAVE_NAME}.high_fanoutnet


if {$MCMM_MODE == "true"} { 


  echo "SCRIPT-Info : MCMM_MODE report_timing"

  report_constraints -scenario [all_active_scenarios] -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -scenario [all_active_scenarios]  -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -scenario [all_active_scenarios] -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay max -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim 
  report_timing -max_paths 100 -scenario [all_active_scenarios] -capacitance -transition_time -input_pins \
                -nets -delay min -attributes -voltage -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay max \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -scenario [all_active_scenarios] -capacitance -transition_time -input_pins -nets -delay min \
                -path full_clock_expanded -slack_lesser_than 0.0 -attributes -voltage -derate \
                -physical > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

} else {

  echo "SCRIPT-Info : Single mode report_timing"

  report_constraints -all_vio -nosplit -max_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_max
  report_constraints -all_vio -nosplit -min_delay       > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_min
  report_constraints -all_vio -nosplit -max_transition  > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_trans
  report_constraints -all_vio -nosplit -max_capacitance > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_cap
  report_constraints -all_vio -nosplit -max_fanout      > $REPORTS_DIR/${_CEL_SAVE_NAME}.vio_fanout
  report_clock_tree -drc_violators -all_drc_violators -nosplit  > $REPORTS_DIR/$_CEL_SAVE_NAME.vio_CLK_trans_cap

  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay max \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim
  report_timing -max_paths 100 -capacitance -transition_time -input_pins -nets -delay min \
                -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim
  report_timing -capacitance -transition_time -input_pins -nets -delay max -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.max.tim_full
  report_timing -capacitance -transition_time -input_pins -nets -delay min -path full_clock_expanded \
                -slack_lesser_than 0.0 -attributes -derate > $REPORTS_DIR/${_CEL_SAVE_NAME}.min.tim_full

}


##################################################################################
## Report Clock Tree
##################################################################################

report_congestion -grc_based -by_layer -routing_stage global > $REPORTS_DIR/${_CEL_SAVE_NAME}.route

report_clock_tree -nosplit              > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_default
report_clock_tree -summary -nosplit     > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_summary
report_clock_tree -exceptions -nosplit  > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_exceptions
report_clock_tree -drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_drcvio
report_clock_tree -all_drc_violators -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_alldrcvio
report_clock_tree -structure    > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_structure

#report_clock_tree -partial_structure_within_exceptions > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_tree_partial_structure

report_clock_timing -type skew -filter_false_paths -nosplit > $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_timing

current_scenario USER1_MAX_HT_SETUP

  report_power > $REPORTS_DIR/$_CEL_SAVE_NAME.power
  report_clock_tree_power -verbose -nosplit > $REPORTS_DIR/$_CEL_SAVE_NAME.clock.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6*DFF* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.FF.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6GTD* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.GTD.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6BUFF* OR ref_name =~ TM6BUFX* OR ref_name =~ TM6BUFZ* OR ref_name =~ TM6INVX* OR ref_name =~ TM6INVZ* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.bufinv.power
  report_power -cell -only [get_flat_cells -filter { ref_name =~ TM6A* OR ref_name =~ TM6M* OR ref_name =~ TM6NA* OR ref_name =~ TM6NO* OR ref_name =~ TM6O* OR ref_name =~ TM6X* } -quiet] > $REPORTS_DIR/$_CEL_SAVE_NAME.kumi.power

#report_placement_utilization > $REPORTS_DIR/${_CEL_SAVE_NAME}.utilization
source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

### begin add Tsurume ###
#change_names -rules verilog -hierarchy
#save_mw_cel -as ${_CEL_SAVE_NAME}_chname

set RENESAS_stamp     [clock format [clock seconds] -format "%y%m%d_%H%M"]
set verilogout_no_tri true

write_verilog -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_${RENESAS_stamp}.v

write_verilog -no_physical_only_cells -unconnected_ports -no_pad_filler_cells -no_corner_pad_cells -wire_declaration -diode_ports $RESULTS_DIR/${_CEL_SAVE_NAME}_chname_unconected_${RENESAS_stamp}.v

write_verilog -pg -no_physical_only_cells -no_pad_filler_cells -no_corner_pad_cells $RESULTS_DIR/${_CEL_SAVE_NAME}_${RENESAS_stamp}_chname.pg.v

### end add Tsurume ###
#extract_rc -coupling_cap
#write_parasitics -format SPEF -compress -output $RESULTS_DIR/$_CEL_SAVE_NAME.output.spef



source ./FILES/SCR/report_redundant_ratio_for_clock.tcl_mod
redirect $REPORTS_DIR/${_CEL_SAVE_NAME}.clock_wvia report_redundant_ratio_for_clock

close_mw_cel

redirect /dev/null "remove_mw_cel -version_kept 0 ${_CEL_SAVE_NAME}_TMP"

printTime

##sh date > FLAG_END_$_CEL_SCRIPT_ID
exit
---46:800_output_icc.tcl---
##########################################################################################
### 800_outputs_icc: Outputs Design for Zroute ### (V08.00.00) 2012.03.09 ##########################################################################################

########################################################################################
### Local variable setting
########################################################################################
set _CEL_LOAD_NAME 510_init_route_icc
set _CEL_SCRIPT_ID 800

set NET_VER v010r4s00I0p05e00f_170914b

echo "Defined-Info : _CEL_LOAD_NAME $_CEL_LOAD_NAME"
#echo "Defined-Info : _CEL_SAVE_NAME $_CEL_SAVE_NAME"
echo "Defined-Info : _CEL_SCRIPT_ID $_CEL_SCRIPT_ID"

########################################################################################
### SET PREFIX FOR GDS FILE NAME
########################################################################################
set GDSDIR "./results"
catch {exec mkdir $GDSDIR}


source icc_setup.tcl

echo "#################################################################################"
echo "SCRIPT-Info (Global) : ICC_CREATE_MODEL == " $ICC_CREATE_MODEL 
echo "SCRIPT-Info (Global) : ICC_FIX_ANTENNA == " $ICC_FIX_ANTENNA 
echo "#################################################################################"

printTime

########################################################################################
### Open Design
########################################################################################

open_mw_lib $MW_DESIGN_LIBRARY
open_mw_cel -readonly ${_CEL_LOAD_NAME}


define_name_rules verilog -case_insensitive
change_names -rules verilog -hierarchy
set verilogout_no_tri true
write_verilog -no_physical_only_cells -no_flip_chip_bump_cells -no_pad_filler_cells -wire_declaration -diode_ports \
               results/${DESIGN_NAME}_${NET_VER}.v

set mw_site_name_mapping { {CORE unit006} }
write_def \
  -output             ./results/${DESIGN_NAME}_${NET_VER}.def.gz \
  -version            5.5 \
  -unit               100 \
  -compressed         \
  -rows_tracks_gcells \
  -all_vias           \
  -components         \
  -pins               \
  -blockages          \
  -specialnets        \
  -nets

########################################################################################
### GDSII
### Set options - usually also include a mapping file (-map_layer) 
########################################################################################
if {1} {
set RENESAS_output_topstructure $DESIGN_NAME 
set RENESAS_libraryName [get_attribute [current_mw_lib] name] 
set RENESAS_cellName [get_attribute [current_mw_cel] name] 
set RENESAS_Prefix ""
set RENESAS_cellMapFile "cellMapFile"
set RENESAS_stamp [clock format [clock seconds] -format "%y%m%d_%H%M"] 
set RENESAS_GDSFile ${RENESAS_libraryName}_${RENESAS_cellName}_${RENESAS_stamp}.gdsii
set RENESAS_LayerMapFile /design02/RX130_256KB/data/r5f51306/0_lib/STD/MF3_Manatii_MF3_OPENCAD_Technology_file_Package/data/MF3_SH/TechFiles/ICC/MF3/MF3_gdsOutLayer.map

set RENESAS_fp [ open ./$RENESAS_cellMapFile w ] 
puts $RENESAS_fp "$RENESAS_cellName $RENESAS_output_topstructure"
close $RENESAS_fp

set_write_stream_options -reset

set_write_stream_options \
-child_depth 0 \
-output_filling fill \
-output_outdated_fill \
-output_pin {text geometry} \
-compressed \
-max_name_length 127 \
-keep_data_type \
-rename_cell $RENESAS_cellMapFile \
-map_layer $RENESAS_LayerMapFile

#source -echo ./FILES/PG/r5f51115.pgcon4icc_initial
#source -echo ./FILES/PG/r5f51115.pgcon4icc_incremental
#source -echo ./FILES/PG/r5f51115.pgcontieHL4icc

write_stream $GDSDIR/$RENESAS_GDSFile \
-lib_name $RENESAS_libraryName \
-format gds \
-cells $RENESAS_cellName
}
close_mw_cel
printTime

sh date > 800_output_icc
sh date > FLAG_END_${_CEL_SCRIPT_ID}

exit

---47:add_cell_timing_derare_0p_min.tcl---
#modify begin LWH
#### derating for 0% ==> 5%
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X01]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X02]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X03]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X04]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X05]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X06]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X07]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X08]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X09]
#modify end LWH
---48:add_cell_timing_derare_8p_max.tcl---
#modify begin LWH
#### derating 5%
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X01]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X02]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X03]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X04]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X05]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X06]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X07]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X08]
set_timing_derate -early 0.95 -cell_delay [get_lib_cells */*X09]
#modify end LWH
---49:add_cell_timing_derate_for_postcts.tcl---
set_timing_derate  -late 1.05 -cell_delay [get_lib_cells *Pff*/*X01]
set_timing_derate  -late 1.05 -cell_delay [get_lib_cells *Pff*/*X02]
set_timing_derate  -late 1.05 -cell_delay [get_lib_cells *Pff*/*X03]
set_timing_derate  -late 1.05 -cell_delay [get_lib_cells *Pff*/*X04]
set_timing_derate  -late 1.05 -cell_delay [get_lib_cells *Pff*/*X05]

set_timing_derate  -late 1.10 -cell_delay [get_lib_cells *Pss*/*X01]
set_timing_derate  -late 1.10 -cell_delay [get_lib_cells *Pss*/*X02]
set_timing_derate  -late 1.10 -cell_delay [get_lib_cells *Pss*/*X03]
set_timing_derate  -late 1.10 -cell_delay [get_lib_cells *Pss*/*X04]
set_timing_derate  -late 1.10 -cell_delay [get_lib_cells *Pss*/*X05]
set_timing_derate  -late 1.05 -cell_delay [get_lib_cells *Pss*/*X06]
set_timing_derate  -late 1.05 -cell_delay [get_lib_cells *Pss*/*X07]
set_timing_derate  -late 1.05 -cell_delay [get_lib_cells *Pss*/*X08]
set_timing_derate  -late 1.05 -cell_delay [get_lib_cells *Pss*/*X09]
---50:add_cell_timing_derate_setup.tcl---
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pff*/*X01]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pff*/*X02]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pff*/*X03]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pff*/*X04]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pff*/*X05]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pff*/*X06]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pff*/*X07]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pff*/*X08]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pff*/*X09]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pss*/*X01]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pss*/*X02]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pss*/*X03]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pss*/*X04]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pss*/*X05]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pss*/*X06]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pss*/*X07]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pss*/*X08]
set_timing_derate  -early 1 -cell_delay [get_lib_cells MF3TM6*Pss*/*X09]
---51:add_cell_timing_derate.tcl---
#### derating for 0% ==> 15% and 5%
set_timing_derate  -early 0.85 -cell_delay [get_lib_cells *Pff*/*X01]
set_timing_derate  -early 0.85 -cell_delay [get_lib_cells *Pff*/*X02]
set_timing_derate  -early 0.85 -cell_delay [get_lib_cells *Pff*/*X03]
set_timing_derate  -early 0.85 -cell_delay [get_lib_cells *Pff*/*X04]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pff*/*X05]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pff*/*X06]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pff*/*X07]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pff*/*X08]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pff*/*X09]

#### derating for 8% ==> 25% and 5%
set_timing_derate  -early 0.75 -cell_delay [get_lib_cells *Pss*/*X01]
set_timing_derate  -early 0.75 -cell_delay [get_lib_cells *Pss*/*X02]
set_timing_derate  -early 0.75 -cell_delay [get_lib_cells *Pss*/*X03]
set_timing_derate  -early 0.75 -cell_delay [get_lib_cells *Pss*/*X04]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pss*/*X05]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pss*/*X06]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pss*/*X07]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pss*/*X08]
set_timing_derate  -early 0.95 -cell_delay [get_lib_cells *Pss*/*X09]
---52:common_cts_settings_icc.tcl---
###########################################################################################
### CTS Common Session Options - set in place_opt and clock_opt sessions
###                                                               (V08.00.00) 2012.03.09
###########################################################################################

########################################################################################
###                Hidden Variable
### CAUTION : The following variables are hidden variable and SNPS will not validate
###           these. EDA recommends that these variables should not be set if you don't
###           need. Please contact EDA support member if you need to use these variables.
########################################################################################

########################################################################################
### Set routing layer constraints as soft rule (if turn off = FALSE)
### Default is TRUE (apply hard rule)
########################################################################################

#set cts_icgr_hard_max_layer_constraint false
#set cts_icgr_hard_min_layer_constraint false

########################################################################################
### insert clock guide buffer in feed-back loops to separate data and clock line.
### Default is FALSE
########################################################################################

#set cts_separate_data_pin true

########################################################################################
### The following variables are hidden variables to prevent the issue that 
### compile_clock_tree generates paths through voltage area without isolation cell.
### This variables must be set with 'set cts_region_aware false'.
########################################################################################

#set cts_insert_voltage_area_guide_buffers_after_separate_always_on_pins true 
#set cts_check_non_upf_iso_net_dont_touch true


########################################################################################
###                Variables
########################################################################################


########################################################################################
### CTS Batch Mode for clock_opt to decrease 
###	# DEFAULT : FALSE
########################################################################################

set cts_clock_opt_batch_mode false

########################################################################################
### Region Aware CTS mode
### DEFAULT : TRUE
########################################################################################

set cts_region_aware false

########################################################################################
### add fixed attributer for end point of synthesized clock tree.
### DEFAULT : FALSE
########################################################################################

#set cts_fix_clock_tree_sinks true

########################################################################################
### CTS Debug Mode 
### DEFAULT : FALSE
########################################################################################

set cts_use_debug_mode false

########################################################################################
### Turn on DRC fixing during optimize_clock_tree.
### DEFAULT : FALSE
########################################################################################

#set cto_enable_drc_fixing true

########################################################################################
### Enable interclock delay balancing to use the the delay calculation model
### specified by the set_delay_calculation command.
### DEFAULT : TRUE
########################################################################################

set use_improved_icdb true

########################################################################################
### Disable removal unloaded cells and unloaded sequential cells in CTS phase.
### DEFAULT : TRUE
########################################################################################

set physopt_delete_unloaded_cells false
set physopt_delete_unloaded_sequential_cells false

########################################################################################
###                Commands
########################################################################################


########################################################################################
### use Arnoldi-based delay model for ICGR to correlate with post-route
### TAT for CTO will be increased
########################################################################################

set_delay_calculation -routed_clock  arnoldi 


########################################################################################
### SET CLOCK TREE REFERENCES (BUFFER LIST, ETC)
### NOTE : REFERENCES ARE CUMULATIVE.
########################################################################################

#if {$ICC_CTS_REF_LIST != "" || $ICC_CTS_REF_SIZING_ONLY != "" || $ICC_CTS_REF_DEL_INS_ONLY != ""} {
#    reset_clock_tree_references}
#
#if {$ICC_CTS_REF_LIST != ""} {
#   set_clock_tree_references -references $ICC_CTS_REF_LIST}
#if {$ICC_CTS_REF_DEL_INS_ONLY != ""} {
#   set_clock_tree_references -delay_insertion_only -references $ICC_CTS_REF_DEL_INS_ONLY}
#if {$ICC_CTS_REF_SIZING_ONLY != ""} {
#   set_clock_tree_references -sizing_only -references $ICC_CTS_REF_SIZING_ONLY}
#	
#########################################################################################
#### INSERT BOUNDARY CELL
#########################################################################################
#
#if {$ICC_CTS_REF_BC_ONLY != ""} {
#   set_clock_tree_references -boundary_cell_only -references $ICC_CTS_REF_BC_ONLY
#   set_clock_tree_options -insert_boundary_cell true }

########################################################################################
### CLOCK NDR's
### Specify the rule prior to CTS so that CTS can predict its effects
### Avoid setting the rule on metal 1 - avoids pin access issues on 
### buffers and gates in the tree
########################################################################################

#redirect -var x {report_routing_rules $ICC_CTS_RULE_NAME}
#if {$ICC_CTS_RULE_NAME != "" && [regexp "Info: No nondrule" $x]} {
# define_routing_rule $ICC_CTS_RULE_NAME -default_reference_rule \
#       -spacings "BEST_PRACTICE_clock_ndr_metal_layer_and_spacing" \
#       -widths "BEST_PRACTICE_clock_ndr_metal_layer_and_width" \
#       -via_cuts "BEST_PRACTICE_clock_ndr_via_name_and_mXn_pairs"
#report_routing_rule $ICC_CTS_RULE_NAME

#NSGK# Added
#RDC#define_routing_rule iccrm_clock_double_spacing -default_reference_rule -multiplier_spacing 2
#RDC#report_routing_rule iccrm_clock_double_spacing
#RDC#set_clock_tree_options -routing_rule iccrm_clock_double_spacing


########################################################################################
### at 65 nm, better SI protection if you put NDR on sink, provided you 
### don't set the NDR on pin access layers
### otherwise set -use_default_routeing_for_sinks to 1 to avoid NDR on 
### clock sink
### set_clock_tree_options -layer_list $ICC_CTS_LAYER_LIST 
###   -routing_rule $ICC_CTS_RULE_NAME -use_default_routing_for_sinks 1
### Typically route clocks on metal3 and above
########################################################################################

if {$ICC_CTS_LAYER_LIST != ""} {set_clock_tree_options -layer_list $ICC_CTS_LAYER_LIST}

########################################################################################
### SET CLOCK TREE OPTIONS for CTS
########################################################################################

set_clock_tree_options \
  -ocv_clustering true

#RDC#
set_clock_tree_options \
  -routing_rule CLOCK_NET \
  -use_default_routing_for_sinks 1
#RDC#

#NSGK# added
set_clock_tree_options \
    -target_skew 5.0 \
    -max_transition  5 \
    -max_capacitance 1.3 \
    -max_fanout       500 \
    -operating_condition max

# set_clock_tree_options \
#    -clock_trees [get_clocks xxxx ] \
#    -target_skew 0.3 \
#    -target_early_delay 0 \
#    -max_transition  0.5 \
#    -max_fanout       32 \
#    -layer_list {M4 M5} \
#    -routing_rule CLOCK_NET \
#    -buffer_relocation true \
#    -gate_sizing true \
#    -gate_relocation true \
#    -buffer_sizing true

########################################################################################
### SET CLOCK TREE OPTIMIZATION OPTIONS for CTO
########################################################################################

# set_clock_tree_optimization_options \
#    -clock_trees [get_clocks xxxx ] \
#    -gate_sizing true \
#    -gate_relocation true


########################################################################################
### INTER CLOCK TREE OPTIONS 
### Must also edit clock_opt_icc.tcl script and 
### set -inter_clock_balance on the clock_opt -only_cts line
########################################################################################

# set_inter_clock_delay_options \
#  -balance_group <balance_group> \
#  -target_delay_clock <target_delay_clock> \
#  -target_delay_value <target_delay_value> \
#  -delay_offset <delay_offset> \
#  -offset_to <offset_to> \
#  -offset_from <offset_from>

########################################################################################
### SKEW GROUP OPTIONS
### You must edit clock_opt_icc.tcl script and 
### add "commit_skew_group" before compile_clock_tree
### ICC cannot handle skew group with ocv_clustering.
########################################################################################

# set_clock_tree_options -ocv_clustering false
# set_skew_group -name <group_name> \
#		 -target_skew <desired_skew> \
#		 -target_early_delay <min_delay> \
#		 <pin_name1 pin_name2>

#########################################################
##                                                     ##
##        End of CTS Optimization Sesssion Options     ##
##                                                     ##
#########################################################

#NSGK# Added
foreach cts_ref $ICC_CTS_REF_LIST {
  set_attribute [get_lib_cells */$cts_ref] dont_use false
  set_attribute [get_lib_cells */$cts_ref] dont_touch false
  echo "set_attribute \[get_lib_cells */$cts_ref\] dont_use false"
  echo "set_attribute \[get_lib_cells */$cts_ref\] dont_touch false"
}

---53:common_optimization_settings_icc.tcl---
###########################################################################################
###  Optimization Common Session Options - set in all sessions
###                                                               (V08.00.00) 2012.03.09
###########################################################################################

########################################################################################
###                Hidden Variable
### CAUTION : The followings variables are hidden variable and SNPS will not validate
###           these. EDA recommends that these variables should not be set if you don't
###           need. Please contact EDA support member if you need to use these variables.
########################################################################################


########################################################################################
### enable pin name keep for exception attached point 
### DEFAULT : FALSE
### NOTE : set this hidden variable to true, because the most users need to 
###        turn on this variable for consistency of constrains.
########################################################################################

set psyn_enable_sizing_with_pin_name_check true

########################################################################################
### enable unused register removal
### DEFAULT : TRUE
########################################################################################

#set physopt_delete_unloaded_sequential_cells true
set physopt_delete_unloaded_sequential_cells false

########################################################################################
### Need to set the following variables if design has multiple height row
########################################################################################

#set icc_refine_multi_site_loc true

########################################################################################
### Workaround for detour route with repeater insertion.
### These variables are necessary for the following situation.
### (1) Timing constraint is not existed for the path.
### (2) Less fanout and large placement blockage is existed for the area.
########################################################################################

#set icc_enable_low_fanout_synthesis true 
#set icc_LFS_include_non_hier_net true 
#set icc_LFS_blocked_bbox_area_ratio 0.6

########################################################################################
### Change AHFS algorithm.
### AHFS algorithm changes in 2010.03 and 2010.12.
### If you want to use 2010.03 AHFS algorithm, you do 
### "set zbuf_enable_skip_clock_network false". 
### If you want to use 2009.06 AHFS algorithm, you do
### "set hfs_optimize_buffer_trees false".
########################################################################################

#  set zbuf_enable_skip_clock_network false

#  set hfs_optimize_buffer_trees false

########################################################################################
### Control whether VA aware routing is enable or not during virtual route.
### Default behavior is VA aware routing (FALSE).
### You need to set TRUE if you do not apply VA aware routing.
########################################################################################

# set mv_disable_voltage_area_aware_detor_routing true

########################################################################################
###                Variables
########################################################################################

########################################################################################
### Compute pessimism removal with same method as primetime ==> set true
### PrimeTime default is true.
### DEFAULT : TRUE
########################################################################################

set timing_crpr_remove_muxed_clock_crp true


########################################################################################
### enable cpu and momory consumption logging
### DEFAULT : FALSE
########################################################################################

set monitor_cpu_memory true

########################################################################################
### enable via resistance consideration during virtual route RC estimation
### DEFAULT : FALSE
########################################################################################

set physopt_enable_via_res_support true

########################################################################################
### enable high effort area reduction. run time should be longer if you set TRUE
### DEFAULT : FALSE
########################################################################################

set physopt_ultra_high_area_effort false

########################################################################################
### Need to set the following variables if design has multiple height row
########################################################################################

set physopt_check_site_array_overlap false
set physopt_heterogeneous_site_array true

########################################################################################
### Determins whether case analysis is propagated across sequential cells.
### DEFAULT : never
### NOTE: change the variable to always, if PrimeTime(STA) set it to always.
########################################################################################

#set case_analysis_sequential_propagation never

########################################################################################
###                COMMANDS                                               
### CAUTION                                                               
### do not use values in sample command.                                   
### you need to modify the option and valus correspond to design specific. 
########################################################################################

########################################################################################
### specify the percentage of lvth cell during optimization
### this option is affected to place_opt, psynopt and route_opt
### CAUTION : this option will lead to timing violation if you set lower the percentage 
### which is compared with the actual timing.
########################################################################################

# Edit the following to set the threshold voltage groups in the libraries
# set_attribute <my_hvt_lib> default_threshold_voltage_group HVT -type string
# set_attribute <my_lvt_lib> default_threshold_voltage_group LVT -type string

#set_max_lvth_percentage will be obsolete in a future.
# The value is from 0 to 100.

# below command is new. however we dont confirm this command.
# set_multi_vth_constraint -lvth_groups { LVT } -lvth_percentage <percent value>
### The value is from 0 to 100.
### set_multi_vth_constraint can be use
###       with the options -cost area and -type hard.

########################################################################################
### specify the threshold for high fanout nets correction
### this option is used by create_buffer_tree command
### Note : This command is not available when you enable new afhs algorithm
### and you can't control fanout during new afhs.
########################################################################################

#set_cbt_options -threshold 60

########################################################################################
### specify drc fix nets : this setting is disable drc fix for constant net.
########################################################################################

#set_auto_disable_drc_nets -constant false

########################################################################################
### specify direction of scan chain partitioning. default is adaptive.
########################################################################################

#set_optimize_dft_options -repartitioning_method adaptive

########################################################################################
### buffer or inverter redution will be improved if you set high (default medium)
########################################################################################

set_buffer_opt_strategy -effort medium

########################################################################################
### setting for leakage power optimization
########################################################################################

#set_power_options -leakage true
#set_max_leakage_power 0

########################################################################################
### Specify number of multi core
### NOTE : On 2009.06-SP3 release, the following steps are implemented as multi
###        thread. This setting is avairable for all multi thread funcutions.
###        extract_rc, zroute, timing analysis and si analysis on post route opt.	
########################################################################################

set_host_options -max_cores $ICC_NUM_CPUS

########################################################################################
### Set Area Critical Range
### Typical value: 10 percent of critical clock period
########################################################################################

if {$AREA_CRITICAL_RANGE != ""} {
echo "set physopt_area_critical_range $AREA_CRITICAL_RANGE"
set physopt_area_critical_range $AREA_CRITICAL_RANGE}


########################################################################################
### Set Power Critical Range
### Typical value: 9 percent of critical clock period
########################################################################################

if {$POWER_CRITICAL_RANGE != ""} {
echo "set physopt_power_critical_range $POWER_CRITICAL_RANGE"
set physopt_power_critical_range $POWER_CRITICAL_RANGE}


########################################################################################
### Hold fixing cells
########################################################################################

if { $ICC_FIX_HOLD_PREFER_CELLS != ""} {
    remove_attribute $ICC_FIX_HOLD_PREFER_CELLS dont_use
echo "remove_attribute $ICC_FIX_HOLD_PREFER_CELLS dont_use"
    remove_attribute $ICC_FIX_HOLD_PREFER_CELLS dont_touch
echo "remove_attribute $ICC_FIX_HOLD_PREFER_CELLS dont_touch"
    set_prefer -min $ICC_FIX_HOLD_PREFER_CELLS
echo "set_prefer -min $ICC_FIX_HOLD_PREFER_CELLS"
}


########################################################################################
## Fixing the locations of the hard macros
########################################################################################

if {[all_macro_cells] != "" } {
echo " set_dont_touch_placement [all_macro_cells]" 
  set_dont_touch_placement [all_macro_cells] 
}

########################################################################################
### enable clock gating check for primitive cells.
### NOTE: If you want to check clock gating for AND/OR cells,
### you can specify "set_clock_gating_check -setup 0 [all_clocks]" per scenario.
### In this case, you should set the following variable to
### ignore specifed setup time for ICG.
########################################################################################

#set timing_scgc_override_library_setup_hold false

#NSGK#
#set_extraction_options -max_cap_scale 0.95 -min_cap_scale 0.95 -max_res_scale 0.95 -min_res_scale 0.95
#set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95
set_extraction_options \
  -min_process_scale 0.95 -max_process_scale 0.95 \
  -min_res_scale   1.0000 -max_res_scale   1.0146 \
  -min_cap_scale   1.0000 -max_cap_scale   1.0113

########################################################################################
## Removing the local_link_library attribute from current_design 
## to avoid searching missing libraries.
########################################################################################

echo "Removing local_link_library attribute from current_design..."
remove_attribute [current_design] local_link_library



######################################################
##                                                  ##
##    End of Common Optimization Session Options    ##
##                                                  ##
######################################################
---54:common_placement_settings_icc.tcl---
###########################################################################################
### Placement Common Session Options - set in all sessions
###                                                               (V08.00.00) 2012.03.09
###########################################################################################

########################################################################################
###                Hidden Variable
### CAUTION : The followings variables are hidden variable and SNPS will not validate
###           these. EDA recommends that these variables should not be set if you don't
###           need. Please contact EDA support member if you need to use these variables.
########################################################################################

########################################################################################
### disable auto hard keepout margin (Pin count based) around hard macros.
### DEFAULT : 2 
########################################################################################

#set legalize_auto_x_keepout_margin 0
#set legalize_auto_y_keepout_margin 0

########################################################################################
###                Variables
########################################################################################

########################################################################################
### W/A setting to avoid legalize error
### Please try to set the following variables when legalize error occured
########################################################################################
#set legalizer_enable_timeout false
#set legalizer_skip_overcapacity_check true

########################################################################################
### run global router during placement for congestion removal
### CAUTION : run time will be longer when you set TRUE. Especially the multi threading
### capability can't invoke during this step from 2010.03-SP3.
### DEFAULT : FALSE
########################################################################################

#set placer_enable_enhanced_router false 
set placer_enable_enhanced_router true 
set placer_enable_high_effort_congestion true

########################################################################################
### allow internal pin access by user
### DEFAULT : TRUE
########################################################################################

set access_internal_pins true

########################################################################################
### specify max density as global constraint
### You can specify lower value if you want avoid local congestion.
########################################################################################

set placer_max_cell_density_threshold -1

########################################################################################
### physopt places implicit dont_touch on nets connected to pin which
### has "is_pad" attribute.
########################################################################################

set physopt_pin_based_pad true

########################################################################################
### This variable enables high-effort congestion removal during congestion-driven coarse 
### when set to placement
########################################################################################

#set placer_enable_high_effort_congestion true

########################################################################################
###                Commands
########################################################################################

########################################################################################
### CAUTION 
### do not use values in sample command.
### you need to modify the option and valus correspond to design specific.
###
### set keepout (padding) for celltype and instance
###
### set_keepout_margin -type soft -outer [10 0 10 0] -macro_masters XXX
###
### set max density for specified area
###
### set_congestion_options -max_util 0.75 -coordinate {0 100 0 100}
########################################################################################

########################################################################################
### disable buffer insertion to fix assign statement.
### insert buffers for feedthroughs/outputs/constants/buffer_constants
### NOTE : if you want to supress buffer insertion for assign removal, you need to
###        specify only "-default" option.
###        if you want to fix assign statement with assign remove, you need to specify
###        "-all - buffer_constants" options.
###        ICC-RM default is changed from "-all -buffer_constants" to "default" from
###        2010.12-SP4 release.
########################################################################################

set_fix_multiple_port_nets -default


########################################################################################
### Set Min/Max Routing Layers
########################################################################################

if { $MAX_ROUTING_LAYER != ""} {
echo "set_ignored_layers -max_routing_layer $MAX_ROUTING_LAYER"
set_ignored_layers -max_routing_layer $MAX_ROUTING_LAYER}
if { $MIN_ROUTING_LAYER != ""} {
echo "set_ignored_layers -min_routing_layer $MIN_ROUTING_LAYER"
set_ignored_layers -min_routing_layer $MIN_ROUTING_LAYER}


########################################################################################
### Set PNET Options to control cel placement around P/G straps 
########################################################################################

if {$PNET_METAL_LIST != "" || $PNET_METAL_LIST_COMPLETE != "" } {
	echo "remove_pnet_options"
	remove_pnet_options

	if {$PNET_METAL_LIST_COMPLETE != "" } {
		echo "set_pnet_options -complete $PNET_METAL_LIST_COMPLETE -see_object {all_types}"
		set_pnet_options -complete $PNET_METAL_LIST_COMPLETE -see_object {all_types}
	}

	if {$PNET_METAL_LIST != "" } {
		echo "set_pnet_options -partial $PNET_METAL_LIST -see_object {all_types}"
		set_pnet_options -partial $PNET_METAL_LIST -see_object {all_types} 
	}
	
	echo "report_pnet_options"
	report_pnet_options
}


######################################################
##                                                  ##
##      End of Common Placement  Session Options    ##
##                                                  ##
######################################################

---55:common_post_cts_timing_settings.tcl---
###########################################################################################
### Common Post CTS Timing Options   - set after clock_opt sessions
###                                                               (V08.00.00) 2012.03.09
###########################################################################################

########################################################################################
###                Variables
########################################################################################
#NSGK# To enable aocvm analysis
set_app_var timing_aocvm_enable_analysis true

########################################################################################
###                Commands
### CAUTION                                                                
### do not use values in sample command.                                   
### you need to modify the option and valus correspond to design specific. 
########################################################################################

########################################################################################
### specify hold fixing method with prioritize TNS and high effort (recommend)
########################################################################################

#set_fix_hold_options -prioritize_tns -effort high
set_fix_hold_options -prioritize_tns

########################################################################################
### specify prefer hold buffer type                                        
### CAUTION : -preferred_buffer and -prooritize_tns options should be set together.
########################################################################################

#set_prefer -min [get_lib_cells RC03ATC7_max/TC7BUFXC]
#set_fix_hold_options -preferred_buffer -prioritize_tns -effort high

########################################################################################
### specify the delay calculation mode (clock_arnoldi) 
########################################################################################

set_delay_calculation -routed_clock arnoldi

########################################################################################
### Enables or disables clock reconvergence pessimism removal.
### DEFAULT : FALSE
########################################################################################

set timing_remove_clock_reconvergence_pessimism true
set timing_clock_reconvergence_pessimism  same_transition

######################################################
##                                                  ##
##      End of Common Post CTS Timing Options       ##
##                                                  ##
######################################################
---56:common_route_si_settings_zrt_icc.tcl---
###########################################################################################
### Zroute Route SI Options - set after clock_opt sessions
###                                                               (V08.00.00) 2012.03.09
###########################################################################################

########################################################################################
###                Hidden Variable
### CAUTION : The followings variables are hidden variable and SNPS will not validate
###           these. EDA recommends that these variables should not be set if you don't
###           need. Please contact EDA support member if you need to use these variables.
########################################################################################

########################################################################################
###     DENSITY DRIVEN AREA RECOVERY DURING ROUTE_OPT
########################################################################################

#set physopt_density_area_recovery true


########################################################################################
### Arnoldi is used in post Route phase
########################################################################################

set_delay_calculation -postroute arnoldi -arnoldi_effort high


########################################################################################
###                Variables
########################################################################################

#########################################################################
# INFORMATION : If you want to increase ratio of arnoldi of timing
#               analysis, you should enable the following variable.
#########################################################################

set rc_rd_more_than_rnet_arnoldi_threshold 1000000


#########################################################################
# INFORMATION : If you want to use CCS delay library, you shuold specify
#               the following variables to enable CCS mode.
#########################################################################

set rc_driver_model_mode advanced
set rc_receiver_model_mode advanced

#########################################################################
# INFORMATION : If you want to use CCS noise library, you shuold specify
#               the following variables to enable CCS mode.
#########################################################################

set rc_noise_model_mode advanced

#########################################################################
# CAUTION : If your technology is UX8L, you should set the following
#           variable to false in ICC2010.03-SPX. If this variable is set
#           to true, ECO router cannot recognize on-grid rule.
# DEFAULT : TRUE
#########################################################################

#set routeopt_preserve_routes false


########################################################################################
### enable auto save mode
########################################################################################

set routeopt_checkpoint false


########################################################################################
###                Commands
########################################################################################

########################################################################################
### enable Zroute Mode
########################################################################################

set_route_mode_options -zroute true


########################################################################################
### this setting is for diable connection to PM power mesh. 
########################################################################################


set_route_zrt_common_options \
-number_of_vias_over_global_max_layer 0 \
-global_max_layer_mode hard \
-number_of_vias_over_net_max_layer 0 \
-net_max_layer_mode hard		

########################################################################################
### recommended parameter for regular routing
########################################################################################

set_route_zrt_common_options -standard_cell_blockage_as_thin true \
                             -threshold_noise_ratio 0.35



#set_route_zrt_common_options -tie_off_mode rail_only
set_route_zrt_common_options -tie_off_mode all

set_route_zrt_global_options -effort ultra \
                             -crosstalk_driven true

set_route_zrt_track_options -crosstalk_driven true

set_route_zrt_detail_options -ignore_drc {{same_net_metal_space false}} \
                             -optimize_wire_via_effort_level medium


########################################################################################
### Redundant VIA insertion flow (Default, Concurrent, SoftRule, HardRule)
###
###  [Preparation]
###  Define double cut VIA for insertion
###  PLEASE SET THE FOLLOWING COMMAND
###  ------------------------------------------------------------------------------
###  define_zrt_redundant_vias \
###    -from_via {<from_via_list>} \
###    -to_via {<to_via_list>} \
###    -to_via_x_size {<list_of_via_x_sizes>} \
###    -to_via_y_size {<list_of_via_y_sizes>}
###  ------------------------------------------------------------------------------
###
### (1) Default Flow
###  Please run "insert_zrt_redundant_via" after initial route
###
### (2) Concurrent DV insertion
###  PLEASE SET THE FOLLOWING COMMAND BEFORE INITIAL ROUTE.
###  ------------------------------------------------------------------------------
  set_route_zrt_common_options \
    -post_detail_route_redundant_via_insertion medium
###  ------------------------------------------------------------------------------
###  PLEASE run "insert_zrt_redundant_via" after initial route
###
### (3) Soft Rule based DV insertion
###   PLEASE SET THE FOLLOWING COMMANDS BEFORE INITIAL ROUTE.
###  ------------------------------------------------------------------------------
###  set_route_zrt_common_options \
###    -post_detail_route_redundant_via_insertion medium

  set_route_zrt_common_options \
   -concurrent_redundant_via_effort_level medium
  set_route_zrt_common_options \
   -concurrent_redundant_via_mode reserve_space

###  -----------------------------------------------------------------------------
###  PLEASE run "insert_zrt_redundant_via" after initial route
###
### (4) Hard Rule based DV insertion
###  PLEASE SET THE FOLLOWING COMMANDS BEFORE INITIAL ROUTE.
###  ------------------------------------------------------------------------------
###  set_route_zrt_common_options \
###    -post_detail_route_redundant_via_insertion medium
###  set_route_zrt_common_options \
###   -concurrent_redundant_via_effort_level medium
###  set_route_zrt_common_options \
###   -concurrent_redundant_via_mode insert_at_high_cost
###  -----------------------------------------------------------------------------
###  PLEASE run "insert_zrt_redundant_via" after initial route
###
### [NOTE]
###  Flow(4) may took long runtime if the design has congestion or high utilization.
### 	
### (5) Redundant via insertion mode for eco_route
###  PLEASE SET THE FOLLOWING COMMANDS BEFORE ECO ROUTE.
###  -----------------------------------------------------------------------------
###  set_route_zrt_common_options \
###     -eco_route_concurrent_redundant_via_mode reserve_space
###  set_route_zrt_common_options \
###     -eco_route_concurrent_redundant_via_effort_level medium
###  -----------------------------------------------------------------------------
### [NOTE]
###  "insert_at_high_cost" is not supported during eco_route.
##################################################################################

########################################################################################
### recommended Xtalk analysis options
########################################################################################

set_si_options \
    -delta_delay true \
    -static_noise true \
    -timing_window false \
    -min_delta_delay true \
    -static_noise_threshold_above_low 0.35 \
    -static_noise_threshold_below_high 0.35 \
    -route_xtalk_prevention true \
    -analysis_effort medium

########################################################################################
### setting for Calibre correlation (RC03F and RC04LP)
### CAUTION : When you turn on this option, router may generate huge pseudo-errors.
### Please ask EDA a way of using this option.
########################################################################################

#set_route_zrt_common_options -connect_within_pins {{m1 via_wire_standard_cell_pins}}
#set_route_zrt_common_options -wide_macro_pin_as_fat_wire true


########################################################################################
### From 2006.06-SP4 onwards, route_opt will NOT fix nor report Delta Max 
### Tran violations.  Hence all max_tran violations exclude the portion 
### that is introduced by Xtalk.
### If you want to change this behavior, and fix max_transition violations 
### including these caused by Xtalk, please use the switch -max_transition_mode
### in set_si_options. Keep in mind that you can expect a runtime hit of up 
### to 2x in DRC fixing during route_opt.
###
###  set_si_options -delta_delay true \
###               -route_xtalk_prevention true \
###               -route_xtalk_prevention_threshold 0.35 \
###               -max_transition_mode total_slew
########################################################################################

########################################################################################
### if you want to enable Timing Windows during XDD calculaion, please use :
###  set_si_options -timing_window true 
########################################################################################
set timing_aocvm_enable_analysis true
set_route_zrt_common_options -via_array_mode swap
set_route_zrt_common_options -rotate_default_vias false
source /common/appl/Renesas/MCU_PF/MF3_Manatii-PF/MF3_OPENCAD_Technology_file_Package_V01.08.00/MF3_SH/TechFiles/ICC/MF3/cmd/zrt_OptimizeContact_MF3_5LM.tcl
---57:define_routing_rule.tcl---
remove_routing_rules -all

### For All ClockNet
define_routing_rule CLOCK_NET -default_reference_rule -taper_level 0 -taper_distance 1 \
        -widths   {M1 0.24 M2 0.24 M3 0.24 M4 0.24 M5 0.96} \
        -spacings {M1 0.22 M2 0.72 M3 0.72 M4 0.72 M5 2.88}
        #-widths   {M1 0.14 M2 0.14 M3 0.14 M4 0.14 M5 0.14 M6 0.28 M7 0.28} \
        #-spacings {M1 0.14 M2 0.14 M3 0.28 M4 0.28 M5 0.28 M6 0.56 M7 0.56}
        #-via_cuts { VIA12_HV 1X1 VIA23_VH 1X1 VIA34_HV 1X1 VIA45_VH 1X1 VIA56_HV 1X1 }         ;# Default
        #-spacings { M1 0.37 M2 0.37 M3 0.37 M4 0.37 M5 0.37 M6 0.28 }          ;# SH725x

---58:design_specific_icc.tcl---
########################################################################################
### Design Specific Constraints 
### The following constraints should be set per scenarios.
########################################################################################

remove_attribute [current_design] max_capacitance
remove_attribute [current_design] max_transition
set_max_capacitance 1.9 [current_design]
set_max_transition  4.8 [current_design]
# set_max_capacitance 0.3 [current_design]
# set_max_transition  0.6 [current_design]
# set_max_fanout       40 [current_design]
# set_critical_range  0.3 [current_design]

########################################################################################
### Set scaling factor for capacitance
### NOTE : Please set scaling factor if target technology has difference between
###       ICC and signoff.
########################################################################################

# set_extraction_options -max_cap_scale 1.0 -min_cap_scale 1.0

########################################################################################
### group path sample command
########################################################################################

# group_path -default -critical_range 0.1 -setup_margin 0.0


set_max_transition 2.4 -clock_path [all_clocks]
set_max_transition 4.8 -data_path  [all_clocks]

#set_max_capacitance 1.00 -clock_path [all_clocks]
#set_max_capacitance 1.90 -data_path  [all_clocks]
---59:mcmm.ideal.scenarios_for_new_signoff---
##########################################################################################
# mcmm.ideal.scenarios.example : Create Scenarios                (V06.00.00) 2010.09.30
##########################################################################################
########################################################
#SAMPLE FOR 2 SCENARIOS w/ CTS SCENARIO
########################################################
########################################################
# SCENARIOS
# Max_HT Setup Hold
# Min_LT Hold
# Max_LT Hold (LOCV)

# USER1
set SDC_USER1  ${IDEAL_SDC_1}

#### USER2
##set SDC_USER2  ${IDEAL_SDC_2}
##
## SCAN 
set SDC_SCAN1  ${IDEAL_SDC_3}

## AC
set SDC_AC     ${IDEAL_SDC_4}

#--- USER1_1 ---#
set SCENARIO_1                    "USER1_MAX_HT_SETUP"                ;# USER:MAX SETUP
set ICC_IN_IDEAL_SDC_1_FILE       $SDC_USER1
set OPCOND_1_MAX                  "WORST_TREE"		;# Max OpeCon Name
set OPCOND_1_MIN                  $OPCOND_1_MAX	        ;# Min OpeCon Name
set OPCOND_1_MAX_LIB              "MF3TM6_Pss_V2p0_T125"			;# Max Library Name
set OPCOND_1_MIN_LIB              $OPCOND_1_MAX_LIB   ;# Min Library Name
set TLUPLUS_MAX_1_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
set TLUPLUS_MIN_1_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file

#TMP######--- USER1_2 ---#
#TMP#####set SCENARIO_2                    "USER1_MAX_LT_SETUP"                ;# USER:MAX SETUP
#TMP#####set ICC_IN_IDEAL_SDC_2_FILE       $SDC_USER1
#TMP#####set OPCOND_2_MAX                  "WORST_TREE"
#TMP#####set OPCOND_2_MIN                  $OPCOND_2_MAX
#TMP#####set OPCOND_2_MAX_LIB              "MF3TM6_Pss_V2p0_Tm40"
#TMP#####set OPCOND_2_MIN_LIB              $OPCOND_2_MAX_LIB
#TMP#####set TLUPLUS_MAX_2_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
#TMP#####set TLUPLUS_MIN_2_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file
#TMP###
#TMP###
#TMP######--- USER2_1 ---#
#TMP#####set SCENARIO_3                    "USER2_MAX_HT_SETUP"                ;# USER:MAX SETUP
#TMP#####set ICC_IN_IDEAL_SDC_3_FILE       $SDC_USER2
#TMP#####set OPCOND_3_MAX                  "WORST_TREE"		;# Max OpeCon Name
#TMP#####set OPCOND_3_MIN                  $OPCOND_3_MAX	        ;# Min OpeCon Name
#TMP#####set OPCOND_3_MAX_LIB              "MF3TM6_Pss_V2p0_T125"			;# Max Library Name
#TMP#####set OPCOND_3_MIN_LIB              $OPCOND_3_MAX_LIB   ;# Min Library Name
#TMP#####set TLUPLUS_MAX_3_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
#TMP#####set TLUPLUS_MIN_3_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file
#TMP#####
#TMP######--- USER2_2 ---#
#TMP#####set SCENARIO_4                    "USER2_MAX_LT_SETUP"                ;# USER:MAX SETUP
#TMP#####set ICC_IN_IDEAL_SDC_4_FILE       $SDC_USER2
#TMP#####set OPCOND_4_MAX                  "WORST_TREE"
#TMP#####set OPCOND_4_MIN                  $OPCOND_4_MAX
#TMP#####set OPCOND_4_MAX_LIB              "MF3TM6_Pss_V2p0_Tm40"
#TMP#####set OPCOND_4_MIN_LIB              $OPCOND_4_MAX_LIB
#TMP#####set TLUPLUS_MAX_4_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
#TMP#####set TLUPLUS_MIN_4_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file
#TMP#####
    #--- SCAN_1 ---#
    set SCENARIO_5                    "SCAN1_MAX_HT_SETUP"                ;# USER:MAX SETUP
    set ICC_IN_IDEAL_SDC_5_FILE       $SDC_SCAN1
    set OPCOND_5_MAX                  "WORST_TREE"          ;# Max OpeCon Name
    set OPCOND_5_MIN                  $OPCOND_5_MAX         ;# Min OpeCon Name
    set OPCOND_5_MAX_LIB              "MF3TM6_Pss_V2p0_T125"                        ;# Max Library Name
    set OPCOND_5_MIN_LIB              $OPCOND_5_MAX_LIB   ;# Min Library Name
    set TLUPLUS_MAX_5_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
    set TLUPLUS_MIN_5_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file
#TMP#####
#TMP######--- SCAN_2 ---#
#TMP#####set SCENARIO_6                    "SCAN1_MAX_LT_SETUP"                ;# USER:MAX SETUP
#TMP#####set ICC_IN_IDEAL_SDC_6_FILE       $SDC_SCAN1
#TMP#####set OPCOND_6_MAX                  "WORST_TREE"
#TMP#####set OPCOND_6_MIN                  $OPCOND_6_MAX
#TMP#####set OPCOND_6_MAX_LIB              "MF3TM6_Pss_V2p0_Tm40"
#TMP#####set OPCOND_6_MIN_LIB              $OPCOND_6_MAX_LIB
#TMP#####set TLUPLUS_MAX_6_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
#TMP#####set TLUPLUS_MIN_6_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file
#TMP###
#TMP###
#TMP####--- AC_1 ---#
#TMP###set SCENARIO_7                    "AC_MAX_HT_SETUP"                ;# AC:MAX SETUP
#TMP###set ICC_IN_IDEAL_SDC_7_FILE       $SDC_AC
#TMP###set OPCOND_7_MAX                  "WORST_TREE"		;# Max OpeCon Name
#TMP###set OPCOND_7_MIN                  $OPCOND_7_MAX	        ;# Min OpeCon Name
#TMP###set OPCOND_7_MAX_LIB              "MF3TM6_Pss_V2p0_T125"			;# Max Library Name
#TMP###set OPCOND_7_MIN_LIB              $OPCOND_7_MAX_LIB   ;# Min Library Name
#TMP###set TLUPLUS_MAX_7_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
#TMP###set TLUPLUS_MIN_7_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file

##########################################################################################
################     USAGE OF ABOVE VARIABLES FOR 4 SCENARIOS     ########################
################  IF YOU HAVE MORE SCENARIOS, ADD THEM HERE BELOW  #######################
##########################################################################################

if {$TLUPLUS_MIN_1_FILE == ""} {set TLUPLUS_MIN_1_FILE $TLUPLUS_MAX_1_FILE}
##if {$TLUPLUS_MIN_2_FILE == ""} {set TLUPLUS_MIN_2_FILE $TLUPLUS_MAX_2_FILE}
##if {$TLUPLUS_MIN_3_FILE == ""} {set TLUPLUS_MIN_3_FILE $TLUPLUS_MAX_3_FILE}
##if {$TLUPLUS_MIN_4_FILE == ""} {set TLUPLUS_MIN_4_FILE $TLUPLUS_MAX_4_FILE}
if {$TLUPLUS_MIN_5_FILE == ""} {set TLUPLUS_MIN_5_FILE $TLUPLUS_MAX_5_FILE}
##if {$TLUPLUS_MIN_6_FILE == ""} {set TLUPLUS_MIN_6_FILE $TLUPLUS_MAX_6_FILE}
##if {$TLUPLUS_MIN_7_FILE == ""} {set TLUPLUS_MIN_7_FILE $TLUPLUS_MAX_7_FILE}

#--- USER1_MAX_HT_SETUP ---#
if {$SCENARIO_1 != ""} {
    echo "SCRIPT-Info : Setting up scenario $SCENARIO_1"
    create_scenario $SCENARIO_1

    set_operating_condition -analysis_type on_chip_variation \
     -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
     -max  WORST_TREE \
     -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
     -min  WORST_TREE

##add for ICC2013.12 lib read warning correction
    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl


    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_1_FILE -min_tluplus $TLUPLUS_MIN_1_FILE -tech2itf_map $MAP_FILE
   

    set auto_link_disable true
    source -echo -verbose $ICC_IN_IDEAL_SDC_1_FILE 
#	source -echo $USER1_ADD
    set auto_link_disable false

    #NSGK# Added
    set_scenario_options \
        -setup true \
        -hold false \
        -leakage_power true \
        -dynamic_power true \
        -cts_mode false

	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
	 -min_res_scale   1.0000 -max_res_scale   1.0146 \
	 -min_cap_scale   1.0000 -max_cap_scale   1.0113
	set_timing_derate -early -cell_delay 0.96
	set_timing_derate -late  -cell_delay 1
	set_timing_derate -early -net_delay 1
	set_timing_derate -late  -net_delay 1
        #source ./icc_zrt_scripts/add_cell_timing_derate_4p.tcl
	set_clock_uncertainty -setup 0.4 [all_clocks]
}


###--- USER1_MAX_LT_SETUP ---#
##if {$SCENARIO_2 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_2"
##    create_scenario $SCENARIO_2
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -min  WORST_TREE
##
####add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_lt.tcl
##
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_2_FILE -min_tluplus $TLUPLUS_MIN_2_FILE -tech2itf_map $MAP_FILE
##
##    set auto_link_disable true
##    source -echo -verbose $ICC_IN_IDEAL_SDC_2_FILE 
##	source -echo $USER1_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup true \
##        -hold false \
##        -leakage_power false \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##	set_timing_derate -early -cell_delay 0.96
##	set_timing_derate -late  -cell_delay 1
##	set_timing_derate -early -net_delay 1
##	set_timing_derate -late  -net_delay 1
##	#source ./icc_zrt_scripts/add_cell_timing_derate_4p.tcl
##	set_clock_uncertainty -setup 0.4 [all_clocks]
##}


###--- USER2_MAX_HT_SETUP ---#
##if {$SCENARIO_3 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_3"
##    create_scenario $SCENARIO_3
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
##     -min  WORST_TREE
####add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_3_FILE -min_tluplus $TLUPLUS_MIN_3_FILE -tech2itf_map $MAP_FILE
##   
##
##    set auto_link_disable true
##    source -echo -verbose $ICC_IN_IDEAL_SDC_3_FILE
##	source -echo $USER2_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup true \
##        -hold false \
##        -leakage_power true \
##        -dynamic_power false \
##        -cts_mode false
##
##        set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##        set_timing_derate -early -cell_delay 0.96
##        set_timing_derate -late  -cell_delay 1
##        set_timing_derate -early -net_delay 1
##        set_timing_derate -late  -net_delay 1
##        #source ./icc_zrt_scripts/add_cell_timing_derate_4p.tcl
##	#set_clock_uncertainty -setup 0.4 [all_clocks]
##}
##
###--- USER2_MAX_LT_SETUP ---#
##if {$SCENARIO_4 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_4"
##    create_scenario $SCENARIO_4
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -min  WORST_TREE
####add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_lt.tcl
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_4_FILE -min_tluplus $TLUPLUS_MIN_4_FILE -tech2itf_map $MAP_FILE
##
##    set auto_link_disable true
##    source -echo -verbose $ICC_IN_IDEAL_SDC_4_FILE
##	source -echo $USER2_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup true \
##        -hold false \
##        -leakage_power false \
##        -dynamic_power false \
##        -cts_mode false
##
##        set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##        set_timing_derate -early -cell_delay 0.96
##        set_timing_derate -late  -cell_delay 1
##        set_timing_derate -early -net_delay 1
##        set_timing_derate -late  -net_delay 1
##        #source ./icc_zrt_scripts/add_cell_timing_derate_4p.tcl
##	#set_clock_uncertainty -setup 0.4 [all_clocks]
##}
##
##
##
##
##
#--- SCAN1_MAX_HT_SETUP ---#
if {$SCENARIO_5 != ""} {
    echo "SCRIPT-Info : Setting up scenario $SCENARIO_5"
    create_scenario $SCENARIO_5

    set_operating_condition -analysis_type on_chip_variation \
     -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
     -max  WORST_TREE \
     -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
     -min  WORST_TREE
##add for ICC2013.12 lib read warning correction
    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl

    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_5_FILE -min_tluplus $TLUPLUS_MIN_5_FILE -tech2itf_map $MAP_FILE
   

    set auto_link_disable true
    source -echo -verbose $ICC_IN_IDEAL_SDC_5_FILE
#   source -echo $SCAN_ADD
    set auto_link_disable false

    #NSGK# Added
    set_scenario_options \
        -setup true \
        -hold false \
        -leakage_power true \
        -dynamic_power false \
        -cts_mode false

        set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
         -min_res_scale   1.0000 -max_res_scale   1.0146 \
         -min_cap_scale   1.0000 -max_cap_scale   1.0113
        set_timing_derate -early -cell_delay 0.96
        set_timing_derate -late  -cell_delay 1
        set_timing_derate -early -net_delay 1
        set_timing_derate -late  -net_delay 1
        #source ./icc_zrt_scripts/add_cell_timing_derate_4p.tcl
	#set_clock_uncertainty -setup 0.4 [all_clocks]
}

###--- SCAN1_MAX_LT_SETUP ---#
##if {$SCENARIO_6 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_6"
##    create_scenario $SCENARIO_6
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -min  WORST_TREE
####add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_lt.tcl
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_6_FILE -min_tluplus $TLUPLUS_MIN_6_FILE -tech2itf_map $MAP_FILE
##
##    set auto_link_disable true
##    source -echo -verbose $ICC_IN_IDEAL_SDC_6_FILE
##	source -echo $SCAN_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup true \
##        -hold false \
##        -leakage_power false \
##        -dynamic_power false \
##        -cts_mode false
##
##        set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##        set_timing_derate -early -cell_delay 0.96
##        set_timing_derate -late  -cell_delay 1
##        set_timing_derate -early -net_delay 1
##        set_timing_derate -late  -net_delay 1
##        #source ./icc_zrt_scripts/add_cell_timing_derate_4p.tcl
##	#set_clock_uncertainty -setup 0.4 [all_clocks]
##}
##
########################################################################################
## Check Scenarios: you can check MCMM library consistency using the following command.
########################################################################################


#--- AC_MAX_HT_SETUP ---#
##if {$SCENARIO_7 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_7"
##    create_scenario $SCENARIO_7
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
##     -min  WORST_TREE
##    ##add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_7_FILE -min_tluplus $TLUPLUS_MIN_7_FILE -tech2itf_map $MAP_FILE
##   
##
##    set auto_link_disable true
##    source -echo -verbose $SDC_AC
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup true \
##        -hold false \
##        -leakage_power false \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
##	 -min_res_scale   1.0000 -max_res_scale   1.0146 \
##	 -min_cap_scale   1.0000 -max_cap_scale   1.0113
##	set_timing_derate -early -cell_delay 0.96
##	set_timing_derate -late  -cell_delay 1
##	set_timing_derate -early -net_delay 1
##	set_timing_derate -late  -net_delay 1
##	source ./icc_zrt_scripts/add_cell_timing_derate_setup.tcl
##        #set_clock_uncertainty -setup 0.1 [all_clocks]
##
##      #  source ./FILES/SDC/setmax_adcsm_130424.tcl
##
###    source -echo -verbose ./FILES/SDC/rspi_maxdelay.tcl_3ns
##}



#check_scenarios -output $REPORTS_DIR
---60:mcmm.propa.scenarios_for_new_signoff---
##########################################################################################
# mcmm.ideal.scenarios.example : Create Scenarios                (V06.00.00) 2010.09.30
##########################################################################################
########################################################
#SAMPLE FOR 2 SCENARIOS w/ CTS SCENARIO
########################################################
########################################################
# SCENARIOS
# Min_LT Hold
# Max_LT Hold (LOCV)
set timing_library_derate_is_scenario_specific true
#  USER1 
set SDC_USER1  ${PROPA_SDC_1}

#  USER2 
set SDC_USER3  ${PROPA_SDC_2}

## DCSCAN 12.5MHz 
set SDC_DCSCAN ${PROPA_SDC_3}

## AC&&Kob
set SDC_AC ${PROPA_SDC_4}


#--- USER1_1 ---#
set SCENARIO_1                    "USER1_MAX_HT_SETUP"                ;# USER:MAX SETUP/MIN HOLD
set ICC_IN_IDEAL_SDC_1_FILE       $SDC_USER1
set OPCOND_1_MAX                  "WORST_TREE"		;# Max OpeCon Name
set OPCOND_1_MIN                  $OPCOND_1_MAX	        ;# Min OpeCon Name
set OPCOND_1_MAX_LIB              "MF3TM6_Pss_V2p0_T125"			;# Max Library Name
set OPCOND_1_MIN_LIB              $OPCOND_1_MAX_LIB   ;# Min Library Name
set TLUPLUS_MAX_1_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
set TLUPLUS_MIN_1_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file

###--- USER1_2 ---#
##set SCENARIO_2                    "USER1_MAX_LT_SETUP"                ;# USER:MAX SETUP/MIN HOLD
##set ICC_IN_IDEAL_SDC_2_FILE       $SDC_USER1
##set OPCOND_2_MAX                  "WORST_TREE"		;# Max OpeCon Name
##set OPCOND_2_MIN                  $OPCOND_2_MAX	        ;# Min OpeCon Name
##set OPCOND_2_MAX_LIB              "MF3TM6_Pss_V2p0_Tm40"			;# Max Library Name
##set OPCOND_2_MIN_LIB              $OPCOND_2_MAX_LIB   ;# Min Library Name
##set TLUPLUS_MAX_2_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
##set TLUPLUS_MIN_2_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file

##--- USER1_3 ---#
set SCENARIO_3                    "USER1_MAX_HT_HOLD"                ;# MAX HT HOLD
set ICC_IN_IDEAL_SDC_3_FILE       $SDC_USER1
set OPCOND_3_MAX                  "WORST_TREE"
set OPCOND_3_MIN                  $OPCOND_3_MAX
set OPCOND_3_MAX_LIB              "MF3TM6_Pss_V2p0_T125"
set OPCOND_3_MIN_LIB              $OPCOND_3_MAX_LIB
set TLUPLUS_MAX_3_FILE            $TLUPLUS_MIN_FILE     ;#  Max TLUplus file
set TLUPLUS_MIN_3_FILE            $TLUPLUS_MIN_FILE   ;#  Min TLUplus file

###--- USER1_4 ---#
##set SCENARIO_4                    "USER1_MAX_LT_HOLD"                ;# MAX LT HOLD
##set ICC_IN_IDEAL_SDC_4_FILE       $SDC_USER1
##set OPCOND_4_MAX                  "WORST_TREE"
##set OPCOND_4_MIN                  $OPCOND_4_MAX
##set OPCOND_4_MAX_LIB              "MF3TM6_Pss_V2p0_Tm40"
##set OPCOND_4_MIN_LIB              $OPCOND_4_MAX_LIB
##set TLUPLUS_MAX_4_FILE            $TLUPLUS_MIN_FILE     ;#  Max TLUplus file
##set TLUPLUS_MIN_4_FILE            $TLUPLUS_MIN_FILE   ;#  Min TLUplus file

#--- USER1_5 ---#
set SCENARIO_5                    "USER1_MIN_LT_HOLD"                ;# MIN LT HOLD
set ICC_IN_IDEAL_SDC_5_FILE       $SDC_USER1
set OPCOND_5_MAX                  "BEST_TREE"
set OPCOND_5_MIN                  $OPCOND_5_MAX
set OPCOND_5_MAX_LIB              "MF3TM6_Pff_V2p2_Tm40"
set OPCOND_5_MIN_LIB              $OPCOND_5_MAX_LIB
set TLUPLUS_MAX_5_FILE            $TLUPLUS_MIN_FILE     ;#  Max TLUplus file
set TLUPLUS_MIN_5_FILE            $TLUPLUS_MIN_FILE   ;#  Min TLUplus file


#--- DCSCAN_1 ---#
set SCENARIO_6                    "DCSCAN_MAX_HT_SETUP"                ;# USER:MAX SETUP/MIN HOLD
set ICC_IN_IDEAL_SDC_6_FILE       $SDC_DCSCAN
set OPCOND_6_MAX                  "WORST_TREE"		;# Max OpeCon Name
set OPCOND_6_MIN                  $OPCOND_6_MAX	        ;# Min OpeCon Name
set OPCOND_6_MAX_LIB              "MF3TM6_Pss_V2p0_T125"			;# Max Library Name
set OPCOND_6_MIN_LIB              $OPCOND_6_MAX_LIB   ;# Min Library Name
set TLUPLUS_MAX_6_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
set TLUPLUS_MIN_6_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file
     
#TMP######--- DCSCAN_2 ---#
#TMP#####set SCENARIO_7                    "DCSCAN_MAX_LT_SETUP"                ;# USER:MAX SETUP/MIN HOLD
#TMP#####set ICC_IN_IDEAL_SDC_7_FILE       $SDC_DCSCAN
#TMP#####set OPCOND_7_MAX                  "WORST_TREE"		;# Max OpeCon Name
#TMP#####set OPCOND_7_MIN                  $OPCOND_7_MAX	        ;# Min OpeCon Name
#TMP#####set OPCOND_7_MAX_LIB              "MF3TM6_Pss_V2p0_Tm40"			;# Max Library Name
#TMP#####set OPCOND_7_MIN_LIB              $OPCOND_7_MAX_LIB   ;# Min Library Name
#TMP#####set TLUPLUS_MAX_7_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
#TMP#####set TLUPLUS_MIN_7_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file
#TMP#####
#####--- DCSCAN_3 ---#
####set SCENARIO_8                   "DCSCAN_MAX_HT_HOLD"                ;# MAX HT HOLD
####set ICC_IN_IDEAL_SDC_8_FILE       $SDC_DCSCAN
####set OPCOND_8_MAX                 "WORST_TREE"
####set OPCOND_8_MIN                 $OPCOND_8_MAX
####set OPCOND_8_MAX_LIB             "MF3TM6_Pss_V2p0_T125"
####set OPCOND_8_MIN_LIB             $OPCOND_8_MAX_LIB
####set TLUPLUS_MAX_8_FILE           $TLUPLUS_MIN_FILE     ;#  Max TLUplus file
####set TLUPLUS_MIN_8_FILE           $TLUPLUS_MIN_FILE   ;#  Min TLUplus file
####
#####--- DCSCAN_4 ---#
####set SCENARIO_9                   "DCSCAN_MAX_LT_HOLD"                ;# MAX LT HOLD
####set ICC_IN_IDEAL_SDC_9_FILE       $SDC_DCSCAN
####set OPCOND_9_MAX                 "WORST_TREE"
####set OPCOND_9_MIN                  $OPCOND_9_MAX
####set OPCOND_9_MAX_LIB             "MF3TM6_Pss_V2p0_Tm40"
####set OPCOND_9_MIN_LIB              $OPCOND_9_MAX_LIB
####set TLUPLUS_MAX_9_FILE            $TLUPLUS_MIN_FILE     ;#  Max TLUplus file
####set TLUPLUS_MIN_9_FILE            $TLUPLUS_MIN_FILE   ;#  Min TLUplus file
####
#--- DCSCAN_5 ---#
set SCENARIO_10                   "DCSCAN_MIN_LT_HOLD"                ;# MIN LT HOLD
set ICC_IN_IDEAL_SDC_10_FILE       $SDC_DCSCAN
set OPCOND_10_MAX                 "BEST_TREE"
set OPCOND_10_MIN                  $OPCOND_10_MAX
set OPCOND_10_MAX_LIB             "MF3TM6_Pff_V2p2_Tm40"
set OPCOND_10_MIN_LIB              $OPCOND_10_MAX_LIB
set TLUPLUS_MAX_10_FILE            $TLUPLUS_MIN_FILE     ;#  Max TLUplus file
set TLUPLUS_MIN_10_FILE            $TLUPLUS_MIN_FILE   ;#  Min TLUplus file
     
#--- AC_1 ---#
set SCENARIO_11                    "AC_MAX_HT_SETUP"                ;# USER:MAX SETUP/MIN HOLD
set ICC_IN_IDEAL_SDC_11_FILE       $SDC_AC
set OPCOND_11_MAX                  "WORST_TREE"		;# Max OpeCon Name
set OPCOND_11_MIN                  $OPCOND_11_MAX	        ;# Min OpeCon Name
set OPCOND_11_MAX_LIB              "MF3TM6_Pss_V2p0_T125"			;# Max Library Name
set OPCOND_11_MIN_LIB              $OPCOND_11_MAX_LIB   ;# Min Library Name
set TLUPLUS_MAX_11_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
set TLUPLUS_MIN_11_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file

#TMP######--- USER2_1 ---#
#TMP#####set SCENARIO_12                    "USER2_MAX_HT_SETUP"                ;# USER:MAX SETUP/MIN HOLD
#TMP#####set ICC_IN_IDEAL_SDC_12_FILE       $SDC_USER2
#TMP#####set OPCOND_12_MAX                  "WORST_TREE"		;# Max OpeCon Name
#TMP#####set OPCOND_12_MIN                  $OPCOND_12_MAX	        ;# Min OpeCon Name
#TMP#####set OPCOND_12_MAX_LIB              "MF3TM6_Pss_V2p0_T125"			;# Max Library Name
#TMP#####set OPCOND_12_MIN_LIB              $OPCOND_12_MAX_LIB   ;# Min Library Name
#TMP#####set TLUPLUS_MAX_12_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
#TMP#####set TLUPLUS_MIN_12_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file
#TMP#####
#TMP######--- USER2_2 ---#
#TMP#####set SCENARIO_13                   "USER2_MAX_LT_SETUP"                ;# USER:MAX SETUP/MIN HOLD
#TMP#####set ICC_IN_IDEAL_SDC_13_FILE       $SDC_USER2
#TMP#####set OPCOND_13_MAX                  "WORST_TREE"		;# Max OpeCon Name
#TMP#####set OPCOND_13_MIN                  $OPCOND_13_MAX	        ;# Min OpeCon Name
#TMP#####set OPCOND_13_MAX_LIB              "MF3TM6_Pss_V2p0_Tm40"			;# Max Library Name
#TMP#####set OPCOND_13_MIN_LIB              $OPCOND_13_MAX_LIB   ;# Min Library Name
#TMP#####set TLUPLUS_MAX_13_FILE            $TLUPLUS_MAX_FILE   ;#  Max TLUplus file
#TMP#####set TLUPLUS_MIN_13_FILE            $TLUPLUS_MAX_FILE   ;#  Min TLUplus file
#TMP#####
#TMP######--- USER2_3 ---#
set SCENARIO_14                    "USER3_MAX_HT_HOLD"                ;# MAX HT HOLD
#set SCENARIO_14                    ""                ;# MAX HT HOLD
set ICC_IN_IDEAL_SDC_14_FILE       $SDC_USER3
set OPCOND_14_MAX                  "WORST_TREE"
set OPCOND_14_MIN                  $OPCOND_14_MAX
set OPCOND_14_MAX_LIB              "MF3TM6_Pss_V2p0_T125"
set OPCOND_14_MIN_LIB              $OPCOND_14_MAX_LIB
set TLUPLUS_MAX_14_FILE            $TLUPLUS_MIN_FILE     ;#  Max TLUplus file
set TLUPLUS_MIN_14_FILE            $TLUPLUS_MIN_FILE   ;#  Min TLUplus file
#TMP#####
#TMP######--- USER2_4 ---#
#TMP#####set SCENARIO_15                   "USER2_MAX_LT_HOLD"                ;# MAX LT HOLD
#TMP#####set ICC_IN_IDEAL_SDC_15_FILE       $SDC_USER2
#TMP#####set OPCOND_15_MAX                  "WORST_TREE"
#TMP#####set OPCOND_15_MIN                  $OPCOND_15_MAX
#TMP#####set OPCOND_15_MAX_LIB              "MF3TM6_Pss_V2p0_Tm40"
#TMP#####set OPCOND_15_MIN_LIB              $OPCOND_15_MAX_LIB
#TMP#####set TLUPLUS_MAX_15_FILE            $TLUPLUS_MIN_FILE     ;#  Max TLUplus file
#TMP#####set TLUPLUS_MIN_15_FILE            $TLUPLUS_MIN_FILE   ;#  Min TLUplus file
#TMP#####
#TMP######--- USER2_5 ---#
set SCENARIO_16                   "USER3_MIN_LT_HOLD"                ;# MIN LT HOLD
#set SCENARIO_16                   ""                ;# MIN LT HOLD
set ICC_IN_IDEAL_SDC_16_FILE       $SDC_USER3
set OPCOND_16_MAX                  "BEST_TREE"
set OPCOND_16_MIN                  $OPCOND_16_MAX
set OPCOND_16_MAX_LIB              "MF3TM6_Pff_V2p2_Tm40"
set OPCOND_16_MIN_LIB              $OPCOND_16_MAX_LIB
set TLUPLUS_MAX_16_FILE            $TLUPLUS_MIN_FILE     ;#  Max TLUplus file
set TLUPLUS_MIN_16_FILE            $TLUPLUS_MIN_FILE   ;#  Min TLUplus file
#TMP#####
#TMP#####

##########################################################################################
################     USAGE OF ABOVE VARIABLES FOR 4 SCENARIOS     ########################
################  IF YOU HAVE MORE SCENARIOS, ADD THEM HERE BELOW  #######################
##########################################################################################

if {$TLUPLUS_MIN_1_FILE == ""} {set TLUPLUS_MIN_1_FILE $TLUPLUS_MAX_1_FILE}
##if {$TLUPLUS_MIN_2_FILE == ""} {set TLUPLUS_MIN_2_FILE $TLUPLUS_MAX_2_FILE}
if {$TLUPLUS_MIN_3_FILE == ""} {set TLUPLUS_MIN_3_FILE $TLUPLUS_MAX_3_FILE}
##if {$TLUPLUS_MIN_4_FILE == ""} {set TLUPLUS_MIN_4_FILE $TLUPLUS_MAX_4_FILE}
if {$TLUPLUS_MIN_5_FILE == ""} {set TLUPLUS_MIN_5_FILE $TLUPLUS_MAX_5_FILE}
if {$TLUPLUS_MIN_6_FILE == ""} {set TLUPLUS_MIN_6_FILE $TLUPLUS_MAX_6_FILE}
##if {$TLUPLUS_MIN_7_FILE == ""} {set TLUPLUS_MIN_7_FILE $TLUPLUS_MAX_7_FILE}
##if {$TLUPLUS_MIN_8_FILE == ""} {set TLUPLUS_MIN_8_FILE $TLUPLUS_MAX_8_FILE}
##if {$TLUPLUS_MIN_9_FILE == ""} {set TLUPLUS_MIN_9_FILE $TLUPLUS_MAX_9_FILE}
if {$TLUPLUS_MIN_10_FILE == ""} {set TLUPLUS_MIN_10_FILE $TLUPLUS_MAX_10_FILE}
if {$TLUPLUS_MIN_11_FILE == ""} {set TLUPLUS_MIN_11_FILE $TLUPLUS_MAX_11_FILE}
##if {$TLUPLUS_MIN_12_FILE == ""} {set TLUPLUS_MIN_12_FILE $TLUPLUS_MAX_12_FILE}
##if {$TLUPLUS_MIN_13_FILE == ""} {set TLUPLUS_MIN_13_FILE $TLUPLUS_MAX_13_FILE}
if {$TLUPLUS_MIN_14_FILE == ""} {set TLUPLUS_MIN_14_FILE $TLUPLUS_MAX_14_FILE}
##if {$TLUPLUS_MIN_15_FILE == ""} {set TLUPLUS_MIN_15_FILE $TLUPLUS_MAX_15_FILE}
if {$TLUPLUS_MIN_16_FILE == ""} {set TLUPLUS_MIN_16_FILE $TLUPLUS_MAX_16_FILE}

#--- USER1_MAX_HT_SETUP ---#
if {$SCENARIO_1 != ""} {
    echo "SCRIPT-Info : Setting up scenario $SCENARIO_1"
    create_scenario $SCENARIO_1

    set_operating_condition -analysis_type on_chip_variation \
     -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
     -max  WORST_TREE \
     -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
     -min  WORST_TREE

    ##add for ICC2013.12 lib read warning correction
    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl



    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_1_FILE -min_tluplus $TLUPLUS_MIN_1_FILE -tech2itf_map $MAP_FILE
   

    set auto_link_disable true
    source -echo -verbose $SDC_USER1
#wxy 	source $USER1_ADD
    set auto_link_disable false

    #NSGK# Added
    set_scenario_options \
        -setup true \
        -hold false \
        -leakage_power true \
        -dynamic_power true \
        -cts_mode false

	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
	 -min_res_scale   1.0000 -max_res_scale   1.0146 \
	 -min_cap_scale   1.0000 -max_cap_scale   1.0113
	set_timing_derate -early -cell_delay 0.96
	set_timing_derate -late  -cell_delay 1
	set_timing_derate -early -net_delay 1
	set_timing_derate -late  -net_delay 1
	source ./icc_zrt_scripts/add_cell_timing_derate_setup.tcl
        #set_clock_uncertainty -setup 0.15 [all_clocks]

#    source -echo -verbose ./FILES/SDC/rspi_maxdelay.tcl_3ns
}

###--- USER1_MAX_LT_SETUP ---#
##if {$SCENARIO_2 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_2"
##    create_scenario $SCENARIO_2
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -min  WORST_TREE
##    ##add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_lt.tcl
##
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_2_FILE -min_tluplus $TLUPLUS_MIN_2_FILE -tech2itf_map $MAP_FILE
##   
##
##    set auto_link_disable true
##    source -echo -verbose $SDC_USER1
##	source $USER1_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup true \
##        -hold false \
##        -leakage_power true \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##	set_timing_derate -early -cell_delay 0.96
##	set_timing_derate -late  -cell_delay 1
##	set_timing_derate -early -net_delay 1
##	set_timing_derate -late  -net_delay 1
##	#source ./icc_zrt_scripts/add_cell_timing_derate_setup.tcl
##        #set_clock_uncertainty -setup 0.15 [all_clocks]
##}
##

#--- USER1_MAX_HT_HOLD ---#
if {$SCENARIO_3 != ""} {
    echo "SCRIPT-Info : Setting up scenario $SCENARIO_3"
    create_scenario $SCENARIO_3

    set_operating_condition -analysis_type on_chip_variation \
     -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
     -max  WORST_TREE \
     -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
     -min  WORST_TREE

    ##add for ICC2013.12 lib read warning correction
    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl

    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_3_FILE -min_tluplus $TLUPLUS_MIN_3_FILE -tech2itf_map $MAP_FILE

    set auto_link_disable true
    source -echo -verbose $SDC_USER1
#wxy 	source $USER1_ADD
    set auto_link_disable false

    #NSGK# Added
    set_scenario_options \
        -setup false \
        -hold true \
        -leakage_power false \
        -dynamic_power false \
        -cts_mode false

	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
         -min_res_scale   1.0000 -max_res_scale   1.0146 \
         -min_cap_scale   1.0000 -max_cap_scale   1.0113
        set_timing_derate -early -cell_delay 0.92
        set_timing_derate -late  -cell_delay 1
        set_timing_derate -early -net_delay 0.93
        set_timing_derate -late  -net_delay 1.07
        source ./icc_zrt_scripts/add_cell_timing_derate.tcl

        #set_clock_uncertainty -setup 0.1 [all_clocks]
        set_clock_uncertainty -hold 0.1 -from [all_clocks] -to [all_clocks]
}

###--- USER1_MAX_LT_HOLD ---#
##if {$SCENARIO_4 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_4"
##    create_scenario $SCENARIO_4
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -min  WORST_TREE
##
##    ##add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_lt.tcl
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_4_FILE -min_tluplus $TLUPLUS_MIN_4_FILE -tech2itf_map $MAP_FILE
##
##    set auto_link_disable true
##    source -echo -verbose $SDC_USER1
##	source $USER1_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup false \
##        -hold true \
##        -leakage_power false \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##        set_timing_derate -early -cell_delay 0.92
##        set_timing_derate -late  -cell_delay 1
##        set_timing_derate -early -net_delay 0.93
##        set_timing_derate -late  -net_delay 1.07
##        source ./icc_zrt_scripts/add_cell_timing_derate.tcl
##
##        #set_clock_uncertainty -setup 0.1 [all_clocks]
##        set_clock_uncertainty -hold 0.1 -from [all_clocks] -to [all_clocks]
##}

#--- USER1_MIN_LT_HOLD ---#
if {$SCENARIO_5 != ""} {
    echo "SCRIPT-Info : Setting up scenario $SCENARIO_5"
    create_scenario $SCENARIO_5

    set_operating_condition -analysis_type on_chip_variation \
     -max_library [ get_libs {MF3TM6_Pff_V2p2_Tm40_ccs.db:MF3TM6_Pff_V2p2_Tm40} ] \
     -max  BEST_TREE \
     -min_library [ get_libs {MF3TM6_Pff_V2p2_Tm40_ccs.db:MF3TM6_Pff_V2p2_Tm40} ] \
     -min  BEST_TREE

    ##add for ICC2013.12 lib read warning correction
    source -echo ./icc_zrt_scripts/operating_condition_min_lt.tcl

    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_5_FILE -min_tluplus $TLUPLUS_MIN_5_FILE -tech2itf_map $MAP_FILE

    set auto_link_disable true
    source -echo -verbose $SDC_USER1
#wxy 	source $USER1_ADD
    set auto_link_disable false

    #NSGK# Added
    set_scenario_options \
        -setup false \
        -hold true \
        -leakage_power false \
        -dynamic_power false \
        -cts_mode false

	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
         -min_res_scale   1.0000 -max_res_scale   1.0146 \
         -min_cap_scale   1.0000 -max_cap_scale   1.0113
        set_timing_derate -early -cell_delay 1
        set_timing_derate -late  -cell_delay 1.08
        set_timing_derate -early -net_delay 0.93
        set_timing_derate -late  -net_delay 1.07
        source ./icc_zrt_scripts/add_cell_timing_derate.tcl
        #set_clock_uncertainty -setup 0.1 [all_clocks]
        set_clock_uncertainty -hold 0.1 -from [all_clocks] -to [all_clocks]
}


#--- DCSCAN_MAX_HT_SETUP ---#
 if {$SCENARIO_6 != ""} {
     echo "SCRIPT-Info : Setting up scenario $SCENARIO_6"
     create_scenario $SCENARIO_6
 
     set_operating_condition -analysis_type on_chip_variation \
      -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
      -max  WORST_TREE \
      -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
      -min  WORST_TREE
     ##add for ICC2013.12 lib read warning correction
     source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl
 
     set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_6_FILE -min_tluplus $TLUPLUS_MIN_6_FILE -tech2itf_map $MAP_FILE
    
 
     set auto_link_disable true
     source -echo -verbose $SDC_DCSCAN
 #wxy 	source $SCAN_ADD
     set auto_link_disable false
 
     #NSGK# Added
     set_scenario_options \
         -setup true \
         -hold false \
         -leakage_power true \
         -dynamic_power false \
         -cts_mode false
 
 	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
          -min_res_scale   1.0000 -max_res_scale   1.0146 \
          -min_cap_scale   1.0000 -max_cap_scale   1.0113
 	set_timing_derate -early -cell_delay 0.96
 	set_timing_derate -late  -cell_delay 1
 	set_timing_derate -early -net_delay 1
 	set_timing_derate -late  -net_delay 1
 	source ./icc_zrt_scripts/add_cell_timing_derate_setup.tcl
         #set_clock_uncertainty -setup 0.15 [all_clocks]
 }

###--- DCSCAN_MAX_LT_SETUP ---#
##if {$SCENARIO_7 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_7"
##    create_scenario $SCENARIO_7
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -min  WORST_TREE
##    ##add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_lt.tcl
##
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_7_FILE -min_tluplus $TLUPLUS_MIN_7_FILE -tech2itf_map $MAP_FILE
##   
##
##    set auto_link_disable true
##    source -echo -verbose $SDC_DCSCAN
##	source $SCAN_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup true \
##        -hold false \
##        -leakage_power true \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##	set_timing_derate -early -cell_delay 0.96
##	set_timing_derate -late  -cell_delay 1
##	set_timing_derate -early -net_delay 1
##	set_timing_derate -late  -net_delay 1
##	source ./icc_zrt_scripts/add_cell_timing_derate_setup.tcl
##       #set_clock_uncertainty -setup 0.15 [all_clocks]
##}
##
##
###--- DCSCAN_MAX_HT_HOLD ---#
##if {$SCENARIO_8 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_8"
##    create_scenario $SCENARIO_8
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
##     -min  WORST_TREE
##    ##add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_8_FILE -min_tluplus $TLUPLUS_MIN_8_FILE -tech2itf_map $MAP_FILE
##
##    set auto_link_disable true
##    source -echo -verbose $SDC_DCSCAN
##	source $SCAN_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup false \
##        -hold true \
##        -leakage_power false \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##        set_timing_derate -early -cell_delay 0.92
##        set_timing_derate -late  -cell_delay 1
##        set_timing_derate -early -net_delay 0.93
##        set_timing_derate -late  -net_delay 1.07
##        source ./icc_zrt_scripts/add_cell_timing_derate.tcl
##
##        #set_clock_uncertainty -setup 0.1 [all_clocks]
##        set_clock_uncertainty -hold 0.1 -from [all_clocks] -to [all_clocks]
##}
##
###--- DCSCAN_MAX_LT_HOLD ---#
##if {$SCENARIO_9 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_9"
##    create_scenario $SCENARIO_9
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -min  WORST_TREE
##    ##add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_lt.tcl
##
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_9_FILE -min_tluplus $TLUPLUS_MIN_9_FILE -tech2itf_map $MAP_FILE
##
##    set auto_link_disable true
##    source -echo -verbose $SDC_DCSCAN
##	source $SCAN_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup false \
##        -hold true \
##        -leakage_power false \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##        set_timing_derate -early -cell_delay 0.92
##        set_timing_derate -late  -cell_delay 1
##        set_timing_derate -early -net_delay 0.93
##        set_timing_derate -late  -net_delay 1.07
##        source ./icc_zrt_scripts/add_cell_timing_derate.tcl
##
##        #set_clock_uncertainty -setup 0.1 [all_clocks]
##        set_clock_uncertainty -hold 0.1 -from [all_clocks] -to [all_clocks]
##}
##
#--- DCSCAN_MIN_LT_HOLD ---#
 if {$SCENARIO_10 != ""} {
     echo "SCRIPT-Info : Setting up scenario $SCENARIO_10"
     create_scenario $SCENARIO_10
 
     set_operating_condition -analysis_type on_chip_variation \
      -max_library [ get_libs {MF3TM6_Pff_V2p2_Tm40_ccs.db:MF3TM6_Pff_V2p2_Tm40} ] \
      -max  BEST_TREE \
      -min_library [ get_libs {MF3TM6_Pff_V2p2_Tm40_ccs.db:MF3TM6_Pff_V2p2_Tm40} ] \
      -min  BEST_TREE
     ##add for ICC2013.12 lib read warning correction
     source -echo ./icc_zrt_scripts/operating_condition_min_lt.tcl
 
     set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_10_FILE -min_tluplus $TLUPLUS_MIN_10_FILE -tech2itf_map $MAP_FILE
 
     set auto_link_disable true
     source -echo -verbose $SDC_DCSCAN
 #wxy	source $SCAN_ADD
     set auto_link_disable false
 
     #NSGK# Added
     set_scenario_options \
         -setup false \
         -hold true \
         -leakage_power false \
         -dynamic_power false \
         -cts_mode false
 
 	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
          -min_res_scale   1.0000 -max_res_scale   1.0146 \
          -min_cap_scale   1.0000 -max_cap_scale   1.0113
         set_timing_derate -early -cell_delay 1
         set_timing_derate -late  -cell_delay 1.08
         set_timing_derate -early -net_delay 0.93
         set_timing_derate -late  -net_delay 1.07
         source ./icc_zrt_scripts/add_cell_timing_derate.tcl
 
         #set_clock_uncertainty -setup 0.1 [all_clocks]
         set_clock_uncertainty -hold 0.1 -from [all_clocks] -to [all_clocks]
 }

#--- AC_MAX_HT_SETUP ---#
 if {$SCENARIO_11 != ""} {
     echo "SCRIPT-Info : Setting up scenario $SCENARIO_11"
     create_scenario $SCENARIO_11
 
     set_operating_condition -analysis_type on_chip_variation \
      -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
      -max  WORST_TREE \
      -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
      -min  WORST_TREE
     ##add for ICC2013.12 lib read warning correction
     source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl
 
     set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_11_FILE -min_tluplus $TLUPLUS_MIN_11_FILE -tech2itf_map $MAP_FILE
    
 
     set auto_link_disable true
     source -echo -verbose $SDC_AC
     set auto_link_disable false
 
     #NSGK# Added
     set_scenario_options \
         -setup true \
         -hold false \
         -leakage_power false \
         -dynamic_power false \
         -cts_mode false
 
 	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
 	 -min_res_scale   1.0000 -max_res_scale   1.0146 \
 	 -min_cap_scale   1.0000 -max_cap_scale   1.0113
 	set_timing_derate -early -cell_delay 0.96
 	set_timing_derate -late  -cell_delay 1
 	set_timing_derate -early -net_delay 1
 	set_timing_derate -late  -net_delay 1
 	source ./icc_zrt_scripts/add_cell_timing_derate_setup.tcl
         #set_clock_uncertainty -setup 0.1 [all_clocks]
 
       #  source ./FILES/SDC/setmax_adcsm_130424.tcl
 
 #    source -echo -verbose ./FILES/SDC/rspi_maxdelay.tcl_3ns
 }


###--- USER2_MAX_HT_SETUP ---#
##if {$SCENARIO_12 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_12"
##    create_scenario $SCENARIO_12
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
##     -min  WORST_TREE
##    ##add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_12_FILE -min_tluplus $TLUPLUS_MIN_12_FILE -tech2itf_map $MAP_FILE
##   
##
##    set auto_link_disable true
##    source -echo -verbose $SDC_USER2
##	source $USER2_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup true \
##        -hold false \
##        -leakage_power true \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
##	 -min_res_scale   1.0000 -max_res_scale   1.0146 \
##	 -min_cap_scale   1.0000 -max_cap_scale   1.0113
##	set_timing_derate -early -cell_delay 0.96
##	set_timing_derate -late  -cell_delay 1
##	set_timing_derate -early -net_delay 1
##	set_timing_derate -late  -net_delay 1
##	#source ./icc_zrt_scripts/add_cell_timing_derate_setup.tcl
##        #set_clock_uncertainty -setup 0.15 [all_clocks]
##
###    source -echo -verbose ./FILES/SDC/rspi_maxdelay.tcl_3ns
##}
##
###--- USER2_MAX_LT_SETUP ---#
##if {$SCENARIO_13 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_13"
##    create_scenario $SCENARIO_13
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -min  WORST_TREE
##    ##add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_lt.tcl
##
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_13_FILE -min_tluplus $TLUPLUS_MIN_13_FILE -tech2itf_map $MAP_FILE
##   
##
##    set auto_link_disable true
##    source -echo -verbose $SDC_USER2
##	source $USER2_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup true \
##        -hold false \
##        -leakage_power true \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##	set_timing_derate -early -cell_delay 0.96
##	set_timing_derate -late  -cell_delay 1
##	set_timing_derate -early -net_delay 1
##	set_timing_derate -late  -net_delay 1
##	#source ./icc_zrt_scripts/add_cell_timing_derate_setup.tcl
##        #set_clock_uncertainty -setup 0.15 [all_clocks]
##}
##
##
#wxy ###--- USER2_MAX_HT_HOLD ---#
#wxy if {$SCENARIO_14 != ""} {
#wxy     echo "SCRIPT-Info : Setting up scenario $SCENARIO_14"
#wxy     create_scenario $SCENARIO_14
#wxy 
#wxy     set_operating_condition -analysis_type on_chip_variation \
#wxy      -max_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
#wxy      -max  WORST_TREE \
#wxy      -min_library [ get_libs {MF3TM6_Pss_V2p0_T125_ccs.db:MF3TM6_Pss_V2p0_T125} ] \
#wxy      -min  WORST_TREE
#wxy     ##add for ICC2013.12 lib read warning correction
#wxy     source -echo ./icc_zrt_scripts/operating_condition_max_ht.tcl
#wxy 
#wxy     set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_14_FILE -min_tluplus $TLUPLUS_MIN_14_FILE -tech2itf_map $MAP_FILE
#wxy 
#wxy     set auto_link_disable true
#wxy     source -echo -verbose $SDC_USER3
#wxy #wxy 	source $USER2_ADD
#wxy     set auto_link_disable false
#wxy 
#wxy     #NSGK# Added
#wxy     set_scenario_options \
#wxy         -setup false \
#wxy         -hold true \
#wxy         -leakage_power false \
#wxy         -dynamic_power false \
#wxy         -cts_mode false
#wxy 
#wxy 	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95 \
#wxy          -min_res_scale   1.0000 -max_res_scale   1.0146 \
#wxy          -min_cap_scale   1.0000 -max_cap_scale   1.0113
#wxy         set_timing_derate -early -cell_delay 0.92
#wxy         set_timing_derate -late  -cell_delay 1
#wxy         set_timing_derate -early -net_delay 0.93
#wxy         set_timing_derate -late  -net_delay 1.07
#wxy         source ./icc_zrt_scripts/add_cell_timing_derate.tcl
#wxy 
#wxy         #set_clock_uncertainty -setup 0.1 [all_clocks]
#wxy         set_clock_uncertainty -hold 0.1 -from [all_clocks] -to [all_clocks]
#wxy }

###--- USER2_MAX_LT_HOLD ---#
##if {$SCENARIO_15 != ""} {
##    echo "SCRIPT-Info : Setting up scenario $SCENARIO_15"
##    create_scenario $SCENARIO_15
##
##    set_operating_condition -analysis_type on_chip_variation \
##     -max_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -max  WORST_TREE \
##     -min_library [ get_libs {MF3TM6_Pss_V2p0_Tm40_ccs.db:MF3TM6_Pss_V2p0_Tm40} ] \
##     -min  WORST_TREE
##    ##add for ICC2013.12 lib read warning correction
##    source -echo ./icc_zrt_scripts/operating_condition_max_lt.tcl
##
##
##    set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_15_FILE -min_tluplus $TLUPLUS_MIN_15_FILE -tech2itf_map $MAP_FILE
##
##    set auto_link_disable true
##    source -echo -verbose $SDC_USER2
##	source $USER2_ADD
##    set auto_link_disable false
##
##    #NSGK# Added
##    set_scenario_options \
##        -setup false \
##        -hold true \
##        -leakage_power false \
##        -dynamic_power false \
##        -cts_mode false
##
##	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
##         -min_res_scale   1.0000 -max_res_scale   1.0146 \
##         -min_cap_scale   1.0000 -max_cap_scale   1.0113
##        set_timing_derate -early -cell_delay 0.92
##        set_timing_derate -late  -cell_delay 1
##        set_timing_derate -early -net_delay 0.93
##        set_timing_derate -late  -net_delay 1.07
##        source ./icc_zrt_scripts/add_cell_timing_derate.tcl
##
##        #set_clock_uncertainty -setup 0.1 [all_clocks]
##        set_clock_uncertainty -hold 0.1 -from [all_clocks] -to [all_clocks]
##}
##
###--- USER2_MIN_LT_HOLD ---#
#wxy if {$SCENARIO_16 != ""} {
#wxy     echo "SCRIPT-Info : Setting up scenario $SCENARIO_16"
#wxy     create_scenario $SCENARIO_16
#wxy 
#wxy     set_operating_condition -analysis_type on_chip_variation \
#wxy      -max_library [ get_libs {MF3TM6_Pff_V2p2_Tm40_ccs.db:MF3TM6_Pff_V2p2_Tm40} ] \
#wxy      -max  BEST_TREE \
#wxy      -min_library [ get_libs {MF3TM6_Pff_V2p2_Tm40_ccs.db:MF3TM6_Pff_V2p2_Tm40} ] \
#wxy      -min  BEST_TREE
#wxy     ##add for ICC2013.12 lib read warning correction
#wxy     source -echo ./icc_zrt_scripts/operating_condition_min_lt.tcl
#wxy 
#wxy     set_tlu_plus_files -max_tluplus $TLUPLUS_MAX_16_FILE -min_tluplus $TLUPLUS_MIN_16_FILE -tech2itf_map $MAP_FILE
#wxy 
#wxy     set auto_link_disable true
#wxy     source -echo -verbose $SDC_USER3
#wxy 	source $USER2_ADD
#wxy     set auto_link_disable false
#wxy 
#wxy     #NSGK# Added
#wxy     set_scenario_options \
#wxy         -setup false \
#wxy         -hold true \
#wxy         -leakage_power false \
#wxy         -dynamic_power false \
#wxy         -cts_mode false
#wxy 
#wxy 	set_extraction_options -max_process_scale 0.95 -min_process_scale 0.95  \
#wxy          -min_res_scale   1.0000 -max_res_scale   1.0146 \
#wxy          -min_cap_scale   1.0000 -max_cap_scale   1.0113
#wxy         set_timing_derate -early -cell_delay 1
#wxy         set_timing_derate -late  -cell_delay 1.08
#wxy         set_timing_derate -early -net_delay 0.93
#wxy         set_timing_derate -late  -net_delay 1.07
#wxy         source ./icc_zrt_scripts/add_cell_timing_derate.tcl
#wxy         #set_clock_uncertainty -setup 0.1 [all_clocks]
#wxy         set_clock_uncertainty -hold 0.1 -from [all_clocks] -to [all_clocks]
#wxy }






########################################################################################
## Check Scenarios: you can check MCMM library consistency using the following command.
########################################################################################

check_scenarios -output $REPORTS_DIR
---61:mv_setup_design.tcl---
##Setup MV Design
  
  if {$AO_MODE == "true" } { set enable_ao_synthesis true }

  ## create always on domain
  create_power_domain ALWAYS_ON_TOP
  
  ## creation of the different power domains
  if {$PD1 != "" } {
    create_power_domain $PD1 \
         -object_list [get_cell $PD1_CELLS]
    #    -power_down \
    #    -power_down_ctrl ctrl/mult_sleep \

  } 
    
  # Create leaf power domain(s).  If they are shutdown blocks, uncomment 
  # the power_down and power_down_ctrl switches.
  if {$PD2 != "" } {
    create_power_domain $PD2 \
         -object_list [get_cell $PD2_CELLS]
    #    -power_down \
    #    -power_down_ctrl ctrl/mult_sleep \
  }
       
  if {$PD3 != "" } {
       create_power_domain $PD3 \
           -object_list [get_cell $PD3_CELLS]
    #    -power_down \
    #    -power_down_ctrl ctrl/mult_sleep \
  }
    
  ##############################################################################
  ## Create Power Nets
  ##
  ## Connect power nets to appropriate power domains.
  ## modified on Dec.12.28.2009
  ##############################################################################

  create_power_net_info ${MW_POWER_NET} -power                    ;# Power net for main power domain
  if {$MW_POWER_NET1 != "" } {create_power_net_info $MW_POWER_NET1 -power}  ;# Power net for LEAF1 power domain
  if {$MW_POWER_NET2 != "" } {create_power_net_info $MW_POWER_NET2 -power}  ;# Power net for LEAF2 power domain
  if {$MW_POWER_NET3 != "" } {create_power_net_info $MW_POWER_NET3 -power}  ;# Power net for LEAF3 power domain
  create_power_net_info $MW_GROUND_NET -gnd          ;# Common ground

  connect_power_domain ALWAYS_ON_TOP \
    -primary_power_net ${MW_POWER_NET} \
    -primary_ground_net ${MW_GROUND_NET}

  if {$PD1 != "" } {
    connect_power_domain $PD1 \
      -primary_power_net $MW_POWER_NET1 \
      -primary_ground_net $MW_GROUND_NET
  }
       
  if {$PD2 != "" } {
    connect_power_domain $PD2 \
      -primary_power_net $MW_POWER_NET2 \
      -primary_ground_net $MW_GROUND_NET 
  }
    
  if {$PD3 != "" } {
    connect_power_domain $PD3 \
      -primary_power_net $MW_POWER_NET3 \
      -primary_ground_net $MW_GROUND_NET 
  }
    
    

  #################################################################################
  ##  Insert Isolation Cells
  #################################################################################
       
  ## Need to manually insert all missing isolation cells.
  ## User needs to specify an appropriate library cell for '-reference'
  ## User needs to specify the net that will act as the enable signal for the isolation cell using the '-enable'
  ## User needs to specify the location to insert the isolation cell using '-object_list'
       
  # insert_isolation_cell -reference $lib_cell -enable [find net $enable_net] -object_list [<get_net $nets_missing_isolation_cells>]
    
    
  ## Check for isolation cell violations
  check_mv_design -isolation -verbose > $REPORTS_DIR/$DESIGN_NAME.mv_iso_drc.rpt
    
  if {$AO_MODE == "true" } { set_attribute -type boolean [get_cells ${AO_INSTANCES} ] always_on true}
  
  ## Report Power Domain/Net information
  report_power_net_info > $REPORTS_DIR/$DESIGN_NAME.power_net.rpt 
  report_power_domain > $REPORTS_DIR/$DESIGN_NAME.power_net.rpt
    
  #################################################################################
  ## Apply The Level Shifter Strategy
  #################################################################################
  set_level_shifter_strategy -rule all
    
  ## Check for level shifter violations
  check_mv_design -level_shifter -verbose > $REPORTS_DIR/$DESIGN_NAME.mv_ls_drc.rpt

---62:operating_condition_For_DIODE.tcl---
## DIODE Operating Condition

foreach elm [get_scenarios *] { current_scenario $elm
	 set_operating_condition -analysis_type on_chip_variation \
     -max_library [ get_libs {MF3TM6DIODE_ccs.db:MF3TM6DIODE} ] \
     -max WORST_TREE_NEW    \
     -min_library [ get_libs {MF3TM6DIODE_ccs.db:MF3TM6DIODE} ] \
     -min  WORST_TREE_NEW  \
     -object_list [get_flat_cells -filter "ref_name==TM6PNDIODE"]
}
---63:operating_condition_max_ht.tcl---
## Operating Conditions for Spectial Cells.

set_operating_condition -analysis_type on_chip_variation \
 -max_library [ get_libs {umf30QAHMOS2_Pss_V2p0_T150_VCC2p7.db:umf30QAHMOS2_Pss_V2p0_T150_VCC2p7} ] \
 -max Pss_V2p0_T150_VCC2p7 \
 -min_library [ get_libs {umf30QAHMOS2_Pss_V2p0_T150_VCC2p7.db:umf30QAHMOS2_Pss_V2p0_T150_VCC2p7} ] \
 -min Pss_V2p0_T150_VCC2p7 \
 -object_list [get_cells cpusys/syspf/clkmc/osc]

set_operating_condition -analysis_type on_chip_variation \
 -max_library [ get_libs {QAHIOS1BN15KV1_Pss_V2p0_T150.db:MF3_cmos1_2.1V_MAX_QAHIOS1BN15KV1} ] \
 -max  WORST_TREE \
 -min_library [ get_libs {QAHIOS1BN15KV1_Pss_V2p0_T150.db:MF3_cmos1_2.1V_MAX_QAHIOS1BN15KV1} ] \
 -min  WORST_TREE \
 -object_list [get_cells cpusys/syspf/clkmc/iloco]

set_operating_condition -analysis_type on_chip_variation \
 -max_library [ get_libs {QAHNFI4BN300NV1_Pss_V2p0_T150.db:MF3_cmos1_2.1V_MAX_QAHNFI4BN300NV1} ] \
 -max  WORST_TREE \
 -min_library [ get_libs {QAHNFI4BN300NV1_Pss_V2p0_T150.db:MF3_cmos1_2.1V_MAX_QAHNFI4BN300NV1} ] \
 -min  WORST_TREE \
 -object_list [get_cells {cpusys/syspf/psu/DLY300RES cpusys/syspf/psu/DLY300EXLVI cpusys/syspf/psu/DLY300LVI cpusys/syspf/psu/DLY300POC cpusys/syspf/psu/DLY300LVD0 cpusys/syspf/clkmc/osccnt15/hocomux/hocostp_dly300} ]

#set_operating_condition -analysis_type on_chip_variation \
# -max_library [ get_libs {AMF3_CLK0000CKR00V37A_Pss_V2p0_T150.db:AMF3_CLK0000CKR00V37A_Pss_V2p0_T150} ] \
# -max  WORST_TREE \
# -min_library [ get_libs {AMF3_CLK0000CKR00V37A_Pss_V2p0_T150.db:AMF3_CLK0000CKR00V37A_Pss_V2p0_T150} ] \
# -min  WORST_TREE \
# -object_list [get_cells cpusys/syspf/clkmc/hoco]

#set_operating_condition -analysis_type on_chip_variation \
# -max_library [ get_libs {OWSRAM151W144B32C3B8_Pss_V2p0_T150.db:MF3_cmos1_2.1V_MAX_OWSRAM151W144B32C3B8} ] \
# -max  Pss_V2p0_T150 \
# -min_library [ get_libs {OWSRAM151W144B32C3B8_Pss_V2p0_T150.db:MF3_cmos1_2.1V_MAX_OWSRAM151W144B32C3B8} ] \
# -min  Pss_V2p0_T150 \
# -object_list [get_cells pericore/anatop/can_ram/ia_0_0/i0/i0]

#set_operating_condition -analysis_type on_chip_variation \
# -max_library [ get_libs {umf30QAHMIX7LPF_Pss_V2p0_T150.db:umf30QAHMIX7LPF_Pss_V2p0_T150} ] \
# -max  WORST_TREE \
# -min_library [ get_libs {umf30QAHMIX7LPF_Pss_V2p0_T150.db:umf30QAHMIX7LPF_Pss_V2p0_T150} ] \
# -min  WORST_TREE \
# -object_list [get_cells cpusys/syspf/clkmc/hoco_lpf]

# set_operating_condition -analysis_type on_chip_variation \
# -max_library [ get_libs {QNSA3N128K0V3_Pss_V2p0_T150} ] \
# -max  WORST_TREE \
# -min_library [ get_libs {QNSA3N128K0V3_Pss_V2p0_T150} ] \
# -min  WORST_TREE \
# -object_list [get_cells { 
#cpusys/bpm/rx_flash/flash_mem/flash_cp0
#cpusys/bpm/rx_flash/flash_mem/flash_cp1
#cpusys/bpm/rx_flash/flash_mem/flash_reg0
#cpusys/bpm/rx_flash/flash_mem/flash_reg1
#cpusys/bpm/rx_flash/flash_mem/flash_code0
#cpusys/bpm/rx_flash/flash_mem/flash_code1
#cpusys/bpm/rx_flash/flash_mem/flash_data0}]

set_operating_condition -analysis_type on_chip_variation \
 -max_library [ get_libs {QNSA3N128K0V3_Pss_V2p0_T150.db:QNSA3N128K0V3_Pss_V2p0_T150} ] \
 -max  WORST_TREE \
 -min_library [ get_libs {QNSA3N128K0V3_Pss_V2p0_T150.db:QNSA3N128K0V3_Pss_V2p0_T150} ] \
 -min  WORST_TREE \
 -object_list [get_cells {cpusys/bpm/rx_flash/flash_mem/flash_code0 cpusys/bpm/rx_flash/flash_mem/flash_code1}]

# set_operating_condition -analysis_type on_chip_variation \
#  -max_library [ get_libs {QNSC3NREG1V3_Pss_V2p0_T150.db:QNSC3NREG1V3_Pss_V2p0_T150} ] \
#  -max  WORST_TREE \
#  -min_library [ get_libs {QNSC3NREG1V3_Pss_V2p0_T150.db:QNSC3NREG1V3_Pss_V2p0_T150} ] \
#  -min  WORST_TREE \
#  -object_list [get_cells {cpusys/bpm/rx_flash/flash_mem/flash_reg1 cpusys/bpm/rx_flash/flash_mem/flash_reg0}]

set_operating_condition -analysis_type on_chip_variation \
 -max_library [ get_libs {QNSC3NCP3V3_Pss_V2p0_T150.db:QNSC3NCP3V3_Pss_V2p0_T150} ] \
 -max  WORST_TREE \
 -min_library [ get_libs {QNSC3NCP3V3_Pss_V2p0_T150.db:QNSC3NCP3V3_Pss_V2p0_T150} ] \
 -min  WORST_TREE \
 -object_list [get_cells {cpusys/bpm/rx_flash/flash_mem/flash_cp1 cpusys/bpm/rx_flash/flash_mem/flash_cp0}]

set_operating_condition -analysis_type on_chip_variation \
 -max_library [ get_libs {QNSB3N008K0V3_Pss_V2p0_T150.db:QNSB3N008K0V3_Pss_V2p0_T150} ] \
 -max  WORST_TREE \
 -min_library [ get_libs {QNSB3N008K0V3_Pss_V2p0_T150.db:QNSB3N008K0V3_Pss_V2p0_T150} ] \
 -min  WORST_TREE \
 -object_list [get_cells {cpusys/bpm/rx_flash/flash_mem/flash_data0}]
---64:operating_condition_min_lt.tcl---
## Operating Conditions for Spectial Cells.

#wxy set_operating_condition -analysis_type on_chip_variation \
#wxy  -max_library [ get_libs {umf30QAHMOS2_Pff_V2p2_Tm40_VCC5p5.db:umf30QAHMOS2_Pff_V2p2_Tm40_VCC5p5} ] \
#wxy  -max Pff_V2p2_Tm40_VCC5p5 \
#wxy  -min_library [ get_libs {umf30QAHMOS2_Pff_V2p2_Tm40_VCC5p5.db:umf30QAHMOS2_Pff_V2p2_Tm40_VCC5p5} ] \
#wxy  -min Pff_V2p2_Tm40_VCC5p5 \
#wxy  -object_list [get_cells cpusys/syspf/clkmc/osc]
#wxy 
#wxy set_operating_condition -analysis_type on_chip_variation \
#wxy  -max_library [ get_libs {umf30QAHSOS3_Pff_V2p2_Tm40_VCC5p5.db:umf30QAHSOS3_Pff_V2p2_Tm40_VCC5p5} ] \
#wxy  -max  BEST_TREE \
#wxy  -min_library [ get_libs {umf30QAHSOS3_Pff_V2p2_Tm40_VCC5p5.db:umf30QAHSOS3_Pff_V2p2_Tm40_VCC5p5} ] \
#wxy  -min  BEST_TREE \
#wxy  -object_list [get_cells cpusys/syspf/clkmc/osc32k]
#wxy 
#wxy set_operating_condition -analysis_type on_chip_variation \
#wxy  -max_library [ get_libs {QAHIOS1BN15KV1_Pff_V2p2_Tm40.db:MF3_cmos1_2.1V_MIN_QAHIOS1BN15KV1} ] \
#wxy  -max  BEST_TREE \
#wxy  -min_library [ get_libs {QAHIOS1BN15KV1_Pff_V2p2_Tm40.db:MF3_cmos1_2.1V_MIN_QAHIOS1BN15KV1} ] \
#wxy  -min  BEST_TREE \
#wxy  -object_list [get_cells cpusys/syspf/clkmc/iloco]
#wxy 
#wxy set_operating_condition -analysis_type on_chip_variation \
#wxy  -max_library [ get_libs {QAHNFI4BN300NV1_Pff_V2p2_Tm40.db:MF3_cmos1_2.1V_MIN_QAHNFI4BN300NV1} ] \
#wxy  -max  BEST_TREE \
#wxy  -min_library [ get_libs {QAHNFI4BN300NV1_Pff_V2p2_Tm40.db:MF3_cmos1_2.1V_MIN_QAHNFI4BN300NV1} ] \
#wxy  -min  BEST_TREE \
#wxy  -object_list [get_cells {cpusys/syspf/psu/DLY300RES cpusys/syspf/psu/DLY300EXLVI cpusys/syspf/psu/DLY300LVI cpusys/syspf/psu/DLY300POC cpusys/syspf/clkmc/nc_osc32k/dnc300n cpusys/syspf/psu/DLY300LVD0 cpusys/syspf/clkmc/osccnt15/hocomux/hocostp_dly300} ]
#wxy 
#wxy 
#wxy  set_operating_condition -analysis_type on_chip_variation \
#wxy  -max_library [ get_libs {QNSQ3N256K0V2_Pff_V2p2_Tm40} ] \
#wxy  -max  BEST_TREE \
#wxy  -min_library [ get_libs {QNSQ3N256K0V2_Pff_V2p2_Tm40} ] \
#wxy  -min  BEST_TREE \
#wxy  -object_list [get_cells { cpusys/bpm/rx_flash/flash_mem/flash_cp
#wxy cpusys/bpm/rx_flash/flash_mem/flash_data
#wxy cpusys/bpm/rx_flash/flash_mem/flash_code1
#wxy cpusys/bpm/rx_flash/flash_mem/flash_code}]
---65:set_source_latency.tcl---
####current_scenario USER1_MAX_HT_HOLD
####set_clock_latency -min  -source 5.253 [get_clocks {fineclk_div}]
####set_clock_latency -min  -source 4.215 [get_clocks {fineclk_thr}]
#####current_scenario USER1_MAX_LT_HOLD
#####set_clock_latency -min -source 5.91 [get_clocks {fineclk_div}]
####current_scenario USER1_MIN_LT_HOLD
####set_clock_latency -min  -source 2.352 [get_clocks {fineclk_div}]
####set_clock_latency -min  -source 1.876 [get_clocks {fineclk_thr}]
####current_scenario USER1_MAX_HT_SETUP
####set_clock_latency -max  -source 6.476 [get_clocks {fineclk_div}]
####set_clock_latency -max  -source 5.425 [get_clocks {fineclk_thr}]
#####current_scenario USER1_MAX_LT_SETUP
#####set_clock_latency -max -source 6.91 [get_clocks {fineclk_div}]
####
######current_scenario USER2_MAX_HT_HOLD
######set_clock_latency -min  -source 6.70  [get_clocks {fineclk_thr}]
######set_clock_latency -min  -source  6.90 [get_clocks {fineclk_div}]
######current_scenario USER2_MAX_LT_HOLD
######set_clock_latency -min -source  5.72 [get_clocks {fineclk_thr}]
######set_clock_latency -min -source  5.91 [get_clocks {fineclk_div}]
######current_scenario USER2_MIN_LT_HOLD
######set_clock_latency -min  -source  2.87 [get_clocks {fineclk_thr}]
######set_clock_latency -min  -source 2.95  [get_clocks {fineclk_div}]
######current_scenario USER2_MAX_HT_SETUP
######set_clock_latency -max  -source  7.88 [get_clocks {fineclk_thr}]
######set_clock_latency -max  -source  8.09 [get_clocks {fineclk_div}]
######current_scenario USER2_MAX_LT_SETUP
######set_clock_latency -max -source 6.71  [get_clocks {fineclk_thr}]
######set_clock_latency -max -source 6.91  [get_clocks {fineclk_div}]



####current_scenario USER1_MAX_HT_SETUP
####set_clock_latency -max -source 5.528 [get_clocks {fineclk_div}] 
####set_clock_latency -max -source 4.729 [get_clocks {fineclk_thr}]
####
####current_scenario USER1_MAX_HT_HOLD
####set_clock_latency -min -source 4.52489 [get_clocks {fineclk_div}] 
####set_clock_latency -min -source 3.66051 [get_clocks {fineclk_thr}]
####
####current_scenario USER1_MIN_LT_HOLD
####set_clock_latency -min -source 2.02612 [get_clocks {fineclk_div}] 
####set_clock_latency -min -source 1.64332 [get_clocks {fineclk_thr}]



current_scenario USER1_MAX_HT_SETUP
set_clock_latency -max -source 5.696 [get_clocks {fineclk_div}] 
set_clock_latency -max -source 4.597 [get_clocks {fineclk_thr}]

current_scenario USER1_MAX_HT_HOLD
set_clock_latency -min -source 4.67028 [get_clocks {fineclk_div}] 
set_clock_latency -min -source 3.64712 [get_clocks {fineclk_thr}]

current_scenario USER1_MIN_LT_HOLD
set_clock_latency -max -source 2.08659 [get_clocks {fineclk_div}] 
set_clock_latency -max -source 1.63881 [get_clocks {fineclk_thr}]

---66:set_voltage_forUPF_sample.tcl---
set_operating_condition -analysis_type bc_wc \
 -max_library [ get_libs { RC03FTL7_Pss_V1p35_T125_CCS_pg.db:RC03FTL7_Pss_V1p35_T125_CCS_pg } ] -max Pss_V1p35_T125 \
 -min_library [ get_libs { RC03FTL7_Pff_V1p65_Tm40_CCS_pg.db:RC03FTL7_Pff_V1p65_Tm40_CCS_pg } ] -min Pff_V1p65_Tm40

set_voltage 1.35 -object_list {VDD}
set_voltage 0.00 -object_list {VSS}
#!/usr/local/bin/python2.7
import csv
import sys
import os
sys.path.append('/svhome/os_mawa/py/my_lib/xlwt-1.3.0')
import xlwt
#
myexcel = xlwt.Workbook()
#

csvBaseDir = ''
csvList = os.listdir(csvBaseDir)

#P1--for each csv
testfile = open('tf',"w")
for cf in csvList:
    #abs path
    cfAbs = os.path.join(csvBaseDir,cf)
    csvfile = open(cfAbs,"r")

    #print cfAbs
    mysheet = myexcel.add_sheet(cf)
    #
    reader = csv.reader(csvfile)
    l = 0
    #line is a list
    for line in reader:
	#print(line)
	#testfile.write(line)
        r = 0
        #
        for i in line:
            #print l,r 
            # write sheet
            mysheet.write(l,r,i)
            r=r+1
        l=l+1
#P2--save to sheet 
#
myexcel.save(csvBaseDir+"/myexcel.xls")
testfile.close()
